"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[50924],{60724:(e,t,n)=>{n.r(t),n.d(t,{getCardChanelProvider:()=>E,getCodeLoaderFactory:()=>N,getMetaOSProvider:()=>O,getUrlHandlerProvider:()=>R});var o=n(25378),i=n(26449),a=n(69235);const s=3e5;let r=function(e){return e[e.BotInvoke=1]="BotInvoke",e[e.OpenAuthWindow=2]="OpenAuthWindow",e[e.VerifyCard=3]="VerifyCard",e[e.GetAppFromAppId=4]="GetAppFromAppId",e[e.GetImage=5]="GetImage",e[e.OpenUrlAction=7]="OpenUrlAction",e[e.AnchorClicked=11]="AnchorClicked",e[e.SSOToken=17]="SSOToken",e[e.InstallApp=18]="InstallApp",e[e.EmbedCard=19]="EmbedCard",e[e.OpenStageView=20]="OpenStageView",e[e.OpenTaskModule=21]="OpenTaskModule",e}({});const l="Error while parsing the Unfurl response",d="Unable to get app definition!",u="Attachments not defined for successful unfurl",c="No compose extensions found",p="Url not present for Nominal auth response",v="SSO token fetch failed",w="Unable to complete action";var f=n(27901),h=n(91947);var m=n(58443),A=n(51492);async function g(e,t){return await Promise.race([(0,h.w_)(e,t),y(e,t)])}function y(e,t){const n=t.requestContext.timeoutDurationInMS;return new Promise(o=>{setTimeout(()=>{const n={requestContext:{...t.requestContext,rejectionReason:`Promise timeout for MessageType: ${e}`},payload:{success:!1}};o(n)},n)})}function I(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e4;return m.yz&&(e=6e5),{requestContext:{id:(0,f._)(),timeoutDurationInMS:e},payload:{}}}var k=n(6971);class U{constructor(){this.shouldCheckForUpdateExtensions=!0}get CardChannelProvider(){return this}async unfurl(){throw new a.uV("unfurl method is deprecated")}async invokeBot(e,t){let n=t;switch(e){case"composeExtension/queryLink":if(this.shouldCheckForUpdateExtensions=!1,await(0,A.Xe)()){const e=await(0,k.E)();if(null===e||void 0===e||!e.isReadOnly){const t=null===e||void 0===e?void 0:e.invokeBotResponse;if(t){const e=JSON.parse(t);if(!e)throw new a.uV(w);return function(e){try{var t,n;const o=e.composeExtension;if(!o)throw new a.uV(c);if("result"==o.type&&!o.attachments)throw new a.uV(u);if("auth"==o.type&&(null===(t=o.suggestedActions)||void 0===t||null===(n=t.actions)||void 0===n||!n[0].value))throw new a.uV(p);return{response:{composeExtension:o},statusCode:200}}catch(o){throw new a.uV(l,o)}}(e)}}}break;case"task/fetch":break;case"adaptiveCard/action":{var o,i,s;const e=null===(o=t.extension)||void 0===o||null===(i=o.updateExtendedProps)||void 0===i?void 0:i.data,r=null===(s=t.extension)||void 0===s?void 0:s.verifyCardSignature;if(!e&&this.shouldCheckForUpdateExtensions)throw new a.uV("No update extension details found");if(!r)throw new a.uV("No verify card details found");const{name:l,value:d}=t;n={name:l,value:d,type:"invoke",cardId:null===e||void 0===e?void 0:e.cardId,contentType:null===e||void 0===e?void 0:e.contentType,appName:null===e||void 0===e?void 0:e.appName,appIcon:null===e||void 0===e?void 0:e.appIcon,serializedContent:r.card,signature:r.signature}}break;default:throw new a.uV(`undefined name found: ${e}`)}const d=await async function(e,t,n){const o={...I(3e4),payload:{appId:e,botId:t,requestBody:n}};return await g(r.BotInvoke,o)}(t.metaOsAppId,t.msaAppId,n),v=null===d||void 0===d?void 0:d.requestContext.rejectionReason;if(!d||v)throw new a.uV(null!==v&&void 0!==v?v:w);return function(e,t){if("composeExtension/queryLink"===e)try{var n,o;const e=t.payload.composeExtension;if(!e)throw new a.uV(c);if("result"==e.type&&!e.attachments)throw new a.uV(u);if("auth"==e.type&&(null===(n=e.suggestedActions)||void 0===n||null===(o=n.actions)||void 0===o||!o[0].value))throw new a.uV(p);return{response:{composeExtension:e},statusCode:200}}catch(i){throw new a.uV(l,i)}if("adaptiveCard/action"===e)return{response:t.payload};if("task/fetch"===e)return{response:t.payload};throw new a.uV(`undefined name found in response: ${e}`)}(e,d)}async cardVerify(e){var t,n,o;const i=e.extension,s=null===i||void 0===i?void 0:i.updateExtendedProps;if(!i)throw new a.uV("Unable to verify without UpdateExtension data");if("updateExtendedProps"!==(null===s||void 0===s?void 0:s.type))throw new a.uV("Unable to verify without UpdateExtendedProps type");const l=await async function(e,t){const{metaOSAppId:n,cardId:o,signature:i,verificationStatus:a,content:s}=e,{contentType:l}=t.data,d={...I(),payload:{cardId:o,contentType:l,signature:i,appId:n,serializedContent:s,verificationStatus:null!==a&&void 0!==a?a:"Unknown"}};return await g(r.VerifyCard,d)}(e,s),d=null===l||void 0===l?void 0:l.requestContext.rejectionReason;if(!l||d)throw new a.uV(null!==d&&void 0!==d?d:"Unable to verify the card!");const u=null===(t=l.payload.cards)||void 0===t?void 0:t[0];return{cards:[{cardId:null!==(n=null===u||void 0===u?void 0:u.cardId)&&void 0!==n?n:e.cardId,verificationStatus:null!==(o=null===u||void 0===u?void 0:u.verificationStatus)&&void 0!==o?o:"Error"}]}}}class C{constructor(){this.appDefinition=void 0}get MetaOSProvider(){return this}async getAppDefinition(e){if(this.appDefinition)return this.appDefinition;const t=await async function(e){const t="5b951ce3-bb72-46e1-bbf2-83ea791e4600";if(e==t&&await(0,h.x$)(A.u.OEP,"LoopSettings.EnableInternalAdoCardLoop")){const e="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgBAMAAAAQtmoLAAAAAXNSR0IArs4c6QAAABhQTFRF//////nv/u7T/ea//Nie+sp7+b1X+LI+Yaw0AwAAAchJREFUeNrtmD1zgkAQhl8gSX1qRltRsVajvRE/6kSU2hjlB0TYvx9hcG7g7ga2s+Bpuef23WWYuwENT4wzAY+XG1egE1dIJkyBboIp0Ikr0JIrxIxQYyJOKGtHRIxQdkgptUO9k+SMajyS1AhlbalAIiri76jEHyRtNX5ICp+P1fMjocSINCQiX32nFH9DWm7Z6gw1vkoSTCN6oLwthYsvAL3Q023uAjAIVqRsvhKAWXgtbe67SDELhY6DGSR6wZKr47TPSqErhwighhDKIVYJ8hPOhlhT6KVpgPpCxBWoERqhERqBJWy5AjohUwBGV6YAa+27LAE9ouTgD+oLDt1JpfVAVAjqsXVZz4RBMB+Ml2DW1wvmo5fiwHfNAnqk40pGwaYKUGbHFV7JxMWfh3QC1Lb1xK5otQ8CUNvWsxKANYSKbSqQPewDNdv+EVlg13CtV/mS11Bd23EnVK6im/04QAcauncB1oIKTPHd9Vp6wU4FwAlLwtt4rxewywRgURCCjafvAXjJBThH2TTm045JQBQjx4uUseroxrKhvMi5n021Dy12Lsgiscg+2CEMbAAUiixhu62WqQDgoID3m8YZfrjNX4Nn4h9uUmUdIB9wIwAAAABJRU5ErkJggg==";return{requestContext:{id:t},payload:{manifestVersion:"1.13",version:"1.0.0",categories:["Microsoft"],developerName:"Microsoft Corporation",developerUrl:"https://www.microsoft.com/en-us/",termsOfUseUrl:"https://www.microsoft.com/en-us/servicesagreement",privacyUrl:"https://www.microsoft.com/en-us/privacystatement",validDomains:["token.botframework.com","meec5534.azurewebsites.net"],inputExtensions:[{botId:"83b401f7-edaa-4c2d-8400-0a40b3439f9b",commands:[],messageHandlers:[{type:"Link",value:{domains:["dev.azure.com/outlookecosystemeng/*/_workitems/edit/*","outlookecosystemeng.visualstudio.com/*/_workitems/edit/*","dev.azure.com/office/*/_workitems/edit/*","office.visualstudio.com/*/_workitems/edit/*","dev.azure.com/outlookweb/*/_workitems/edit/*","outlookweb.visualstudio.com/*/_workitems/edit/*"]}}]}],showLoadingIndicator:!0,shortDescription:"Monitor and collaborate on existing work items.",longDescription:"Azure DevOps DogFood enables sharing work items with your colleagues and get previews of work items using URLs.",largeImageUrl:e,accentColor:"#1c315f",id:t,name:"ADO",smallImageUrl:e,state:"installed"}}}const n={...I(),payload:{appId:e}};return await g(r.GetAppFromAppId,n)}(e),n=null===t||void 0===t?void 0:t.requestContext.rejectionReason;if(!t||n)throw new a.uV(null!==n&&void 0!==n?n:d);const o=t.payload,i="titleId"in o?function(e){var t,n,o,i,a,s,r,l,d,u,c,p,v,w,f,h,m;const A=e.titleDefinition,g="string"===typeof e.titleId?e.titleId:e.titleId.id,y=null===A||void 0===A?void 0:A.elementDefinitions;let I,k;if(Array.isArray(y)){const e=y.find(e=>"ComposeExtensions"===e.elementType);if(null!==e&&void 0!==e&&e.definition){const t=JSON.parse(e.definition);I=Array.isArray(t)?t:[t]}}else I=null===y||void 0===y?void 0:y.composeExtensions;switch(null===e||void 0===e||null===(t=e.acquisitionState)||void 0===t?void 0:t.toLowerCase()){case"acquired":case"needsconsentforupgrade":default:k="installed";break;case"blocked":k="blocked";break;case"unacquired":k="notinstalled"}return{id:null!==(n=e.appId)&&void 0!==n?n:"",manifestVersion:null!==(o=null===A||void 0===A?void 0:A.manifestVersion)&&void 0!==o?o:"",version:null===A||void 0===A?void 0:A.version,categories:null!==(i=null===A||void 0===A?void 0:A.categories)&&void 0!==i?i:[],developerName:null!==(a=null===A||void 0===A?void 0:A.developerName)&&void 0!==a?a:"",developerUrl:null!==(s=null===A||void 0===A?void 0:A.developerUrl)&&void 0!==s?s:"",externalId:null!==(r=e.manifestId)&&void 0!==r?r:"",termsOfUseUrl:null!==(l=null===A||void 0===A?void 0:A.termsOfUseUrl)&&void 0!==l?l:"",privacyUrl:null!==(d=null===A||void 0===A?void 0:A.privacyUrl)&&void 0!==d?d:"",validDomains:null!==(u=null===A||void 0===A?void 0:A.validDomains)&&void 0!==u?u:[],isFullScreen:!1,devicePermissions:[],isFullTrust:null!==(c=null===A||void 0===A?void 0:A.isFullTrust)&&void 0!==c&&c,webApplicationInfo:null===A||void 0===A?void 0:A.webApplicationInfo,inputExtensions:I,showLoadingIndicator:null!==(p=!(null===A||void 0===A||!A.showLoadingIndicator))&&void 0!==p&&p,shortDescription:null===A||void 0===A?void 0:A.shortDescription,longDescription:null===A||void 0===A?void 0:A.longDescription,largeImageUrl:null!==(v=null===A||void 0===A||null===(w=A.iconLarge)||void 0===w?void 0:w.uri)&&void 0!==v?v:"",smallImageUrl:null!==(f=null===A||void 0===A||null===(h=A.iconSmall)||void 0===h?void 0:h.uri)&&void 0!==f?f:"",state:k,name:null!==(m=null===A||void 0===A?void 0:A.name)&&void 0!==m?m:"",titleId:g}}(o):o;return this.cacheInstalledAppDefinition(i),i}async getAppStatus(e){var t;let n=this.appDefinition;if(!n)try{n=await this.getAppDefinition(e)}catch{return"NotInstalled"}return this.getMetaOSAppInstallStatus(null===(t=n)||void 0===t?void 0:t.state)}async getAppInstalledStatus(e){let t=await this.getAppStatus(e);return t="NotAvailable"===t||"Error"===t?"Unknown":t,t}async openAuth(e,t){var n,o,i;const s=t.authUrl,l=null!==(n=t.tokenExchangeResourceUri)&&void 0!==n?n:null===(o=this.appDefinition)||void 0===o||null===(i=o.webApplicationInfo)||void 0===i?void 0:i.resource;switch(t.type){case"auth":{if(!s)throw new a.uV("No auth url found");const e=await async function(e,t){const n=function(e){var t;return{appId:null!==(t=null===e||void 0===e?void 0:e.id)&&void 0!==t?t:"",validDomains:(null===e||void 0===e?void 0:e.validDomains)||[],showTabLoadingIndicator:!(null===e||void 0===e||!e.showLoadingIndicator),version:(null===e||void 0===e?void 0:e.version)||""}}(t),o={...I(12e4),payload:{authConfigUrl:e,hubAppDefinition:n}};return await g(r.OpenAuthWindow,o)}(s.href,this.appDefinition),t=null===e||void 0===e?void 0:e.requestContext.rejectionReason;if(!e||t)throw new a.uV(null!==t&&void 0!==t?t:v);return{status:!!e.payload.success,message:e.payload.result}}case"silentAuth":{if(!l||"string"!==typeof l)throw new a.uV("No resource url found");const e=await async function(e){const t={...I(12e4),payload:{resource:e}};return await g(r.SSOToken,t)}(l),t=null===e||void 0===e?void 0:e.requestContext.rejectionReason;if(!e||t)throw new a.uV(null!==t&&void 0!==t?t:v);return e.payload.success?{status:!0,message:e.payload.result}:{status:!1}}default:return{status:!1}}}async installApp(e){var t;const n=await async function(e){const t={...I(3e5),payload:{appId:e}};return await g(r.InstallApp,t)}(e);return null!==n&&void 0!==n&&null!==(t=n.payload)&&void 0!==t&&t.success?"Installed":"NotInstalled"}async openStageView(e){if(!this.appDefinition)throw new a.uV(d);await async function(e,t){var n;const o={...I(s),payload:{appId:null!==(n=t.appId)&&void 0!==n?n:t.deepLinkAppId,botId:e,...t.stageInfo}};await g(r.OpenStageView,o)}(this.getBotId(),e)}async launchTaskModule(e){var t;if(!this.appDefinition)throw new a.uV(d);await async function(e,t){const n={...I(s),payload:{appId:t.appId,botId:e,...t.taskInfo}};await g(r.OpenTaskModule,n)}(this.getBotId(),e),null===(t=e.onDismiss)||void 0===t||t.call(e)}cacheInstalledAppDefinition(e){"Installed"===this.getMetaOSAppInstallStatus(e.state)&&(this.appDefinition=e)}getMetaOSAppInstallStatus(e){switch(null===e||void 0===e?void 0:e.toLowerCase()){case"adminpreinstalled":case"featured":case"installed":case"installedanddeprecated":case"installedandhidden":case"installedandpermanent":case"preconsented":default:return"Installed";case"blocked":return"Unknown";case"notinstalled":return"NotInstalled"}}getBotId(){var e,t,n,o;return null!==(e=null===(t=this.appDefinition)||void 0===t||null===(n=t.inputExtensions)||void 0===n||null===(o=n[0])||void 0===o?void 0:o.botId)&&void 0!==e?e:""}}class b{get UrlHandlerProvider(){return this}async onClick(e){return await async function(e){const t={...I(),payload:{url:e}};await g(r.OpenUrlAction,t)}(e.href),!0}}var S=n(56142),x=n(65043),V=n(97950),D=n(44104);function E(){return new U}function O(){return new C}async function N(){let e;return await(0,A.tT)()?((0,S.Rm)("Using CDN code loader."),window||(0,S.Rm)("Unable to prepare external dependencies. Window is not defined."),window.React=x,window.ReactDOM=V,window.LoopSDK=D,e=o.A):((0,S.Rm)("Using NPM code loader."),e=i.C),e}function R(){return new b}}}]);
//# sourceMappingURL=fluidHost-cardLoop.f6ac0b1c.chunk.js.map