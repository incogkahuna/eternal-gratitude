(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[3642],{8842:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var s=r(75992);class n extends s.r{loggingData(){return{isFallBack:String(this.suiteNavModel.UseFallbackShell)}}constructor(e){super(n.actionType),this.suiteNavModel=e}}n.actionType="GET_SUITENAV_SUCCEEDED"},14740:e=>{e.exports=function(e){for(var t=-1,r=null==e?0:e.length,s=0,n=[];++t<r;){var i=e[t];i&&(n[s++]=i)}return n}},29274:(e,t,r)=>{"use strict";r.d(t,{S:()=>i});var s=r(75992),n=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),i=function(e){function t(r,s,n){var i=e.call(this,t.type)||this;return i.name=r,i.id=s,i.additionalData=n,i}return n(t,e),t.prototype.loggingData=function(){return{name:this.name,id:this.id}},t.type="BEGIN_TRANSACTION",t}(s.r)},33414:(e,t,r)=>{"use strict";r.d(t,{e:()=>n});var s=r(32512);class n extends s.v{constructor(e,t,r){super(n.actionType,e,t,r)}}n.actionType="PLW_GET_SENSITIVITYLABELS_FAILED"},39202:(e,t,r)=>{"use strict";r.d(t,{K:()=>n});var s=r(75992);class n extends s.r{constructor(e){super(n.actionType),this.sensitivityLabels=e}}n.actionType="PLW_GET_SENSITIVITYLABELS_SUCCEEDED"},47204:(e,t,r)=>{"use strict";r.d(t,{Y:()=>i});var s=r(75992),n=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),i=function(e){function t(r,s,n){var i=e.call(this,t.type)||this;return i.id=r,i.errorMessage=s,i.additionalData=n,i}return n(t,e),t.prototype.loggingData=function(){return{errorMessage:this.errorMessage,id:this.id}},t.type="TRANSACTION_FAILED",t}(s.r)},48170:(e,t,r)=>{"use strict";r.d(t,{Y:()=>n});var s=r(75992);class n extends s.r{constructor(e){super(n.actionType),this.sensitivityPolicySettings=e}}n.actionType="PLW_GET_SENSITIVITYPOLICYSETTINGS_SUCCEEDED"},54439:(e,t,r)=>{"use strict";r.d(t,{j:()=>l});var s=r(29274),n=r(74427),i=r(57860),o=r(47204),a=r(74568),c=r(79947);class l{static beginTransaction(e,t,r){let{transactionId:n,name:i,logQos:o,action:c,additionalData:g}=t;if(!0===o){const e=new a.W({name:"Tx:"+i},r);l.qosEventsInFlight[n]=e}e.batchDispatchActions(new s.S(i,n,g),c)}static cancelTransaction(e,t){let{transactionId:r,action:s,additionalData:i}=t;const o=l.qosEventsInFlight[r];o&&(o.end({resultType:c.f.ExpectedFailure,extraData:i}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(s,new n.D(r,i))}static completeTransaction(e,t){let{transactionId:r,action:s,additionalData:n}=t;const o=l.qosEventsInFlight[r];o&&(o.end({resultType:c.f.Success,extraData:n}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(s,new i.M(r,n))}static completeTransactionWithBatch(e,t){let{transactionId:r,actions:s,additionalData:n}=t;const o=l.qosEventsInFlight[r];o&&(o.end({resultType:c.f.Success,extraData:n}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(...s,new i.M(r,n))}static completeTransactionWithError(e,t){let{transactionId:r,errorMessage:s,action:n,additionalData:i}=t;const a=l.qosEventsInFlight[r];a&&(a.end({resultType:c.f.Failure,error:s,extraData:i}),delete l.qosEventsInFlight[r]),e.batchDispatchActions(n,new o.Y(r,s,i))}}l.qosEventsInFlight={}},57860:(e,t,r)=>{"use strict";r.d(t,{M:()=>i});var s=r(75992),n=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),i=function(e){function t(r,s){var n=e.call(this,t.type)||this;return n.id=r,n.additionalData=s,n}return n(t,e),t.prototype.loggingData=function(){return{id:this.id}},t.type="TRANSACTION_SUCEEDED",t}(s.r)},64805:(e,t,r)=>{"use strict";r.d(t,{J:()=>n});class s{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,r){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=r}}class n extends s{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,r,s,n){super(e,s,n),this.webApiProviders=t,this.stores=r}}},73438:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(32512);class n extends s.v{constructor(e,t,r){super(n.actionType,e,t,r)}}n.actionType="PLW_GET_SENSITIVITYPOLICYSETTINGS_FAILED"},74427:(e,t,r)=>{"use strict";r.d(t,{D:()=>i});var s=r(75992),n=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},e(t,r)};return function(t,r){function s(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(s.prototype=r.prototype,new s)}}(),i=function(e){function t(r,s){var n=e.call(this,t.type)||this;return n.id=r,n.additionalData=s,n}return n(t,e),t.prototype.loggingData=function(){return{id:this.id}},t.type="CANCEL_TRANSACTION",t}(s.r)},76043:(e,t,r)=>{"use strict";r.r(t),r.d(t,{UserModule:()=>M});var s=r(55057),n=r(62455),i=r(8321),o=r(38361),a=r(47454),c=r(32512);class l extends c.v{constructor(e,t,r){super(l.actionType,e,t,r)}}l.actionType="PLW_RESOLVE_USERS_FAILED";var g=r(88928),h=r(87920),u=r(19333),d=r(42784),p=r(15548);class y extends c.v{constructor(e,t,r){super(y.actionType,e,t,r)}}y.actionType="PLW_GET_USERSFORPLANCONTAINER_FAILED";var f,T=r(39202),v=r(33414),I=r(48170),A=r(73438),P=r(8842),S=r(92446),U=r(38752),w=r(78332),b=r(99908),F=r(64805),k=r(9962),D=r(74844),L=r(65818),E=r(91246),C=r(37084),_=r.n(C),m=r(14740),x=r.n(m),$=r(54320),V=r.n($),j=r(77508);!function(e){e.PlannerGov="5b4ef465-7ea1-459a-9f91-033317755a51",e.PlannerProd="b737dad2-2f6c-4c65-90e3-ca563267e8b9"}(f||(f={}));var W=r(79537);function N(e,t,r){return e===b.b.Planner?function(e){if(V()(e))return b.h.Invalid;let t=b.h.Invalid;for(const r of e)for(const e of r.servicePlans)if(e.servicePlanId===f.PlannerProd||e.servicePlanId===f.PlannerGov){if("Disabled"===e.provisioningStatus)return b.h.Invalid;if("Success"===e.provisioningStatus){t=b.h.ReadWrite;break}}return t}(t):(W.f.unreachableCase(e,e=>{r.logTrace(507778504,D.k.Warning,e)}),b.h.Invalid)}var O=r(98502),B=r(25290),R=r(54439),G=r(82841);class M extends F.J{get name(){return"UserModule"}async fetchCurrentUserDetailsAsync(e){this.loggers.traceLogger.logTrace(507896973,D.k.Verbose,"Get Current User Details");let t=e=>this.stores.userStore.getUserDetailsById(U.B.currentUserId);e&&(t=void 0);try{const e=await this.webApiProviders.taskService(),r=await e.getCurrentUserDetailsAsync({},t);return this.loggers.traceLogger.logTrace(507896972,D.k.Verbose,"Get Current User Details - Success"),r}catch(r){const e=r;return this.loggers.traceLogger.logTrace(507896971,D.k.Warning,`Get Current User Details - Failure ${(0,G.s8)(e)}`),Promise.reject(e)}}async fetchUserLicensesAsync(e,t){this.loggers.traceLogger.logTrace(507896970,D.k.Verbose,`Fetch User Licenses [requestPriority=${t}]`);try{const r=await this.webApiProviders.taskService(),n=await r.getLicensesForUser({userId:e},void 0,void 0,t),i={Planner:N(b.b.Planner,n,this.loggers.traceLogger)};return this.dispatcher.dispatchAction(new s.i(e,i)),i}catch(r){const t=r;return this.loggers.traceLogger.logTrace(507896969,D.k.Warning,`Fetch User Licenses - Failure ${(0,G.s8)(t)}`),this.dispatcher.dispatchAction(new n.g(e,t.response,t.response?.statusText??"",t.error?.message??"")),Promise.reject(t)}}async fetchUserAsync(e,t){this.loggers.traceLogger.logTrace(507896968,D.k.Verbose,`Get User [Force=${t}]`);let r=e=>{const t=this.stores.userStore.getUserById(e.userId);return null==t?null:t};t&&(r=void 0);try{const s=await this.webApiProviders.graph(),n=await s.getUserAsync({userId:e},r);return this.loggers.traceLogger.logTrace(507896967,D.k.Verbose,`Get User - Success [Force=${t}]`),this.dispatcher.dispatchAction(new i.A([n])),n}catch(s){const e=s;return this.loggers.traceLogger.logTrace(507896966,D.k.Warning,`Get User - Failure ${(0,G.s8)(e)}`),Promise.reject(e)}}async fetchUserPhotoAsync(e){if(this.loggers.traceLogger.logTrace(507896965,D.k.Verbose,"Fetch User Photo"),!(0,B.W_)(e.id))return Promise.reject(O.g.generateAjaxClientError(null,"User ID is not a GUID"));const t=e=>{const t=this.stores.userStore.getUserPhotoById(e.user.id);return t===j.S1.Photo?null:t},r=this.getCurrentViewIds();try{const s=await this.webApiProviders.graph(),n=await s.getUserPhoto({user:e},t,r);if(null!=n&&""!==n){this.loggers.traceLogger.logTrace(507896964,D.k.Verbose,"Fetch User Photo - Success");const t={};return t[e.id]=n,this.dispatcher.dispatchAction(new o.c(t)),n}{this.loggers.traceLogger.logTrace(507896963,D.k.Info,"Fetch User Photo - Failure [Reason=empty photo]");const t=O.g.generateAjaxClientError(null,"No image was returned for user thumbnail");return this.dispatcher.dispatchAction(new a.P(e.id,t.response,t.response?.statusText??"",t.error?.message??"")),Promise.reject(t)}}catch(s){const e=s;return this.loggers.traceLogger.logTrace(507896962,D.k.Warning,`Fetch User Photo - Failure ${(0,G.s8)(e)}`),Promise.reject(e)}}async fetchUsersAsync(e,t){const r=this.stores.appContextStore.getApiBatchLimits().ResolveUsersMaxBatchSize??25;if(this.loggers.traceLogger.logTrace(507896961,D.k.Verbose,`Batch Fetching Users [Number=${e.length}][Force=${t??!1}][BatchSize=${r}]`),0===e.length)return[];const s=t?[]:x()(e.map(e=>this.stores.userStore.getUserById(e)));if(s.length===e.length)return s;const n=t?e:e.filter(e=>null==this.stores.userStore.getUserById(e));let o,a;if(!t){o=e=>{const t=x()(e.userIds.map(e=>this.stores.userStore.getUserById(e)));return t.length===e.userIds.length?t:null};const e=this.stores.appContextStore.getCurrentViewId();a=e?[e]:void 0}const c=await this.webApiProviders.graph(),g=[];_()(n,r).forEach(e=>{g.push(c.resolveUsersAsync({userIds:e},o,a).then(e=>(this.dispatcher.dispatchAction(new i.A(e)),e)))});try{const t=await Promise.all(g);let r=[];return t.forEach(e=>{r=r.concat(e)}),r=r.concat(s),this.loggers.traceLogger.logTrace(507896960,D.k.Verbose,`Batch Fetching Users - Success [Unresolved Count=${e.length-r.length}]`),r}catch(h){const e=h;return this.loggers.traceLogger.logTrace(507896931,D.k.Warning,`Batch Fetching Users - Failure ${(0,G.s8)(e)}`),this.dispatcher.dispatchAction(new l(e.response,e.response?.statusText??"",e.error?.message??"")),Promise.reject(e)}}fetchUsersForContainerAsync(e,t,r){return this.fetchUsersForContainerRecursiveAsync([],e,t,r)}async fetchUsersWithKeyword(e){this.loggers.traceLogger.logTrace(507896930,D.k.Verbose,"Fetching Users With Keyword");try{const t=await this.webApiProviders.taskService(),r=await t.getFilteredTenantUsersByKeyword({keyword:e});return this.loggers.traceLogger.logTrace(507896929,D.k.Verbose,"Fetching Users With Keyword - Success"),this.dispatcher.dispatchAction(new i.A(r)),r}catch(t){const e=t;return this.loggers.traceLogger.logTrace(507896928,D.k.Warning,`Fetching Users With Keyword - Failure ${(0,G.s8)(e)}`),Promise.reject(e)}}async fetchUserAccessibleSensitivityLabelsAsync(){this.loggers.traceLogger.logTrace(507896927,D.k.Verbose,`Fetching all sensitivity labels exposed to the user [TenantId=${U.B.tenantId}]`);const e=this.stores.tenantStore.getCurrentSensitivityLabels();if(null!=e)return this.loggers.traceLogger.logTrace(507896926,D.k.Verbose,`Fetching all sensitivity labels exposed to the user - Cache Hit [TenantId=${U.B.tenantId}]`),e;try{const e=await this.webApiProviders.taskService(),t=await e.getSensitivityLabelsAsync();return this.loggers.traceLogger.logTrace(507896925,D.k.Verbose,`Fetching all sensitivity labels exposed to the user - Success [TenantId=${U.B.tenantId}]`),this.dispatcher.dispatchAction(new T.K(t)),t}catch(t){const e=t;return this.loggers.traceLogger.logTrace(507896924,D.k.Warning,`Fetching all sensitivity labels exposed to the user - Failure [TenantId=${U.B.tenantId}]${(0,G.s8)(e)}`),this.dispatcher.dispatchAction(new v.e(e.response,e.response?.statusText??"",e.error?.message??"")),Promise.reject(e)}}async fetchUserAccessibleSensitivityPolicySettingsAsync(){this.loggers.traceLogger.logTrace(507896923,D.k.Verbose,`Fetching sensitivity policy settings exposed to the user [TenantId=${U.B.tenantId}]`);const e=this.stores.tenantStore.getCurrentSensitivityPolicySettings();if(null!=e)return this.loggers.traceLogger.logTrace(507896922,D.k.Verbose,`Fetching sensitivity policy settings exposed to the user - Cache Hit [TenantId=${U.B.tenantId}]`),e;try{const e=await this.webApiProviders.taskService(),t=await e.getSensitivityPolicySettingsAsync();return this.loggers.traceLogger.logTrace(507896921,D.k.Verbose,`Fetching sensitivity policy settings exposed to the user - Success [TenantId=${U.B.tenantId}]`),this.dispatcher.dispatchAction(new I.Y(t)),t}catch(t){const e=t;return this.loggers.traceLogger.logTrace(507896920,D.k.Warning,`Fetching sensitivity policy settings exposed to the user - Failure [TenantId=${U.B.tenantId}]${(0,G.s8)(e)}`),this.dispatcher.dispatchAction(new A.A(e.response,e.response?.statusText??"",e.error?.message??"")),Promise.reject(e)}}async removeDeletedPlansFromUserDetailsAsync(e){this.loggers.traceLogger.logTrace(507896919,D.k.Verbose,"Remove Deleted Plans From User Details");const t=this.stores.userStore.getCurrentUserDetails();let r=t;e.forEach(e=>{null!=r.favoritePlans.references[e]&&(r=r.removeFavoritePlan(e)),null!=r.recentPlans.references[e]&&(r=r.removeRecentPlan(e))});try{const e=await this.updateUserDetailsAsync(t,r);return this.loggers.traceLogger.logTrace(507896918,D.k.Verbose,"Remove Deleted Plans From User Details Success"),e}catch(s){const e=s;return this.loggers.traceLogger.logTrace(507896917,D.k.Warning,`Remove Deleted Plans From User Details Failure ${(0,G.s8)(e)}`),Promise.reject(e)}}async updateUserDetailsAsync(e,t){this.loggers.traceLogger.logTrace(507896916,D.k.Verbose,"Updating user details");const r=e.getDiff(t);let s,n,i;if(r?.recentPlans){const r=Object.keys(e.recentPlans.references).length,o=Object.keys(t.recentPlans.references).length;if(r>o){for(const s in e.recentPlans.references)if(null==t.recentPlans.references[s]){n=s;break}}else if(r<o){for(const n in t.recentPlans.references)if(null==e.recentPlans.references[n]){s={planId:n,title:t.recentPlans.references[n].title,lastAccess:t.recentPlans.references[n].lastAccess};break}}else for(const s in t.recentPlans.references){const r={},n=e.recentPlans.references[s],o=t.recentPlans.references[s];if(n.title!==o.title&&(r.title=o.title),n.lastAccess.getTime()!==o.lastAccess.getTime()&&(r.lastAccess=o.lastAccess),!V()(r)){i={key:s,diff:r};break}}}if(!r||V()(r))return this.loggers.traceLogger.logTrace(507896912,D.k.Verbose,"Updating user details - Success [ApiCall=false]"),t;{const a=E.o.generate(),c=new g.h(t,a),l=e.id+w.Ek.UpdateUserDetails;R.j.beginTransaction(this.dispatcher,{name:"updateUserDetails",transactionId:l,action:c},this.loggers.logHandler);try{const o=await this.webApiProviders.taskService(),c=await o.updateUserDetailsAsync({originalUserDetails:e,updatedUserDetails:t},e=>{const t=this.stores.userStore.getUserDetailsByIdWithoutPendingUpdates(e.originalUserDetails.id);if(!t)throw this.loggers.traceLogger.logTrace(507896915,D.k.Warning,"User details not found in store while updating"),O.g.generateAjaxClientError(null,new k.m("storeOriginalDetails","userStore"));let o=t.applyDiffs(r);if(r?.recentPlans)if(o=o.setProperty("recentPlans",t.recentPlans),s)o=o.setRecentPlan(s.planId,s.lastAccess,s.title);else if(n)o=o.removeRecentPlan(n);else if(i){const e=o.recentPlans.references[i.key];o=o.setRecentPlan(i.key,i.diff.lastAccess??e.lastAccess,i.diff.title??e.title)}return{originalUserDetails:t,updatedUserDetails:o}});return this.loggers.traceLogger.logTrace(507896914,D.k.Verbose,"Updating user details - Success [ApiCall=true]"),R.j.completeTransaction(this.dispatcher,{transactionId:l,action:new h.w(c,a)}),c}catch(o){const t=o;this.loggers.traceLogger.logTrace(507896913,D.k.Warning,`Updating User Details - Failure ${(0,G.s8)(t)}`);const r=new u.k(e,a,t.response,t.response?.statusText??"",t.error?.message??"");return R.j.completeTransactionWithError(this.dispatcher,{transactionId:l,errorMessage:"",action:r}),Promise.reject(t)}}}async fetchSuiteNav(e){this.loggers.traceLogger.logTrace(507896908,D.k.Verbose,`Fetch SuiteNav [Culture=${e}]`);try{const t=await this.webApiProviders.taskService(),r=await t.getSuiteNav({culture:e});return this.dispatcher.dispatchAction(new P.f(r)),this.loggers.traceLogger.logTrace(507896907,D.k.Verbose,`Fetch SuiteNav - Success [Culture=${e}]`),r}catch(t){const r=t;return this.dispatcher.dispatchAction(new S.f(r.response,r.response?.statusText??"",r.error?.message??"")),this.loggers.traceLogger.logTrace(507896906,D.k.Warning,`Fetch SuiteNav - Fail [Culture=${e}] ${(0,G.s8)(t)}`),Promise.reject(r)}}async fetchUsersForContainerRecursiveAsync(e,t,r,s){if(t.containerType===L.K.User){const r=this.stores.userStore.getCurrentUser();return this.dispatcher.batchDispatchActions(new d.F(t.externalId,[r],!0),new p.x(t.externalId,1)),e.push(r),e}this.loggers.traceLogger.logTrace(507896905,D.k.Verbose,`Fetching Users for Container [containerId=${t.externalId}][containerType=${t.containerType}][Force=${s??!1}]`);let n=e=>{if(this.stores.userStore.getLoadingContainerUsersComplete(e.container.externalId)){const t=this.stores.userStore.getContainerUsers(e.container.externalId);if(null!=t)return{data:t}}return null},i=this.getCurrentViewIds();s&&(n=void 0,i=void 0);try{const o=await this.webApiProviders.graph(),a=await o.getMembersOfContainerAsync({container:t,skipToken:r},n,i),c=a.data;if(this.dispatcher.dispatchAction(new d.F(t.externalId,c,null==r)),e.push(...c),this.loggers.traceLogger.logTrace(507896904,D.k.Verbose,`Fetching Users for Container - Success [containerId=${t.externalId}][containerType=${t.containerType}][Force=${s??!1}]`),null!=a.skipToken&&""!==a.skipToken)return this.fetchUsersForContainerRecursiveAsync(e,t,a.skipToken,s);{const r=this.stores.userStore.getContainerUsers(t.externalId),s=null!=r?r.length:0;return this.dispatcher.dispatchAction(new p.x(t.externalId,s)),e}}catch(o){const e=o;return this.dispatcher.dispatchAction(new y(e.response,e.response?.statusText??"",e.error?.message??"")),this.loggers.traceLogger.logTrace(507896903,D.k.Warning,`Fetching Users for Container [containerId=${t.externalId}][containerType=${t.containerType}][Force=${s??!1}]${(0,G.s8)(e)}`),Promise.reject(e)}}}},92446:(e,t,r)=>{"use strict";r.d(t,{f:()=>n});var s=r(32512);class n extends s.v{constructor(e,t,r){super(n.actionType,e,t,r)}}n.actionType="GET_SUITENAV_FAILED"}}]);
//# sourceMappingURL=usermodule.5eb5b715.chunk.js.map