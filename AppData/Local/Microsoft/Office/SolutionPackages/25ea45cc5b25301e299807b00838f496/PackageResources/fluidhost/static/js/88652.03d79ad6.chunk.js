"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[88652],{6766:(e,t,r)=>{r.d(t,{yO:()=>$,GB:()=>A,Ic:()=>M,_5:()=>G,LL:()=>j,tD:()=>F,iO:()=>O,zY:()=>z,zq:()=>R});var o=r(70579),n=r(65043),i=r(84391),s=r(4563),a=r(75460),l=r(29018),p=r(60835),d=r(8088),c=r(87416),h=r(53015),u=r(78632),m=r(74043),g=r(28014);const f=()=>null;var v=r(83545),I=r(48043),P=r(12406);let y;const S=e=>r(97959)(`./${e}/ShareServiceStrings.json`);function C(e){return function(e,t){return y?.locale!==t&&(y={locale:t,stringTablePromise:e(t).then(e=>(0,P.$)(e,t)).catch(e=>{throw y=void 0,e})}),y.stringTablePromise}(S,e)}var U=r(60257),k=r(33788),N=r(95996);function T(e,t,r,o,n,i,s){const a=function(e){switch(e){case m.n.default:return"DefaultShare";case m.n.copyLink:return"CopyLink";case m.n.atMention:return"AtMention";case m.n.addPeople:return"AddPeople";case m.n.linkSettings:return"LinkSettings";case m.n.manageAccess:return"ManageAccess";case m.n.notify:return"Notify";default:return"OtherShareMode"}}(t),l=k.m.start(v.Il.CompleteShare,e);(0,N.Ot)(e,{eventName:v.Sz.ShareDialogOpened,entrypoint:a,sharePointCorrelationId:i}),o.then(t=>{l.setResult(!0,{shared:t,entrypoint:a,sharePointCorrelationId:i,...s}),t&&(0,N.o4)(e,{eventName:v.ay.ShareDocument,entrypoint:a})}).catch(e=>{l.setResult(!1,{entrypoint:a,sharePointCorrelationId:i,errorType:e.errorType||v.NN.UnknownShareError,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory,...s},e)});const p=k.m.start(v.Il.RenderShare,e);r.then(e=>{p.setResult(!0,{rendered:e,entrypoint:a,sharePointCorrelationId:i,...w(n,p.startTime)})}).catch(e=>{p.setResult(!1,{entrypoint:a,sharePointCorrelationId:i,errorType:e.errorType||v.NN.UnknownShareError,spoError:e.spoError,spoErrorCategory:e.spoErrorCategory,...w(n,p.startTime)},e)})}function w(e,t){return{payloadLoadStartTime:(0,U.q)(e.payloadLoadStartTime,t),payloadLoadEndTime:(0,U.q)(e.payloadLoadEndTime,t),payloadSendStartTime:(0,U.q)(e.payloadSendStartTime,t),sharePointLoadStartTime:(0,U.q)(e.sharePointLoadStartTime,t)}}const E=/^var\((--[\w-]+)(?:,.*)?\)$/;function D(e,t){if(t)return Object.fromEntries(Object.entries(t).map(t=>{let[r,o]=t;const n=r;let i=o;const s=E.exec(o);if(s){const[,t]=s;i=e().getPropertyValue(t)}return[n,i]}))}var L=r(99671);var b=r(32935);function x(e){return"Consumer"===e.identityType}function O(e){return!!x(e)||"Enterprise"!==e.identityType}function z(e){const t={},s={},l=new a.c,p=new a.c,{shareUXConfig:d,localization:c,logger:h,correlationId:P}=e,y=d?.shareMode||m.n.default,S=P||crypto.randomUUID();h&&T(h,y,p,l,t,S,s);const U=(0,b.U)(e.settingsProvider);(0,u.t)(U,[p,l]).then(e=>{if(e){const e=new I.QW(v.NN.IframeLoadTimeoutError);F(p,l,e)}}).catch(()=>{});try{t.payloadLoadStartTime=performance.now();let{theme:a,themeProperties:h,target:u}=d?.shareControl?.props??{theme:void 0,themeProperties:void 0};!a&&h&&(a=(0,g.x)(h),d.shareControl.props.theme=a);const{shareControl:m,setFocusOnDismiss:v}=d??{shareControl:void 0,setFocusOnDismiss:void 0};m?.props?.theme?.palette&&(m.props.theme.palette.themeLighterAlt=m.props.theme.palette.neutralLighterAlt,m.props.theme.palette.themeLight=m.props.theme.palette.neutralLight,m.props.theme.palette.themeDarkAlt=m.props.theme.palette.neutralDark);const I=()=>{const e=s.odspShareCompletedReceived||!1;s.userDismissedShare=!e,function(e,t,r){e.resolve(r),t.resolve(r)}(p,l,e),v?.()},P=u||document.createElement("div"),U=(0,i.H)(P);if("Callout"===m?.type){const i=n.lazy(()=>async function(e){const[t,n]=await Promise.all([C(e),Promise.all([r.e(72567),r.e(9444)]).then(r.bind(r,57864))]);return{default:e=>(0,o.jsx)(n.ShareCalloutRenderer,{stringTable:t,...e})}}(c.locale));U.render((0,o.jsx)(n.Suspense,{fallback:(0,o.jsx)(f,{}),children:(0,o.jsx)(i,{onRenderPromise:p,onCompletePromise:l,onDismissCallout:I,perfMarks:t,localization:c,calloutProps:m.props,showShareProps:{...e,correlationId:S},shareMode:y,shareTelemetryProps:s})}))}else{const i=n.lazy(()=>async function(e){const[t,n]=await Promise.all([C(e),Promise.all([r.e(46441),r.e(72567),r.e(94680)]).then(r.bind(r,50780))]);return{default:e=>(0,o.jsx)(n.ShareDialogRenderer,{stringTable:t,...e})}}(c.locale));U.render((0,o.jsx)(n.Suspense,{fallback:(0,o.jsx)(f,{}),children:(0,o.jsx)(i,{onRenderPromise:p,onCompletePromise:l,onDismissDialog:I,perfMarks:t,shareMode:y,localization:c,dialogProps:m?.props,showShareProps:{...e,correlationId:S},shareTelemetryProps:s})}))}}catch(k){F(p,l,k)}return l}function R(e,t,r){const[o,i]=n.useState(new a.c);return n.useEffect(()=>{const o=document.createElement("div");document.body.append(o);const n=function(e,t){let r;const o=()=>(r||(r=getComputedStyle(e)),r);return{palette:D(o,t.palette),semanticColors:D(o,t.semanticColors)}}(o,t?(0,s.z)(e,t):e);o.remove(),i(async function(e,t){const{shareUXConfig:r,defaultRecipients:o,fileId:n,driveId:i,siteUrl:s,tenantId:a,tokenProvider:u,logger:g,dataStorePath:f,appName:P,containerPackageName:y,sharingContext:S,navPayloadOptions:C,correlationId:U,settingsProvider:k}=e,T=r?.shareMode||m.n.default;if(!s||!i||!n)throw new I.QW(v.NN.GeneratePayloadError,"File information is missing");if("UnauthenticatedGuest"===u.identityType)throw new I.QW(v.NN.GeneratePayloadError,"UnauthenticatedGuest user is not allowed to use share functionality");const w=x(u),E=(0,l.$)(s),[D,O,z]=await Promise.all([r?.fileName?(0,p.sN)(u,s,i,n,g,a).then(e=>({name:r.fileName,sharepointIds:e})):(0,p.OF)(u,s,i,n,g,a),u.getToken([`${E}/files.readwrite.all`],{tenantId:a,request:null}),w?Promise.resolve(""):(0,d.js)(u,k.audience,g)]);if(!D?.name||!D.sharepointIds)throw new I.QW(v.NN.GeneratePayloadError,"Failed to fetch file info");const R=O.token,F=void 0!==f?{siteUrl:s,driveId:i,itemId:n,dataStorePath:f,appName:P,containerPackageName:y,context:S}:void 0,j=(0,b.D)(k),M=void 0!==F?function(e,t){const r=(0,L.kt)(e);if(t.includeFluidSignature)return r;const o=new URLSearchParams(atob(r));return o.delete("fluid"),btoa(o.toString())}(F,C||{includeFluidSignature:!0}):void 0;g&&(0,N.Ot)(g,{eventName:"ShareServiceConstructNavId",navIdLength:M?.length,navIdDecodedLength:M?atob(M).length:void 0});const $={mode:T,authToken:R,clientId:"fluid",itemName:j?void 0:D.name,isFolder:!1,isODB:E.indexOf(`${c.p7}.`)>0,organizationName:(0,h.E)(z)?"":z,webAbsoluteUrl:s,correlationId:U,navId:M,listId:D.sharepointIds.listId,listItemId:D.sharepointIds.listItemId,theme:t};o&&($.defaultRecipients=o,$.accessChecked=!0);return $}(r,n))},[e,t,r]),o}function F(e,t,r){e.reject(r),t.reject(r)}function j(e){return!!e&&"shareMode"in e}const M=320,$=500,A=92;function G(e){return Math.min(window.innerWidth,e)}},32935:(e,t,r)=>{r.d(t,{D:()=>i,U:()=>s});var o=r(48680);const n={dropItemNameFromPayload:"share.dropItemNameFromPayload",shareTimeout:"share.shareTimeoutInMs"};function i(e){return(0,o.AU)(n.dropItemNameFromPayload,!0,e)}function s(e){return(0,o.AU)(n.shareTimeout,45e3,e)}},48043:(e,t,r)=>{r.d(t,{QW:()=>o,yp:()=>n});class o extends Error{constructor(e,t,r,o){super(t||e),this.errorType=e,this.spoError=r,this.spoErrorCategory=o}}const n={Loading:"Loading",Loaded:"Loaded",Error:"Error"}},83545:(e,t,r)=>{r.d(t,{Il:()=>n,NN:()=>i,Sz:()=>s,ay:()=>o});const o={ShareDocument:"ShareDocument"},n={RenderShare:"RenderShare",CompleteShare:"CompleteShare"},i={GeneratePayloadError:"GeneratePayloadError",SpoShareError:"SpoShareError",SpoTimeoutError:"SpoTimeoutError",IframeLoadTimeoutError:"IframeLoadTimeoutError",UnknownShareError:"UnknownShareError",FluentUiError:"FluentUiError"},s={ShareDialogOpened:"ShareDialogOpened"}},88652:(e,t,r)=>{r.r(t),r.d(t,{SharepointShareService:()=>f});var o=r(74043),n=r(52563),i=r(60835),s=r(95996);const a="GetDocumentInfoError",l=(e,t,r)=>{if(!t)return r&&(0,s.Ot)(r,{eventName:a}),e;if(!(0,i.g2)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return r&&(0,s.hO)(r,{eventName:a},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:t.codeHint?.containerPackageName}};var p=r(6766),d=r(33788),c=r(29018),h=r(72376),u=r(40635),m=r(74405);const g=async(e,t,r,o,n)=>{const i="CheckDocumentAccess",s=d.m.start(i,o);try{const a=(0,c.$)(t.siteUrl),l={getToken:e=>{if(e){const o={...e,siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId};return r.getToken([`${a}/files.readwrite.all`],o)}throw Error("Options must be specified")},url:`${a}/_api/v2.1/drives/${t.driveId}/items/${t.itemId}/oneDrive.checkAccess`,tenantId:n,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:e.userPrincipalName,objectId:e.id}]})},retryPolicy:h._9,tokenPolicy:(0,h.N$)(r,!1)},p=o?await(0,u.g)({...l,logger:o,nameForLogging:i,getAdditionalProps:async(e,t)=>(0,m.u)(e)}):await(0,u.y)(l),d=await p.result.json();return s.setResult(!0),d?.value?.[0]?.canWrite}catch(a){throw s.setResult(!1,{errorType:"CheckDocumentAccessError"}),a}};class f{constructor(e){this.props=e,this.localization="InternationalizationContext"in e.localization?function(e){let t;return{get locale(){return t?.uiLocale!==e.uiLocale&&(t={locale:(0,n.rv)(e.uiLocale),uiLocale:e.uiLocale}),t.locale},get localeDirection(){return e.defaultContentDirection}}}(e.localization):e.localization}get Disposable(){return this}dispose(){}get ShareService(){return this}async checkUserAccess(e){let{resolvedUrl:t,userPrincipalName:r}=e;const o=l(this.props.bootDocumentInfo,t,this.props.logger);return g({userPrincipalName:r,name:""},o,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantPermissions(e){let{resolvedUrl:t,userPrincipalNames:r,uxConfiguration:n}=e;const i=l(this.props.bootDocumentInfo,t,this.props.logger),s=this.resolveShareUXConfig(n,{shareMode:o.n.atMention}),a=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,p.zY)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,defaultRecipients:r,...i,fileId:i.itemId,shareUXConfig:s,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(a):void 0})}async checkRecipientAccess(e){let{resolvedUrl:t,recipient:r}=e;const o=l(this.props.bootDocumentInfo,t,this.props.logger);return g(r,o,this.props.tokenProvider,this.props.logger,this.props.tenantId)}async grantRecipientsPermission(e){let{resolvedUrl:t,recipients:r,uxConfiguration:n}=e;const i=l(this.props.bootDocumentInfo,t,this.props.logger),s=this.resolveShareUXConfig(n,{shareMode:o.n.atMention}),a=r.map(e=>e.id?e.id:e.userPrincipalName),d=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t);return(0,p.zY)({tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,defaultRecipients:a,...i,fileId:i.itemId,shareUXConfig:s,tenantId:this.props.tenantId,appName:this.props.appName,sharingContext:this.props.getFileContext?await this.props.getFileContext(d):void 0})}async shareLink(e){let{resolvedUrl:t,componentPath:r,navPayloadOptions:n,uxConfiguration:i,sharingContext:s}=e;const a=this.convertResolvedUrlToOdspUrlParts(this.props.bootDocumentInfo,t),d=this.resolveShareUXConfig(i,{shareMode:o.n.copyLink}),c={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,shareUXConfig:d,tenantId:this.props.tenantId};if(void 0===r){const e=l(this.props.bootDocumentInfo,t,this.props.logger);return(0,p.zY)({...c,...e,fileId:e.itemId})}const h=this.getComponentLocator(r,t);return(0,p.zY)({...c,...h,sharingContext:s??(this.props.getFileContext?await this.props.getFileContext(a,r):void 0),navPayloadOptions:n,fileId:h.itemId})}async generateShareLink(e){let{odspUrlParts:t,containerPackageName:r,componentPath:n,navPayloadOptions:i,uxConfiguration:s,sharingContext:a}=e;const l=this.resolveShareUXConfig(s,{shareMode:o.n.copyLink}),d={tokenProvider:this.props.tokenProvider,logger:this.props.logger,settingsProvider:this.props.settingsProvider,localization:this.localization,shareUXConfig:l,tenantId:this.props.tenantId},c=t||{siteUrl:this.props.bootDocumentInfo.siteUrl,driveId:this.props.bootDocumentInfo.driveId,itemId:this.props.bootDocumentInfo.itemId},h={containerPackageName:r,...c};if(void 0===n)return(0,p.zY)({...d,...h,fileId:h.itemId});const u={...h,dataStorePath:n,appName:this.props.appName};return(0,p.zY)({navPayloadOptions:i,fileId:u.itemId,...d,...u,sharingContext:a??(this.props.getFileContext?await this.props.getFileContext(c,n):void 0)})}async getPermissions(e){let{resolvedUrl:t}=e;return(async(e,t,r,o)=>{const n=d.m.start("GetPermissions",r);try{const i=(0,c.$)(e.siteUrl),s={getToken:r=>{if(r){const o={...r,siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId};return t.getToken([`${i}/files.readwrite.all`],o)}throw Error("Options must be specified")},url:`${i}/_api/v2.1/drives/${e.driveId}/items/${e.itemId}/permissions`,tenantId:o,requestInit:{method:"GET"},retryPolicy:h._9,tokenPolicy:(0,h.N$)(t)},a=r?await(0,u.g)({...s,logger:r,nameForLogging:"GetPermissions",getAdditionalProps:async(e,t)=>(0,m.u)(e)}):await(0,u.y)(s),l=await a.result.json(),p=[],d={},g=[],f=e=>{if(e.email){const t={id:e.id,name:e.displayName,userPrincipalName:e.email};d[t.userPrincipalName]||(d[t.userPrincipalName]=t)}else g.push(e.displayName)};l?.value&&l.value.map(e=>{if(e.grantedTo&&f(e.grantedTo.user),e.grantedToIdentities&&e.grantedToIdentities.map(e=>{f(e.user)}),e.link){const t={text:e.link.localizedDescription,scope:e.link.scope,type:e.link.type};e.link.webUrl&&(t.webUrl=e.link.webUrl),p.push(t)}});const v={personas:Object.values(d),links:p,groups:g};return n.setResult(!0),v}catch(i){throw n.setResult(!1,{errorType:"GetPermissionsError"},i),i}})(l(this.props.bootDocumentInfo,t,this.props.logger),this.props.tokenProvider,this.props.logger,this.props.tenantId)}getComponentLocator(e,t){return{...l(this.props.bootDocumentInfo,t,this.props.logger),dataStorePath:e,appName:this.props.appName}}resolveShareUXConfig(e,t){const r=(0,p.LL)(e)?e:t;return r?.shareControl?.props&&(r.shareControl.props={...r.shareControl.props,target:r.shareControl.props?.target??this.props.getShareUXTargetElement?.()}),r}convertResolvedUrlToOdspUrlParts(e,t){return t&&(0,i.g2)(t)?{siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId}:{siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.itemId}}}}}]);
//# sourceMappingURL=88652.03d79ad6.chunk.js.map