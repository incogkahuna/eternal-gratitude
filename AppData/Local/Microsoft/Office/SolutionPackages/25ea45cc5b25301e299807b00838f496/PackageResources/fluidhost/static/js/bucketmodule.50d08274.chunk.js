"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[10041],{514:(e,t,r)=>{r.d(t,{g:()=>s});var i=r(32512);class s extends i.v{constructor(e,t,r,i){super(s.actionType,t,r,i),this.bucket=e}}s.actionType="PLW_CREATE_BUCKET_FAILED"},1207:(e,t,r)=>{r.d(t,{z:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{planId:this.planId,count:String(this.buckets.length)}}constructor(e,t){super(s.actionType),this.planId=e,this.buckets=t}}s.actionType="PLW_GET_BUCKETSFORPLAN_SUCCEEDED"},1623:(e,t,r)=>{r.d(t,{t:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{localId:this.bucket.id}}constructor(e){super(s.actionType),this.bucket=e}}s.actionType="PLW_CREATE_BUCKET"},8403:(e,t,r)=>{r.d(t,{f:()=>w});var i=r(55491),s=r.n(i),n=r(42410),o=r(72761);class a{static fromResource(e){return new a(e.contextScenarioId,e.externalContextId,e.externalObjectId,e.ownerAppId)}toGraphSerializable(){return{contextScenarioId:this.contextScenarioId,externalContextId:this.externalContextId,externalObjectId:this.externalObjectId,ownerAppId:this.ownerAppId}}constructor(e,t,r,i){this.externalObjectId=r,this.externalContextId=t,this.contextScenarioId=e,this.ownerAppId=i}}class c{toGraphSerializable(){const e={};return this.external&&(e.external=this.external.toGraphSerializable()),e}constructor(e){null!=e.external&&(this.external=a.fromResource(e.external))}}var u=r(41740),d=r.n(u),l=r(91246);class g{build(){return new w(this)}newFromDifferentialUpdate(e){if(e.entityType!==o.I.Bucket)throw new Error("ArgumentException: invalid entity");const t=w.builder.withPropertyBag({id:e.id,itemVersion:e.itemVersion,planId:"",title:""}).build(),r=e.getCreateDiffData(),i=t.applyDiffs(r);return this.forClone(i)}forClone(e){return this.withPropertyBag({id:e.id,itemVersion:e.itemVersion,title:e.title,planId:e.planId,orderHint:e.orderHint,creationSource:d()(e.creationSource)??new c({})})}fromWebResource(e){return this.withPropertyBag({id:e.Id,itemVersion:null!=e.ItemVersion?e.ItemVersion.toString():void 0,orderHint:e.OrderHint,planId:e.PlanId,title:e.Title,creationSource:e.creationSource?new c(e.creationSource):void 0})}fromGraphResource(e){return this.withPropertyBag({itemVersion:e["@odata.etag"],title:e.name,planId:e.planId||"",orderHint:e.orderHint,id:e.id,creationSource:e.creationSource?new c(e.creationSource):void 0})}withPropertyBag(e){return this.id=e.id,this.itemVersion=e.itemVersion||this.itemVersion,this.orderHint=e.orderHint||this.orderHint,this.planId=e.planId,this.title=e.title,this.creationSource=e.creationSource||this.creationSource,this}withLocallyUniqueId(){return this.id=l.o.generate(),this}getDiffDataFromWebResource(e,t){const r=new n.F;r.addMapping("Title","title"),r.addMapping("OrderHint","orderHint"),r.addMapping("PlanId","planId"),r.addMapping("creationSource","creationSource");const i={};return s()(e.Changes,e=>{const t=e.FieldName;switch(t){case"OrderHint":case"PlanId":case"Title":const s=r.getMappedClientKey(t);i[s]=r.translateValue(t,s,e.Value)}}),i}getDiffDataFromGraphResource(e,t){const r=new n.F;return r.addMapping("name","title"),r.addMapping("orderHint","orderHint"),r.addMapping("planId","planId"),r.addMapping("creationSource","creationSource"),r.translate(e)}withValidData(){return this.id=l.o.generate(),this.itemVersion="1",this.title="Test bucket",this.planId=l.o.generate(),this.orderHint=" !",this}constructor(){this.id=l.o.generate(),this.title="",this.planId=l.o.generate(),this.itemVersion="",this.orderHint=" !",this.creationSource=new c({})}}var h=r(88908),p=r(17002),k=r.n(p),b=r(54320),I=r.n(b),B=r(36777),T=r.n(B),y=r(679);class w extends h.W{static get builder(){return new g}get entityType(){return o.I.Bucket}toWebSerializable(){return{Id:this.id,ItemVersion:null!=this.itemVersion?parseInt(this.itemVersion,10):null,OrderHint:this.orderHint,PlanId:this.planId,Title:this.title,creationSource:this.creationSource.toGraphSerializable()}}toGraphSerializable(){const e=this.creationSource.toGraphSerializable();return{id:this.id,"@odata.etag":this.itemVersion,orderHint:this.orderHint,planId:this.planId,name:this.title,creationSource:I()(e)?void 0:e}}setProperty(e,t){if("id"===e||"itemVersion"===e||"planId"===e||"creationSource"===e)throw new Error("ReadOnlyException: "+e);const r=this.getClone();return r[e]=t,r}getDiff(e){return y.B.getDiff(this,e,y.B.getDiffMomentCustomizer)}applyDiffs(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!k()(t,e=>null!=e))throw new Error("ArgumentException: diffs - Diffs array contains null elements");return t.length>0?T()(w.builder.build(),this,...t,y.B.applyDiffMomentCustomizer):this}applyDifferentialUpdate(e){if(e.id!==this.id)throw new Error("ArgumentException: update.id must match this.id");const t=e.getUpdateDiffData(this);return this.applyDiffs(t)}getClone(){return this.getCloneBuilder().build()}getCloneBuilder(){return w.builder.forClone(this)}constructor(e){super(e.id,e.itemVersion),this.orderHint=e.orderHint,this.planId=e.planId,this.title=e.title,this.creationSource=e.creationSource}}w.TitleMaxLength=256},15765:(e,t,r)=>{r.d(t,{V:()=>s});var i=r(32512);class s extends i.v{constructor(e,t,r,i){super(s.actionType,t,r,i),this.bucketId=e}}s.actionType="PLW_DELETE_BUCKET_FAILED"},23821:(e,t,r)=>{r.d(t,{z:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{id:this.bucket.id,updateKey:this.updateKey}}constructor(e,t){super(s.actionType),this.bucket=e,this.updateKey=t}}s.actionType="PLW_UPDATE_BUCKET_SUCCEEDED"},25744:(e,t,r)=>{r.d(t,{e:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{id:this.bucketId}}constructor(e){super(s.actionType),this.bucketId=e}}s.actionType="PLW_DELETE_BUCKET"},30220:(e,t,r)=>{r.r(t),r.d(t,{BucketModule:()=>C});var i=r(1207),s=r(32512);class n extends s.v{constructor(e,t,r){super(n.actionType,e,t,r)}}n.actionType="PLW_GET_BUCKETSFORPLAN_FAILED";var o=r(53734);class a extends s.v{constructor(e,t,r,i){super(a.actionType,e,t,r),this.bucketId=i}}a.actionType="PLW_GET_BUCKET_FAILED";var c=r(1623),u=r(79670),d=r(514),l=r(25744),g=r(38227),h=r(15765),p=r(87450),k=r(23821),b=r(46219),I=r(33287),B=r(96891),T=r(64805),y=r(74844),w=r(54320),E=r.n(w),f=r(9962),S=r(91246),m=r(98502),P=r(82841);class C extends T.J{get name(){return"BucketModule"}async fetchBucketsForPlanAsync(e,t){this.loggers.traceLogger.logTrace(507896991,y.k.Verbose,`Fetching Buckets For Plan [PlanId=${e}][Force=${t??!1}]`);let r=e=>{const t=this.stores.bucketStore.getBucketsForPlan(e.planId);return E()(t)?null:t},s=this.getCurrentViewIds();t&&(r=void 0,s=void 0);try{const n=await this.webApiProviders.taskService(),o=await n.getBucketsForPlanAsync({planId:e},r,s);return this.dispatcher.dispatchAction(new i.z(e,o)),this.loggers.traceLogger.logTrace(507896990,y.k.Verbose,`Fetching Buckets For Plan - Success [PlanId=${e}][Force=${t??!1}]`),o}catch(o){const r=o;return this.dispatcher.dispatchAction(new n(r.response,r.response?.statusText??"",r.error?.message??"")),this.loggers.traceLogger.logTrace(507896989,y.k.Warning,`Fetching Buckets For Plan - Fail [PlanId=${e}][Force=${t??!1}]${(0,P.s8)(r)}`),Promise.reject(r)}}async fetchBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896988,y.k.Verbose,`Fetching Bucket [BucketId=${e}][Force=${t??!1}]`);let r=e=>this.stores.bucketStore.getBucket(e.bucketId),i=this.getCurrentViewIds();t&&(r=void 0,i=void 0);try{const s=await this.webApiProviders.taskService(),n=await s.getBucketAsync({bucketId:e},r,i);return this.dispatcher.dispatchAction(new o.g(n.bucket)),this.loggers.traceLogger.logTrace(507896987,y.k.Verbose,`Fetching Bucket - Success [BucketId=${e}][Force=${t??!1}]`),n.bucket}catch(s){const r=s;return this.dispatcher.dispatchAction(new a(r.response,r.response?.statusText??"",r.error?.message??"",e)),this.loggers.traceLogger.logTrace(507896986,y.k.Warning,`Fetching Bucket - Fail [BucketId=${e}][Force=${t??!1}] ${(0,P.s8)(r)}`),Promise.reject(r)}}async createBucketAsync(e){if(this.loggers.traceLogger.logTrace(507896985,y.k.Verbose,`Creating Bucket [PlanId=${e.planId}]`),E()(e.title.trim())){const t="InvalidArgumentException: Whitespaces are not allowed";return this.loggers.traceLogger.logTrace(507896984,y.k.Warning,`Creating Bucket - Fail [PlanId=${e.planId}][Error=${t}]`),Promise.reject(m.g.generateAjaxClientError(null,t))}this.dispatcher.dispatchAction(new c.t(e));try{const t=await this.webApiProviders.taskService(),r=await t.createBucketAsync({bucketInfo:e});return this.dispatcher.dispatchAction(new u.G(r.bucket,e.id)),this.loggers.traceLogger.logTrace(507896983,y.k.Verbose,`Creating Bucket - Success [PlanId=${e.planId}]`),this.loggers.usageLogger.logData(this.name,B.M.CreateBucket),r.bucket}catch(t){const r=t;return this.dispatcher.dispatchAction(new d.g(e,r.response,r.response?.statusText??"",r.error?.message??"")),this.loggers.traceLogger.logTrace(507896982,y.k.Warning,`Creating Bucket - Fail [PlanId=${e.planId}]${(0,P.s8)(r)}`),Promise.reject(r)}}async deleteBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896981,y.k.Verbose,`Deleting Bucket [BucketId=${e}][Version=${t}]`);const r=this.stores.bucketStore.getBucket(e);if(this.dispatcher.dispatchAction(new l.e(e)),null==r)return Promise.resolve();try{const r=await this.webApiProviders.taskService();return await r.deleteBucketAsync({bucketId:e,itemVersion:t}),this.dispatcher.dispatchAction(new g.R(e)),void this.loggers.traceLogger.logTrace(507896980,y.k.Verbose,`Deleting Bucket - Success [BucketId=${e}][Version=${t}]`)}catch(i){const r=i;return this.dispatcher.dispatchAction(new h.V(e,r.response,r.response?.statusText??"",r.error?.message??"")),this.loggers.traceLogger.logTrace(507896979,y.k.Warning,`Deleting Bucket - Failure [BucketId=${e}][Version=${t}]${(0,P.s8)(r)}`),Promise.reject(r)}}async updateBucketAsync(e,t){this.loggers.traceLogger.logTrace(507896978,y.k.Verbose,`Updating Bucket [BucketId=${e.id}]`);const r=e.getDiff(t);if(this.logUpdateBucketUsage(r),E()(r))return this.loggers.traceLogger.logTrace(507896977,y.k.Verbose,`Updating Bucket - Success No-op [BucketId=${e.id}]`),Promise.resolve(I.a.builder.withBucket(t).build());const i=S.o.generate();this.dispatcher.dispatchAction(new p.A(t,i));const s=t=>{const i=this.stores.bucketStore.getBucketWithoutPendingUpdates(t.originalBucket.id);if(null==i)throw this.loggers.traceLogger.logTrace(507896976,y.k.Warning,`Updating Bucket - Fail [BucketId=${e.id}][Error="Original bucket not found in store"]`),m.g.generateAjaxClientError(null,new f.m("originalStoreBucket","bucketStore"));const s=i.applyDiffs(r);return{originalBucket:i,updatedBucket:s}};try{const r=await this.webApiProviders.taskService(),n=await r.updateBucketAsync({originalBucket:e,updatedBucket:t},s);return this.dispatcher.dispatchAction(new k.z(n.bucket,i)),this.loggers.traceLogger.logTrace(507896975,y.k.Verbose,`Updating Bucket - Success [BucketId=${e.id}]`),n}catch(n){const t=n;return this.dispatcher.dispatchAction(new b.T(e,i,t.response,t.response?.statusText??"",t.error?.message??"")),this.loggers.traceLogger.logTrace(507896974,y.k.Warning,`Updating Bucket - Fail [BucketId=${e.id}]${(0,P.s8)(t)}`),Promise.reject(t)}}logUpdateBucketUsage(e){e.title&&this.loggers.usageLogger.logData(B.M.BucketActionCreator,B.M.BucketTitleUpdated),e.orderHint&&this.loggers.usageLogger.logData(B.M.BucketActionCreator,B.M.BucketOrderHintUpdated)}}},33287:(e,t,r)=>{r.d(t,{a:()=>n});var i=r(8403);class s{build(){return new n(this)}fromBucketEntityGroupResource(e){return this.withPropertyBag({bucket:i.f.builder.fromWebResource(e.Bucket).build()})}fromGraphBucketResourceTypes(e){return this.withPropertyBag({bucket:i.f.builder.fromGraphResource(e).build()})}withPropertyBag(e){return this.bucket=e.bucket||this.bucket,this}withBucket(e){return this.bucket=e,this}withDefaultValues(){return this.withPropertyBag({bucket:i.f.builder.build()})}}class n{static get builder(){return new s}get id(){return this.bucket.id}toWebSerializable(){return{Bucket:this.bucket.toWebSerializable()}}constructor(e){this.bucket=e.bucket}}},38227:(e,t,r)=>{r.d(t,{R:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{id:this.bucketId}}constructor(e){super(s.actionType),this.bucketId=e}}s.actionType="PLW_DELETE_BUCKET_SUCCEEDED"},46219:(e,t,r)=>{r.d(t,{T:()=>s});var i=r(32512);class s extends i.v{constructor(e,t,r,i,n){super(s.actionType,r,i,n),this.bucket=e,this.updateKey=t}}s.actionType="PLW_UPDATE_BUCKET_FAILED"},53734:(e,t,r)=>{r.d(t,{g:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{id:this.bucket.id}}constructor(e){super(s.actionType),this.bucket=e}}s.actionType="PLW_GET_BUCKET_SUCCEEDED"},64805:(e,t,r)=>{r.d(t,{J:()=>s});class i{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,r){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=r}}class s extends i{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,r,i,s){super(e,i,s),this.webApiProviders=t,this.stores=r}}},79670:(e,t,r)=>{r.d(t,{G:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{localId:this.localId,id:this.bucket.id}}constructor(e,t){super(s.actionType),this.bucket=e,this.localId=t}}s.actionType="PLW_CREATE_BUCKET_SUCCEEDED"},87450:(e,t,r)=>{r.d(t,{A:()=>s});var i=r(75992);class s extends i.r{loggingData(){return{id:this.bucket.id,updateKey:this.updateKey}}constructor(e,t){super(s.actionType),this.bucket=e,this.updateKey=t}}s.actionType="PLW_UPDATE_BUCKET"}}]);
//# sourceMappingURL=bucketmodule.50d08274.chunk.js.map