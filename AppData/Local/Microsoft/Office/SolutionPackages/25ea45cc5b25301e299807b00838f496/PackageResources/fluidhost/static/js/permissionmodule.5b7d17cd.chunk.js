"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[8010],{38664:(s,e,t)=>{t.r(e),t.d(e,{PermissionsModule:()=>g});var r=t(58355),i=t(81576),n=t(69632),o=t(64805),a=t(54320),c=t.n(a),l=t(74844),h=t(98502),u=t(82841);class g extends o.J{get name(){return"PermissionsModule"}async fetchContainerPermissionsAsync(s){this.loggers.traceLogger.logTrace(507897048,l.k.Verbose,`Batch Fetch Container Permissions [permissionsToFetch=${s}]`);const e=await this.webApiProviders.taskService(),t=[];for(const r of s){const{containerId:s,publicationId:i}=r;this.stores.permissionsStore.arePermissionsMissingOrExpired(s,i)&&t.push(e.getContainerPermissionsAsync({containerId:s,publicationId:i}))}if(0===t.length)return Promise.resolve([]);const i=await Promise.allSettled(t),n=[];let o;if(i.forEach(s=>{if("fulfilled"===s.status&&null!=s.value)n.push({containerId:s.value.containerId,publicationId:s.value.publicationId,containerPermissions:s.value.containerPermissions,expiry:s.value.expiry});else if("rejected"===s.status){o=s;const e=o.reason?.response?.status??0,t=o.reason?.response?.statusText??"";this.loggers.traceLogger.logTrace(507897047,l.k.Warning,`Fetch Container Permissions Failed [statusCode=${e}][statusText=${t}]`)}}),!c()(n))return this.dispatcher.dispatchAction(new r.D(n)),this.loggers.traceLogger.logTrace(507897046,l.k.Verbose,`Batch Fetch Container Permissions Success [permissionsToFetch=${s}]`),n;const a=o?.reason||h.g.generateAjaxClientError(null);return this.loggers.traceLogger.logTrace(507897045,l.k.Warning,`Batch Fetch Container Permissions Failed ${(0,u.s8)(a)}`),Promise.reject(a)}async fetchTaskPermissionsAsync(s){this.loggers.traceLogger.logTrace(507897044,l.k.Verbose,`Batch Fetch Task Permissions [equivalenceSetIds=${s}]`);const e=await this.webApiProviders.taskService(),t=[],r=[];for(const i of s)this.stores.permissionsStore.areTaskPermissionsMissingOrExpired(i)&&(t.push(e.getTaskPermissionsAsync({equivalenceSetId:i})),r.push(i));if(0===t.length)return[];const o=await Promise.allSettled(t),a=[],c=[];let g;if(o.forEach((s,e)=>{if("fulfilled"===s.status&&null!=s.value)a.push({equivalenceSetId:s.value.equivalenceSetId,taskPermissions:s.value.taskPermissions,expiry:s.value.expiry});else if("rejected"===s.status){c.push(r[e]),g=s;const t=g.reason?.response?.status??0,i=g.reason?.response?.statusText??"";this.loggers.traceLogger.logTrace(507897043,l.k.Warning,`Fetch Task Permissions Failed [statusCode=${t}][statusText=${i}]`)}}),c.length>0&&this.dispatcher.dispatchAction(new i.R(c)),a.length>0&&this.dispatcher.dispatchAction(new n.f(a)),null==g)return this.loggers.traceLogger.logTrace(507897042,l.k.Verbose,`Batch Fetch Task Permissions Success [equivalenceSetIds=${s}]`),a;{const s=g.reason||h.g.generateAjaxClientError(null);return this.loggers.traceLogger.logTrace(507897041,l.k.Warning,`Batch Fetch Task Permissions Failed: ${(0,u.s8)(s)}`),Promise.reject(s)}}}},58355:(s,e,t)=>{t.d(e,{D:()=>o});var r=t(75992),i=t(86178),n=t.n(i);class o extends r.r{loggingData(){let s=0;for(const e of this.permissionsSets)e.expiry.isBefore(n()())&&s++;return{numPermissionsFetched:this.permissionsSets.length.toString(),numExpiredPermissionsFetched:s.toString()}}constructor(s){if(super(o.actionType),this.permissionsSets=s,this.permissionsSets.length<1)throw new Error("Permissions set has less than 1 entry")}}o.actionType="PLW_BATCH_GET_CONTAINER_PERMISSIONS_SUCCEEDED"},64805:(s,e,t)=>{t.d(e,{J:()=>i});class r{get clientSettings(){return this.clientSettingsProvider()}constructor(s,e,t){this.dispatcher=s,this.clientSettingsProvider=e,this.loggers=t}}class i extends r{getCurrentViewIds(){const s=this.stores.appContextStore.getCurrentViewId();return s?[s]:void 0}constructor(s,e,t,r,i){super(s,r,i),this.webApiProviders=e,this.stores=t}}},69632:(s,e,t)=>{t.d(e,{f:()=>o});var r=t(75992),i=t(86178),n=t.n(i);class o extends r.r{loggingData(){let s=0;for(const e of this.taskPermissionsSets)e.expiry.isBefore(n()())&&s++;return{numTaskPermissionsFetched:this.taskPermissionsSets.length.toString(),numTaskExpiredPermissionsFetched:s.toString()}}constructor(s){if(super(o.actionType),this.taskPermissionsSets=s,this.taskPermissionsSets.length<1)throw new Error("Task Permissions set has less than 1 entry")}}o.actionType="PLW_BATCH_GET_TASK_PERMISSIONS_SUCCEEDED"},81576:(s,e,t)=>{t.d(e,{R:()=>i});var r=t(75992);class i extends r.r{constructor(s){super(i.actionType),this.rejectedEquivalenceSetIds=s}}i.actionType="PLW_BATCH_GET_TASK_PERMISSIONS_FAILED"}}]);
//# sourceMappingURL=permissionmodule.5b7d17cd.chunk.js.map