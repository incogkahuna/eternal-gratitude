"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[97138],{7304:(e,t,i)=>{i.d(t,{h:()=>r});var s=i(75992);class r extends s.r{loggingData(){return{sessionId:this.session.id,groupId:this.session.groupId,itemId:String(this.session.itemId),itemSize:String(this.session.itemSize),bytesSent:String(this.session.bytesSent),expirationTime:null!=this.session.expirationDateTime?this.session.expirationDateTime.toString():"null",hasWebUrl:String(!!this.session.webUrl),nextExpectedRanges:this.session.nextExpectedRanges?.toString()??""}}constructor(e){super(r.actionType),this.session=e}}r.actionType="PLW_UPLOAD_BYTES_TO_SESSION_SUCCEEDED"},21721:(e,t,i)=>{i.d(t,{c:()=>r});var s=i(32512);class r extends s.v{loggingData(){return{...super.loggingData(),groupId:this.groupId}}constructor(e,t,i,s){super(r.actionType,t,i,s),this.groupId=e}}r.actionType="GET_GROUP_DOCUMENTS_IN_FOLDER_FAILURE"},23918:(e,t,i)=>{i.d(t,{Y:()=>f});var s=i(91675),r=i(51171),o=i(57718),n=i(86178),a=i.n(n),l=i(14983),d=function(){function e(){this.id=o.cM(),this.name="",this.fileType=l.Er.Other,this.url="",this.modifiedDate=a()(),this.childCount=-1,this.itemPath="/drive/root:"}return e.prototype.build=function(){return new f(this)},e.prototype.withPropertyBag=function(e){return this.id=e.id||this.id,this.name=e.name||this.name,this.fileType=e.fileType||this.fileType,this.url=e.url||this.url,this.modifiedDate=e.modifiedDate||this.modifiedDate,this.childCount=void 0!==e.childCount?e.childCount:this.childCount,this.itemPath=e.itemPath||this.itemPath,this},e.prototype.withDefaultValues=function(){return this.withPropertyBag({id:"driveItemId",name:"Item1",fileType:l.Er.Other,url:"driveItemUrl",modifiedDate:a()(),itemPath:"/drive/root:",childCount:-1})},e.prototype.fromGraphDriveItemResource=function(e){return this.withPropertyBag({id:e.id,name:e.name,fileType:e.folder?l.Er.Other:e.package?f.GetType(e.package.type):f.GetFileType(e.name),url:e.webUrl,modifiedDate:a()(e.lastModifiedDateTime),childCount:e.folder?e.folder.childCount:-1,itemPath:e.parentReference.path})},e}(),c=i(98990),u=i.n(c),h=i(55491),m=i.n(h),p=i(54320),g=i.n(p),f=function(){function e(e){if(g()(e.id))throw new r.L("id");if(g()(e.name))throw new r.L("name");if(g()(e.url))throw new r.L("url");this.id=e.id,this.name=e.name,this.url=e.url,this.fileType=e.fileType,this.description=e.description,this.modifiedDate=e.modifiedDate,this.childCount=e.childCount,this.itemPath=e.itemPath}return Object.defineProperty(e,"builder",{get:function(){return new d},enumerable:!1,configurable:!0}),e.GetType=function(e){switch(e.toLowerCase()){case"excel":return l.Er.Excel;case"onenote":return l.Er.OneNote;case"pdf":return l.Er.Pdf;case"powerpoint":return l.Er.PowerPoint;case"project":return l.Er.Project;case"visio":return l.Er.Visio;case"word":return l.Er.Word;case"loop":return l.Er.Loop;default:return l.Er.Other}},e.GetFileType=function(t){var i=l.Er.Other,r=t.slice(t.lastIndexOf(".")+1);return m()(s.t,function(t,s){u()(t,function(e){return e.toLowerCase()===r.toLowerCase()})&&(i=e.GetType(s))}),i},e}()},26796:(e,t,i)=>{i.d(t,{z:()=>o});var s=i(57718),r=function(){function e(){this.bytesSent=0,this.groupId="",this.id=s.cM(),this.itemName="",this.itemSize=0,this.itemId="",this.lastUploadRequestSucceeded=!1,this.uploadUrl="",this.name="",this.webUrl="",this.nextExpectedRanges=void 0}return e.prototype.build=function(){return new o(this)},e.prototype.withPropertyBag=function(e){return this.bytesSent=e.bytesSent||this.bytesSent,this.expirationDateTime=e.expirationDateTime||this.expirationDateTime,this.groupId=e.groupId||this.groupId,this.id=e.id||this.id,this.itemId=e.itemId||this.itemId,this.itemName=e.itemName||this.itemName,this.itemSize=e.itemSize||this.itemSize,this.lastUploadRequestSucceeded=null!=e.lastUploadRequestSucceeded?e.lastUploadRequestSucceeded:this.lastUploadRequestSucceeded,this.uploadUrl=e.uploadUrl||this.uploadUrl,this.name=e.name||this.name,this.webUrl=e.webUrl||this.webUrl,this.nextExpectedRanges=e.nextExpectedRanges||this.nextExpectedRanges,this},e.prototype.withDefaultValues=function(){return this.id="DriveItemUploadSessionId",this.bytesSent=0,this.groupId="GroupId",this.itemId="itemId",this.itemName="sampleFile.txt",this.itemSize=28,this.uploadUrl="UploadURL",this.name="sampleFile.txt",this.expirationDateTime=new Date("2020-09-02"),this.webUrl="https://contoso.com/sites/group/sampleFile.txt",this.nextExpectedRanges=["26-"],this},e}(),o=function(){function e(e){this.bytesSent=e.bytesSent,this.expirationDateTime=e.expirationDateTime,this.groupId=e.groupId,this.id=e.id,this.itemId=e.itemId,this.itemName=e.itemName,this.itemSize=e.itemSize,this.lastUploadRequestSucceeded=e.lastUploadRequestSucceeded,this.uploadUrl=e.uploadUrl,this.name=e.name,this.webUrl=e.webUrl,this.nextExpectedRanges=e.nextExpectedRanges}return Object.defineProperty(e,"builder",{get:function(){return new r},enumerable:!1,configurable:!0}),e.prototype.getClone=function(){return e.builder.withPropertyBag({bytesSent:this.bytesSent,expirationDateTime:this.expirationDateTime,groupId:this.groupId,id:this.id,itemId:this.itemId,itemName:this.itemName||"",itemSize:this.itemSize||0,lastUploadRequestSucceeded:this.lastUploadRequestSucceeded,uploadUrl:this.uploadUrl,name:this.name,webUrl:this.webUrl,nextExpectedRanges:this.nextExpectedRanges}).build()},e.prototype.setProperty=function(e,t){if("id"===e)throw new Error("ReadOnlyException: "+e);var i=this.getClone();return i[e]=t,i},e}()},27916:(e,t,i)=>{var s,r,o,n,a;i.d(t,{Zg:()=>l}),function(e){e[e.OK=0]="OK",e[e.ContainsDefaultReservedWords=1]="ContainsDefaultReservedWords",e[e.MissingPrefixSuffix=2]="MissingPrefixSuffix",e[e.ContainsCustomBlockedWords=3]="ContainsCustomBlockedWords",e[e.ContainsMSStandardBlockedWords=4]="ContainsMSStandardBlockedWords",e[e.MailNicknameNotOK=5]="MailNicknameNotOK",e[e.Unknown=6]="Unknown"}(s||(s={})),function(e){e.Forbidden="Forbidden",e.NotFound="NotFound",e.CreatePlanForGroupFailed="CreatePlanForGroupFailed",e.MaximumPlansOwnedByUserReached="MaximumPlansOwnedByUserReached",e.UnknownError="UnknownError"}(r||(r={})),function(e){e.Offline="Offline"}(o||(o={})),function(e){e.DynamicImportError="DynamicImportError"}(n||(n={})),function(e){e.MaximumProjectsOwnedByUser="MaximumProjectsOwnedByUser",e.MaximumProjectsSharedWithUser="MaximumProjectsSharedWithUser",e.MaximumTasksCreatedByUser="MaximumTasksCreatedByUser",e.MaximumTasksAssignedToUser="MaximumTasksAssignedToUser",e.MaximumTasksInProject="MaximumTasksInProject",e.MaximumActiveTasksInProject="MaximumActiveTasksInProject",e.MaximumBucketsInProject="MaximumBucketsInProject",e.MaximumUsersSharedWithProject="MaximumUsersSharedWithProject",e.MaximumReferencesOnTask=" MaximumReferencesOnTask",e.MaximumChecklistItemsOnTask="MaximumChecklistItemsOnTask",e.MaximumAssigneesInTasks="MaximumAssigneesInTasks",e.MaximumFavoritePlansForUser="MaximumFavoriteProjectsForUser",e.MaximumRecentPlansForUser="MaximumRecentProjectsForUser",e.MaximumContextsOnPlan="MaximumContextsOnPlan"}(a||(a={}));const l="ArchivedEntityCanNotBeUpdated"},36591:(e,t,i)=>{i.d(t,{C:()=>s});class s{constructor(e,t,i,s,r){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=i,this.clientSettings=s,this.loggers=r}}},37535:(e,t,i)=>{var s;i.d(t,{P:()=>s}),function(e){e[e.Conversations=0]="Conversations",e[e.Calendar=1]="Calendar",e[e.People=2]="People",e[e.Documents=3]="Documents",e[e.Notebook=4]="Notebook",e[e.Yammer=5]="Yammer"}(s||(s={}))},39156:(e,t,i)=>{i.d(t,{n:()=>s});class s extends Error{constructor(e){super(),Object.setPrototypeOf(this,s.prototype),this.message=`${e} should not be null`,this.name="NullReferenceError"}}},51676:(e,t,i)=>{i.d(t,{z:()=>r});var s=i(32512);class r extends s.v{constructor(e,t,i,s,o){super(r.actionType,i,s,o),this.groupId=e,this.itemUrl=t}}r.actionType="PLW_GET_DRIVE_ITEM_THUMBNAIL_FAILED"},57718:(e,t,i)=>{function s(e){for(var t="";t.length<e;){var i=16*Math.random();t+=(i|=0).toString(16)}return t}i.d(t,{cM:()=>r});function r(){var e=[];e.push(s(8)),e.push(s(4));var t="4"+s(3);e.push(t);var i=s(4),r=parseInt(i[0],16);return r&=3,i=(r|=8).toString(16)+i.substr(1),e.push(i),e.push(s(12)),e.join("-")}},65672:(e,t,i)=>{i.r(t),i.d(t,{GroupDocumentsActionCreator:()=>b});var s=i(38752),r=i(51676),o=i(85230),n=i(7304),a=i(23835),l=i(21721),d=i(36591),c=i(64226);class u{static get delimiter(){return":"}static get taskPrefix(){return"TSK"}}var h=i(96891),m=i(95783),p=i(27916),g=i(23918),f=i(26796),x=i(65818),y=i(23312),w=i(80708),T=i(37535),I=i(52274),S=i(74844),v=i(54320),P=i.n(v),U=i(9962),k=i(39156),M=i(91246),D=i(98502),E=i(82841);class b extends d.C{get name(){return h.M.GroupDocumentsActionCreator}async cancelUploadSession(e){const t=await this.logicModuleProviders.driveItemModule(),i=await this.logicModuleProviders.notificationModule();t.cancelUploadSession(e).catch(t=>{if(!(t.error instanceof I.U)){const s=t.error?.name;if(s===p.Zg)i.showInfoInternal(c.fc.PlanConvertingInfo);else{const s=t.response?.status,r=t.response?.statusText;i.showErrorInternal(c.fc.CancelFileUploadError,s,r,void 0,t.response,[e.itemName??""])}}})}async getGroupDocumentsInFolder(e,t){(await this.logicModuleProviders.driveItemModule()).getGroupDocumentsInFolder(e,t).catch(t=>{this.handleGetGroupDocumentsInFolderFailure(t,e)})}async fetchDriveItem(e){(await this.logicModuleProviders.driveItemModule()).fetchDriveItem(e).catch(()=>{})}async getDriveItemThumbnail(e,t,i){(await this.logicModuleProviders.driveItemModule()).getDriveItemThumbnail(e,t,i).catch(i=>{i.error instanceof I.U||this.dispatcher.dispatchAction(new r.z(e,t,i.response,i.response?.statusText??"",i.error?.message??""))})}async uploadFileAsAttachment(e,t,i,s){const r=e.name,n=f.z.builder.withPropertyBag({bytesSent:0,groupId:i,itemName:e.name,itemSize:e.size,uploadUrl:"",id:u.taskPrefix+u.delimiter+t.id+u.delimiter+M.o.generate()}).build(),l={Alias:e.name.substring(0,y.o.AliasMaxLength),PreviewPriority:s,Type:g.Y.GetFileType(e.name),isProtected:!1},d=t.addAttachment(y.o.builder.fromAttachmentResource(n.id,l).build()),h=M.o.generate();let m=!1;const x=await this.logicModuleProviders.driveItemModule(),w=await this.logicModuleProviders.notificationModule();x.createUploadSession(i,r,n,d,h).then(t=>(m=!0,this.uploadBytesToSessionRecursivePromise(e,t))).then(e=>this.updateTaskDetailsWithSession(e,t.id)).catch(async i=>{if(this.loggers.traceLogger.logTrace(507873090,S.k.Warning,`Error uploading attachment. ${(0,E.s8)(i)}`),m&&this.dispatcher.dispatchAction(new o.t(i.response,i.response?.statusText??"",i.error?.message??"",n,t.id,h)),!(i.error instanceof I.U)){const t=i.response?.status,s=i.response?.statusText,r=i.error?.name;r===p.Zg?w.showInfoInternal(c.fc.PlanConvertingInfo):i.response&&await D.g.isAuthenticationInsuficientClaimsResponse(i.response,this.loggers.traceLogger)?this.dispatcher.dispatchAction(new a.i(c.fc.UploadFileError,t,s,void 0,[e.name],i.response)):w.showErrorInternal(c.fc.UploadFileError,t,s,void 0,i.response,[e.name])}})}async uploadBytesToSessionRecursivePromise(e,t){const i=this.calculateFileUploadParams(e,t),s=this,r=await this.logicModuleProviders.notificationModule();return new Promise((o,a)=>{this.fileReader.onerror=i=>{s.cancelUploadSession(t),r.showErrorInternal(c.fc.FileReadError,void 0,void 0,void 0,void 0,[e.name]),a(i)},this.fileReader.onload=async r=>{let l=r.target.result;l.indexOf("base64,")>-1&&(l=l.substr(l.indexOf("base64,")+7));(await this.logicModuleProviders.driveItemModule()).uploadBytesToSession(t,l,i.chunkSize,i.initialByteIndex,i.finalByteIndex,e.size).then(t=>{i.finalByteIndex<e.size-1?this.uploadBytesToSessionRecursivePromise(e,t).then(o).catch(a):(t=t.setProperty("lastUploadRequestSucceeded",!0),o(t)),this.dispatcher.dispatchAction(new n.h(t))}).catch(e=>{this.loggers.traceLogger.logTrace(507873089,S.k.Warning,`Upload chunk failed ${(0,E.s8)(e)}`),s.cancelUploadSession(t),a(e)})};const l=e.slice(i.initialByteIndex,i.finalByteIndex+1);this.fileReader.readAsDataURL(l)})}async updateTaskDetailsWithSession(e,t){try{if(null==t){const e="invalidTaskId";throw D.g.generateAjaxClientError(new Response(e,{status:m.t3.BadRequest,statusText:e}),e)}const i=this.entityStoreSet.taskStore.getTask(t);if(null==i){const e="taskNotInStore";throw D.g.generateAjaxClientError(new Response(e,{status:m.t3.BadRequest,statusText:e}),e)}const s=this.entityStoreSet.taskStore.getTaskDetails(t);if(null==s)throw D.g.generateAjaxClientError(null,new U.m("oldTaskDetails","taskStore"));const r=this.entityStoreSet.taskStore.getTaskboardTaskFormatting(t),o=this.entityStoreSet.containerStore.getContainer(e.groupId);if(null==o||o.containerType!==x.K.Group)throw D.g.generateAjaxClientError(null,new U.m("storeContainer","containerStore"));const n=o;if(null==n.unifiedGroupDetails)throw D.g.generateAjaxClientError(null,new U.m("groupDetails","containerStore"));const a=n.unifiedGroupDetails.getWorkloadUrl(T.P[T.P.Documents]);if(null==a)throw D.g.generateAjaxClientError(null,new k.n("driveUrl"));const l=s.references[e.id];if(a||this.loggers.traceLogger.logTrace(507873088,S.k.Warning,"DriveUrl is empty"),e.name||this.loggers.traceLogger.logTrace(507873059,S.k.Warning,"Upload Session Name field came back empty or undefined"),e.webUrl||this.loggers.traceLogger.logTrace(507873058,S.k.Warning,"Upload session webUrl is empty"),e.itemName||this.loggers.traceLogger.logTrace(507873057,S.k.Warning,"Upload session itemName is empty"),null==l)throw this.loggers.traceLogger.logTrace(506516561,S.k.Warning,"Temporary attachment not found in task details"),D.g.generateAjaxClientError(null,new k.n("oldAttachment"));const d=new y.o(y.o.builder.fromRecentlyUploadedDriveItem(a,e.itemName||"",l.taskAttachmentType,l.previewPriority,e.name||e.itemName||""));try{const e=new URL(d.url);"http:"!==e.protocol&&"https:"!==e.protocol&&this.loggers.traceLogger.logTrace(507873056,S.k.Warning,"Invalid protocol")}catch{this.loggers.traceLogger.logTrace(507873055,S.k.Warning,"Cannot parse new attachment url")}let c=s.removeAttachment(l.url);c=c.addAttachment(d);(await this.logicModuleProviders.planModule()).fetchPlanAsync(i.planId).then(async e=>{const t=await this.logicModuleProviders.containerModule();t.fetchUnifiedGroupAsync(e.plan.container.externalId).then(()=>{t.fetchUnifiedGroupDetailsAsync(e.plan.container.externalId).then(async e=>{(await this.logicModuleProviders.driveItemModule()).fetchTaskReferenceThumbnails(c,e,[d])},e=>{this.loggers.traceLogger.logTrace(507873054,S.k.Warning,"Error ensuring group details")})},e=>{this.loggers.traceLogger.logTrace(507873053,S.k.Warning,"Error ensuring group")})},e=>{this.loggers.traceLogger.logTrace(507873052,S.k.Warning,"Error fetching plan")});const u=s.getDiff(c);if(P()(u))throw D.g.generateAjaxClientError(null,new k.n("detailsDiff"));const h=await this.logicModuleProviders.taskModule(),p=await h.updateTaskAsync(w.F.builder.withTask(i).withDetails(s).withFormatData(r||void 0).build(),w.F.builder.withTask(i).withDetails(c).withFormatData(r||void 0).build());return(await this.logicModuleProviders.notificationModule()).enqueueHiddenToastNotification("SharedComponents_TaskReferenceAddedToastTitle"),p}catch(i){return Promise.reject(i)}}calculateFileUploadParams(e,t){const i=t.bytesSent?t.bytesSent:0,r=s.B.clientSettings.UploadChunkSize||0;let o=e.size-t.bytesSent;o>r&&(o=r);return{chunkSize:o,initialByteIndex:i,finalByteIndex:i+o-1}}async handleGetGroupDocumentsInFolderFailure(e,t){const i=e;if(!(i.error instanceof I.U)){const e=i.response?.status,s=i.response?.statusText,r=i.error?.name;if(r===p.Zg)this.dispatcher.dispatchAction(new a.i(c.fc.PlanConvertingInfo));else if(i.response&&await D.g.isAuthenticationInsuficientClaimsResponse(i.response,this.loggers.traceLogger))this.dispatcher.dispatchAction(new a.i(c.fc.GetGroupDocumentsError,e,s,t,void 0,i.response));else if(e===m.t3.NotFound)this.dispatcher.dispatchAction(new a.i(c.fc.GetGroupDocumentsError,e,s,t,void 0,i.response));else{(await this.logicModuleProviders.notificationModule()).showErrorInternal(c.fc.GetGroupDocumentsError,e,s,t,i.response)}this.dispatcher.dispatchAction(new l.c(t,i.response,i.response?.statusText??"",i.error?.message??""))}}constructor(e,t,i,r,o){super(e,t,i,s.B.clientSettings,o),this.fileReader=r}}},85230:(e,t,i)=>{i.d(t,{t:()=>r});var s=i(32512);class r extends s.v{constructor(e,t,i,s,o,n){super(r.actionType,e,t,i),this.session=s,this.taskId=o,this.updateKey=n}}r.actionType="PLW_UPLOAD_SESSION_FAILED"},91675:(e,t,i)=>{i.d(t,{t:()=>s});var s={Word:["docx","docm","doc","dotx","dotm"],Excel:["xlsx","xlsm","xlsb","xltx","xltm","xls","xlam","xla","xlw","xml"],PowerPoint:["pptx","pptm","ppt","potx","potm","pot","thmx","pps","ppsx","ppsm","ppsam","ppa"],OneNote:["one"],Project:["mpp","mpt","mpd"],Visio:["vsdx","vsd","vsdm","vssx","vssm","vstx","vstm"],Pdf:["pdf"],Loop:["loop","fluid"]}}}]);
//# sourceMappingURL=groupdocumentsac.ac505a0e.chunk.js.map