(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[4856],{715:(e,t,s)=>{"use strict";var r;s.d(t,{x:()=>r}),function(e){e.Rating="Question.Rating",e.Date="Question.DateTime",e.FileUpload="Question.FileUpload",e.Choice="Question.Choice",e.Text="Question.TextField",e.Ranking="Question.Ranking",e.MatrixChoiceGroup="Question.MatrixChoiceGroup",e.MatrixChoice="Question.MatrixChoice",e.NetPromoterScore="Question.NPS"}(r||(r={}))},7304:(e,t,s)=>{"use strict";s.d(t,{h:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{sessionId:this.session.id,groupId:this.session.groupId,itemId:String(this.session.itemId),itemSize:String(this.session.itemSize),bytesSent:String(this.session.bytesSent),expirationTime:null!=this.session.expirationDateTime?this.session.expirationDateTime.toString():"null",hasWebUrl:String(!!this.session.webUrl),nextExpectedRanges:this.session.nextExpectedRanges?.toString()??""}}constructor(e){super(i.actionType),this.session=e}}i.actionType="PLW_UPLOAD_BYTES_TO_SESSION_SUCCEEDED"},10979:(e,t,s)=>{"use strict";s.d(t,{I:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{sessionId:this.session.id,groupId:this.session.groupId,itemId:String(this.session.itemId),itemSize:String(this.session.itemSize),taskId:this.updatedTaskDetails.id,updateKey:this.updateKey}}constructor(e,t,s){super(i.actionType),this.session=e,this.updatedTaskDetails=t,this.updateKey=s}}i.actionType="PLW_CREATE_UPLOAD_SESSION"},26410:(e,t,s)=>{"use strict";s.d(t,{B:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{sessionId:this.session.id,groupId:this.session.groupId,itemId:String(this.session.itemId),itemSize:String(this.session.itemSize),bytesSent:String(this.session.bytesSent),expirationTime:null!=this.session.expirationDateTime?this.session.expirationDateTime.toString():"null",updateKey:this.updateKey}}constructor(e,t){super(i.actionType),this.session=e,this.updateKey=t}}i.actionType="PLW_CREATE_UPLOAD_SESSION_SUCCEEDED"},36723:(e,t,s)=>{"use strict";var r;s.d(t,{Er:()=>r,Tj:()=>i,ig:()=>o}),function(e){e.Word="Word",e.Excel="Excel",e.PowerPoint="PowerPoint",e.OneNote="OneNote",e.Project="Project",e.Visio="Visio",e.Pdf="Pdf",e.Loop="Loop",e.Form="Form",e.Other="Other",e.TeamsHostedApp="TeamsHostedApp"}(r||(r={}));const i=["OneNote","Project","Visio","Form"],o=["jpg","jpeg","png","gif","bmp"];var n;!function(e){e.Stream="stream-video",e.Youtube="yt-video",e.Vimeo="vimeo-video",e.DailyMotion="dm-video",e.Facebook="fb-video"}(n||(n={}))},37535:(e,t,s)=>{"use strict";var r;s.d(t,{P:()=>r}),function(e){e[e.Conversations=0]="Conversations",e[e.Calendar=1]="Calendar",e[e.People=2]="People",e[e.Documents=3]="Documents",e[e.Notebook=4]="Notebook",e[e.Yammer=5]="Yammer"}(r||(r={}))},45100:(e,t,s)=>{"use strict";s.d(t,{d:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{groupId:this.groupId}}constructor(e,t,s){super(i.actionType),this.groupId=e,this.itemUrl=t,this.thumbnail=s}}i.actionType="PLW_GET_DRIVE_ITEM_THUMBNAIL_SUCCEEDED"},48078:(e,t,s)=>{"use strict";s.r(t),s.d(t,{DriveItemModule:()=>C});var r=s(54456),i=s(73360),o=s(95201),n=s(84824),a=s(48496),c=s(45100),d=s(10979),u=s(26410),l=s(85230),h=s(7304),g=s(81376),p=s(49602),m=s(51676),I=s(90548),T=s(65172),S=s(75992);class v extends S.r{loggingData(){return{vroomId:this.vroomId,sharedWithUsersCount:String(this.userIds.length)}}constructor(e,t){super(v.actionType),this.vroomId=e,this.userIds=t}}v.actionType="PLW_SHARE_DRIVE_ITEM_SUCCEEDED";var f=s(32512);class D extends f.v{loggingData(){return{...super.loggingData(),vroomId:this.vroomId,sharedWithUsersCount:String(this.userIds.length)}}constructor(e,t,s,r,i){super(D.actionType,e,t,s),this.vroomId=r,this.userIds=i}}D.actionType="PLW_SHARE_DRIVE_ITEM_FAILURE";var y=s(52274),E=s(37535),P=s(36723),b=s(715),w=s(61035),A=s(64805),_=s(38752),L=s(74844),k=s(91246),R=s(76209),F=s(82841),x=s(69108),U=s.n(x);class C extends A.J{get name(){return"DriveItemModule"}async fetchDriveItem(e){this.loggers.traceLogger.logTrace(507897296,L.k.Verbose,`Get Drive Item [VroomId=${e}]`);const t=R.A.getDriveIdAndItemIdFromVroomId(e);if(null==t){const t={response:null,error:new Error(`Invalid VroomId [VroomId=${e}]`)};return Promise.reject(t)}const{driveId:s,itemId:o}=t;try{const t=await this.webApiProviders.graph(),i=await t.getDriveItem({driveId:s,itemId:o});return this.dispatcher.dispatchAction(new r.v(e,i)),this.loggers.traceLogger.logTrace(507897295,L.k.Verbose,`Fetch Drive Item - Success [VroomId=${e}]`),i}catch(n){const t=n;return this.loggers.traceLogger.logTrace(507897294,L.k.Warning,`Fetch Drive Item - Fail [VroomId=${e}]${(0,F.s8)(t)}`),this.dispatcher.dispatchAction(new i.N(t.response,t.response?.statusText??"",t.error?.message??"",e)),Promise.reject(t)}}async shareDriveItemAsync(e,t){this.loggers.traceLogger.logTrace(507897293,L.k.Verbose,`Share Drive Item [VroomId=${e}]`);const s=R.A.getDriveIdAndItemIdFromVroomId(e);if(null==s){const t={response:null,error:new Error(`Invalid vroomId [VroomId=${e}]`)};return Promise.reject(t)}const{driveId:r,itemId:i}=s;try{const s=await this.webApiProviders.graph();await s.shareDriveItemAsync({driveId:r,itemId:i,userIds:t}),this.dispatcher.dispatchAction(new v(e,t)),this.loggers.traceLogger.logTrace(507897292,L.k.Info,`Share Drive Item - Success [VroomId=${e}]`)}catch(o){const s=o;return this.loggers.traceLogger.logTrace(507897291,L.k.Warning,`Fetch Drive Item - Fail [VroomId=${e}]${(0,F.s8)(s)}`),this.dispatcher.dispatchAction(new D(s.response,s.response?.statusText??"",s.error?.message??"",e,t)),Promise.reject(s)}}async cancelUploadSession(e){this.dispatcher.dispatchAction(new o.S(e.id)),this.loggers.traceLogger.logTrace(507897290,L.k.Verbose,`Cancel Upload Session [SessionId=${e.id}]`);try{const t=await this.webApiProviders.taskService();await t.cancelUploadSession({uploadSession:e}),this.dispatcher.dispatchAction(new n.J(e.id)),this.loggers.traceLogger.logTrace(507897289,L.k.Verbose,`Cancel Upload Session - Success [SessionId=${e.id}]`)}catch(t){const s=t;return this.dispatcher.dispatchAction(new a.R(s.response,s.response?.statusText??"",s.error?.message??"",e.id)),this.loggers.traceLogger.logTrace(507897288,L.k.Warning,`Cancel Upload Session - Fail [SessionId=${e.id}]${(0,F.s8)(s)}`),Promise.reject(s)}}async getDriveItemThumbnail(e,t,s){this.loggers.traceLogger.logTrace(507897287,L.k.Verbose,"Get DriveItem Thumbnail - Success");const r=this.stores.groupDocumentsStore.getDriveItemThumbnail(e,t);if(null!=r)return r;const i=e=>this.stores.groupDocumentsStore.getDriveItemThumbnail(e.groupId,e.itemUrl),o=this.getCurrentViewIds();try{const r=await this.webApiProviders.graph(),n=await r.getDriveItemThumbnail({groupId:e,itemPath:s,itemUrl:t},i,o);return this.dispatcher.dispatchAction(new c.d(e,t,n)),this.loggers.traceLogger.logTrace(507897286,L.k.Verbose,"Get DriveItem Thumbnail - Success"),n}catch(n){const e=n;return this.loggers.traceLogger.logTrace(507897285,L.k.Warning,`Get DriveItem Thumbnail - Fail ${(0,F.s8)(e)}`),Promise.reject(e)}}async createUploadSession(e,t,s,r,i,o){const n=null!=i?i:k.o.generate();this.dispatcher.dispatchAction(new d.I(s,r,n));try{const r=await this.webApiProviders.taskService(),i=await r.createUploadSession({groupId:e,itemPath:t,session:s},o);return this.dispatcher.dispatchAction(new u.B(i,n)),this.loggers.traceLogger.logTrace(507897284,L.k.Verbose,`Create Upload Session - Success [SessionId=${s.id}]`),i}catch(a){const e=a;return this.dispatcher.dispatchAction(new l.t(e.response,e.response?.statusText??"",e.error?.message??"",s,r.id,n)),this.loggers.traceLogger.logTrace(507897283,L.k.Warning,`Create Upload Session - Fail [SessionId=${s.id}]${(0,F.s8)(e)}`),Promise.reject(e)}}async uploadBytesToSession(e,t,s,r,i,o,n){try{const a=await this.webApiProviders.taskService(),c=await a.uploadBytesToSession({uploadSession:e,b64Data:t,chunkSize:s,initialByteIndex:r,finalByteIndex:i,totalSize:o},n);return this.dispatcher.dispatchAction(new h.h(c)),this.loggers.traceLogger.logTrace(507897282,L.k.Verbose,`Upload Bytes To Session - Success [SessionId=${e.id}]`),c}catch(a){const t=a;return e=e.setProperty("lastUploadRequestSucceeded",!1),this.dispatcher.dispatchAction(new g.$(t.response,t.response?.statusText??"",t.error?.message??"",e)),this.loggers.traceLogger.logTrace(507897281,L.k.Warning,`Upload Bytes To Session - Fail [SessionId=${e.id}]${(0,F.s8)(a)}`),Promise.reject(a)}}async getGroupDocumentsInFolder(e,t){const s=this.getCurrentViewIds();return this.getGroupDocumentsInFolderPaged(e,t,s)}async fetchTaskReferenceThumbnails(e,t,s){if(this.loggers.traceLogger.logTrace(507897280,L.k.Verbose,"Fetch TaskReference Thumbnails]"),null==t)return[];const r=s.map(e=>this.fetchTaskReferenceThumbnail(e,t)),i=[];return(await Promise.allSettled(r)).forEach(e=>{"fulfilled"===e.status&&null!=e.value&&i.push(e.value)}),this.loggers.traceLogger.logTrace(507897251,L.k.Verbose,"Fetch TaskReference Thumbnails - Success]"),i}async getGroupDocumentsInFolderPaged(e,t,s,r){try{const i=await this.webApiProviders.graph(),o=await i.getGroupDocumentsInFolderPaged({groupId:e,folderId:t,skipToken:r},s);return this.dispatcher.dispatchAction(new p.W(e,t,o.data)),o.skipToken?this.getGroupDocumentsInFolderPaged(e,t,s,o.skipToken):(this.loggers.traceLogger.logTrace(507897250,L.k.Verbose,`Get GroupDocuments in Folder - Success [GroupId=${e}][FolderId=${t}]`),o)}catch(i){const s=i;return this.loggers.traceLogger.logTrace(507897249,L.k.Warning,`Get GroupDocuments in Folder - Fail [GroupId=${e}][FolderId=${t}]${(0,F.s8)(s)}`),Promise.reject(s)}}async fetchTaskReferenceThumbnail(e,t){if(null==t||null==e)return null;const s=t.getWorkloadUrl(E.P[E.P.Documents]);if(null==s)return null;const r=this.stores.groupDocumentsStore.getDriveItemThumbnail(t.id,e.url);if(null!=r)return r;let i=null;try{i=e.getItemPath(s)}catch(o){return this.loggers.traceLogger.logTrace(507648161,L.k.Warning,o.message),null}if(!k.o.isPlexTempId(e.url)&&e.isAttachmentPreviewable()&&null!=i)try{return await this.getDriveItemThumbnail(t.id,e.url,i)}catch(o){const s=o;return s.error instanceof y.U||this.dispatcher.dispatchAction(new m.z(t.id,e.url,s.response,s.response?.statusText??"",s.error?.message??"")),Promise.reject(o)}return null}async fetchTaskFormResponseThumbnail(e,t){const s=t.getWorkloadUrl(E.P[E.P.Documents]);if(null==s)return null;const r=e.slice(e.lastIndexOf(".")+1);if(-1===U()(P.ig,r))return null;const i=this.stores.groupDocumentsStore.getDriveItemThumbnail(t.id,e);if(null!=i)return i;const o=decodeURIComponent(s),n=decodeURIComponent(e).replace(o,"");try{return await this.getDriveItemThumbnail(t.id,e,n)}catch(a){const s=a;return s.error instanceof y.U||this.dispatcher.dispatchAction(new m.z(t.id,e,s.response,s.response?.statusText??"",s.error?.message??"")),Promise.reject(a)}}async fetchTaskFormResponseThumbnails(e,t){let s=[];const r=w.V.getLatestResponseAnswers(e);e.questions.forEach(e=>{if(e.questionType===b.x.FileUpload){const i=r.find(t=>t.questionId===e.id)?.answer1,o=(i?w.V.getImageUrls(i):[]).map(e=>this.fetchTaskFormResponseThumbnail(e,t));s=s.concat(o)}});const i=[];return(await Promise.allSettled(s)).forEach(e=>{"fulfilled"===e.status&&null!=e.value&&i.push(e.value)}),this.loggers.traceLogger.logTrace(507839184,L.k.Verbose,`Fetch Task Form Response Thumbnails - Success [groupId=${t.id}][formId=${e.formId}]`),i}async fetchFormResponse(e,t){try{let s;if(_.B.isUnoContext&&this.webApiProviders.retailService){const r=await this.webApiProviders.retailService();s=await r.fetchFormResponseAsync({taskId:e,formId:t})}else{const r=await this.webApiProviders.taskService();s=await r.getFormResponseAsync({taskId:e,formId:t})}return this.loggers.traceLogger.logTrace(507839182,L.k.Verbose,`Fetch Form Response - Success [FormId=${t}][TaskId=${e}]`),this.dispatcher.dispatchAction(new I.h(e,t,s)),s}catch(s){const r=s;return this.dispatcher.dispatchAction(new T.f(r.response,r.response?.statusText??"",r.error?.message??"",e,t)),this.loggers.traceLogger.logTrace(507839181,L.k.Warning,`Fetch Form Response - Fail [FormId=${t}][TaskId=${e}] ${(0,F.s8)(r)}`),Promise.reject(r)}}}},48496:(e,t,s)=>{"use strict";s.d(t,{R:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r){super(i.actionType,e,t,s),this.sessionId=r}}i.actionType="PLW_CANCEL_UPLOAD_SESSION_FAILED"},49602:(e,t,s)=>{"use strict";s.d(t,{W:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{groupId:this.groupId}}constructor(e,t,s){super(i.actionType),this.groupId=e,this.folderId=t,this.driveItems=s}}i.actionType="PLW_GET_GROUPDOCUMENTSINFOLDER_SUCCEEDED"},51676:(e,t,s)=>{"use strict";s.d(t,{z:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r,o){super(i.actionType,s,r,o),this.groupId=e,this.itemUrl=t}}i.actionType="PLW_GET_DRIVE_ITEM_THUMBNAIL_FAILED"},54456:(e,t,s)=>{"use strict";s.d(t,{v:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{vroomId:this.vroomId}}constructor(e,t){super(i.actionType),this.vroomId=e,this.driveItem=t}}i.actionType="PLW_GET_DRIVE_ITEM_SUCCEEDED"},61035:(e,t,s)=>{"use strict";s.d(t,{V:()=>i});class r{constructor(e){this.id=e.id,this.order=e.order,this.title=e.title,this.titleRT=e.titleRT,this.subtitle=e.subtitle,this.subtitleRT=e.subtitleRT,this.questionType=e.questionType}}r.fromWebResource=e=>new r({id:e.id,order:e.order,title:e.title,titleRT:e.formsProRTQuestionTitle,subtitle:e.subtitle,subtitleRT:e.formsProRTSubtitle,questionType:e.type});class i{static getLatestResponse(e){return e.responses[0]}static getLatestResponseAnswers(e){let t=[];const s=this.getLatestResponse(e);if(s?.answers)try{t=JSON.parse(s.answers)}catch(r){throw new Error(`Failed to parse form response answers: ${s.answers}, Error: ${r}`)}return t}constructor(e){this.formId=e.formId,this.displayName=e.displayName,this.questions=e.questions,this.responses=e.responses,this.formWebUrl=e.formWebUrl,this.formResponse=e.formResponse}}i.getImageUrls=e=>{try{return JSON.parse(e).map(e=>e.link)}catch(t){throw new Error(`Failed to parse form response file upload answer: ${e}, Error: ${t}`)}},i.fromWebResource=e=>new i({formId:e.formId,displayName:e.displayName,questions:e.questions.map(e=>r.fromWebResource(e)),responses:e.responses,formWebUrl:e.formWebUrl,formResponse:e.formResponse})},64805:(e,t,s)=>{"use strict";s.d(t,{J:()=>i});class r{get clientSettings(){return this.clientSettingsProvider()}constructor(e,t,s){this.dispatcher=e,this.clientSettingsProvider=t,this.loggers=s}}class i extends r{getCurrentViewIds(){const e=this.stores.appContextStore.getCurrentViewId();return e?[e]:void 0}constructor(e,t,s,r,i){super(e,r,i),this.webApiProviders=t,this.stores=s}}},65172:(e,t,s)=>{"use strict";s.d(t,{f:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r,o){super(i.actionType,e,t,s),this.taskId=r,this.formId=o}}i.actionType="PLW_GET_FORM_RESPONSE_FAILED"},69108:(e,t,s)=>{var r=s(88468),i=s(99140),o=Math.max;e.exports=function(e,t,s){var n=null==e?0:e.length;if(!n)return-1;var a=null==s?0:i(s);return a<0&&(a=o(n+a,0)),r(e,t,a)}},73360:(e,t,s)=>{"use strict";s.d(t,{N:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r){super(i.actionType,e,t,s),this.vroomId=r}}i.actionType="PLW_GET_DRIVE_ITEM_FAILURE"},76209:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var r,i=s(54320),o=s.n(i),n=s(93672),a=s.n(n),c=s(78332),d=s(50605);class u{static generateNumberWithLength(e){const t=Math.pow(10,e-1),s=Math.pow(10,e);return Math.floor(Math.random()*(s-t)+t)}}!function(e){e.getBreadcrumbString=function(e){if(null==e)return"";const t=(0,d.jI)()?" < ":" > ";return e.join(t)},e.generateNewMailNickname=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";return s+(e=(e=e.replace(/([^a-zA-Z0-9_-])/g,"")).substring(0,c.LO-t-s.length-r.length))+(t>0?u.generateNumberWithLength(t).toString():"")+r},e.isValidEmail=function(e){return!o()(e)&&new RegExp(/^[a-zA-Z0-9.!#$%&\u2019*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/).test(e)},e.isValidGuid=function(e){return"{"===e[0]&&(e=e.substring(1,e.length-1)),new RegExp("^({){0,1}[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}(}){0,1}$").test(e)},e.getDriveIdAndItemIdFromVroomId=function(e){if(!a()(e,c.R))return null;const t=e.indexOf("_"),s=e.lastIndexOf("_");if(-1!==t&&t!==s){return{driveId:e.substr(t+1,s-t-1),itemId:e.substr(s+1)}}return null},e.getVroomIdFromDriveIdAndItemId=function(e,t){return e&&t?`${c.R}${e}_${t}`:null}}(r||(r={}))},81376:(e,t,s)=>{"use strict";s.d(t,{$:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r){super(i.actionType,e,t,s),this.session=r}}i.actionType="PLW_UPLOAD_BYTES_TO_SESSION_FAILED"},84824:(e,t,s)=>{"use strict";s.d(t,{J:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{sessionId:this.sessionId}}constructor(e){super(i.actionType),this.sessionId=e}}i.actionType="PLW_CANCEL_UPLOAD_SESSION_SUCCEEDED"},85230:(e,t,s)=>{"use strict";s.d(t,{t:()=>i});var r=s(32512);class i extends r.v{constructor(e,t,s,r,o,n){super(i.actionType,e,t,s),this.session=r,this.taskId=o,this.updateKey=n}}i.actionType="PLW_UPLOAD_SESSION_FAILED"},90548:(e,t,s)=>{"use strict";s.d(t,{h:()=>i});var r=s(75992);class i extends r.r{constructor(e,t,s){super(i.actionType),this.taskId=e,this.formId=t,this.formResponse=s}}i.actionType="PLW_GET_FORM_RESPONSE_SUCCEEDED"},95201:(e,t,s)=>{"use strict";s.d(t,{S:()=>i});var r=s(75992);class i extends r.r{loggingData(){return{sessionId:this.sessionId}}constructor(e){super(i.actionType),this.sessionId=e}}i.actionType="PLW_CANCEL_UPLOAD_SESSION"}}]);
//# sourceMappingURL=driveitemmodule.cc5d26c5.chunk.js.map