(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[9770],{2269:(e,t,r)=>{"use strict";r.r(t),r.d(t,{UserActionCreator:()=>W});var s=r(86178),i=r.n(s),n=r(49226),a=r(53672),o=r(24367),c=r(15507),l=r(28296),u=r(59923),d=r(50739),h=r(79558),p=r(91955),g=r(81332),m=r(36591),S=r(38629),P=r(38752),f=r(95783),y=r(64226),T=r(96891),U=r(77508),w=r(99908),M=r(81206),C=r(3854),x=r(27916),v=r(97498),b=r(52274),k=r(76171),I=r(86053);class j extends k.m{name(){return"ProjectTrialToast"}constructor(e,t,r){const s=I.p.Strings.Toasts_ProjectTrialAcquisitionSuccessful,i=t?I.p.Strings.Toasts_CopyPlanToProject:I.p.Strings.Toasts_OpenProject,n={mainContent:k.m.getMainContent(i,e,`${s} - `,void 0,()=>r?.(this.id)),ariaAlertMessage:s,onDismiss:()=>{},projectLink:e,toastDataType:k.m.toastDataType};super(j.type,n),this.timeout=-1}}j.type="PROJECT_TRIAL_TOAST";var E=r(35375),L=r(63615),O=r(66878),A=r(67188),R=r(18113),F=r(74844),D=r(80493),B=r(21382),H=r(33268),$=r(22514);class W extends m.C{get name(){return T.M.UserActionCreator}async fetchUsers(e,t){(await this.logicModuleProviders.userModule()).fetchUsersAsync(e,t).catch(e=>{})}async fetchUsersForContainer(e,t,r){const s=await this.logicModuleProviders.userModule(),i=await this.logicModuleProviders.notificationModule();s.fetchUsersForContainerAsync(e,t,r).catch(t=>i.handleRequestFailures(t,[],[f.t3.Forbidden,f.t3.NotFound],y.fc.GetGroupMembersError,e.externalId))}async fetchUsersWithKeyword(e){return(await this.logicModuleProviders.userModule()).fetchUsersWithKeyword(e)}async fetchUserPhoto(e){(await this.logicModuleProviders.userModule()).fetchUserPhotoAsync(e).catch(e=>{})}async fetchUserAccessibleSensitivityLabels(){(await this.logicModuleProviders.userModule()).fetchUserAccessibleSensitivityLabelsAsync().catch(e=>{})}async updateUserCulture(){const e=await this.logicModuleProviders.userModule(),t=[e.fetchUserAsync(P.B.currentUserId,!0),e.fetchCurrentUserDetailsAsync()];Promise.allSettled(t).then(e=>{if("fulfilled"!==e[0].status||"fulfilled"!==e[1].status)return;const t=e[0].value,r=e[1].value;if(null!=t&&null!=r&&null!=r.userData&&(null!=r.userData.settings||null!=t.preferredLanguage)&&(null==r.userData.settings||r.userData.settings.culture!==t.preferredLanguage)){const e=r.setUserCulture(t.preferredLanguage),s=null==t.preferredLanguage?"":t.preferredLanguage.toLowerCase();this.loggers.usageLogger.logData(this.name,"updateUserCulture",{mismatch:String(P.B.culture.toLowerCase()!==s)}),this.updateUserDetails(r,e)}})}async updateUserDetails(e,t){(await this.logicModuleProviders.userModule()).updateUserDetailsAsync(e,t).catch(e=>{})}updateUserTheme(e){this.dispatcher.dispatchAction(new c.k(e))}overrideProductLicense(e,t){this.dispatcher.dispatchAction(new l.n(e,t))}overrideProjectUpsellMode(e){this.dispatcher.dispatchAction(new d.i(e))}async addUsersToContainer(e,t){const r=await this.logicModuleProviders.containerModule(),s=await this.logicModuleProviders.notificationModule();r.addUsersToContainerAsync(t,e).then(void 0,t=>{if(!(t.error instanceof b.U)){const r=t.response?.status,i=t.response?.statusText,n=t.error?.name;r===f.t3.NotImplemented?this.loggers.traceLogger.logTrace(508069716,F.k.Error,"addUsersToGroup - Not Implemented"):n===x.Zg?s.showInfoInternal(y.fc.PlanConvertingInfo):s.showErrorInternal(y.fc.AddUsersToGroupError,r,i,e.length.toString(),t.response)}})}async removeUserFromContainer(e,t){const r=await this.logicModuleProviders.containerModule(),s=await this.logicModuleProviders.notificationModule();r.removeUserFromContainerAsync(t,e).then(void 0,t=>{if(!(t.error instanceof b.U)){const r=t.error?.name;if(r===x.Zg)s.showInfoInternal(y.fc.PlanConvertingInfo);else{const r=t.response?.status,i=t.response?.statusText;s.showErrorInternal(y.fc.RemoveUserFromGroupError,r,i,e,t.response)}}})}async fetchCurrentUserLicenses(){const e=this.entityStoreSet.appContextStore.getCurrentUserId(),t=this.entityStoreSet.appContextStore.getFlights().EnforceLicenseCheck?R.Q.Priority1:R.Q.Priority5;(await this.logicModuleProviders.userModule()).fetchUserLicensesAsync(e,t).then(t=>{this.loggers.usageLogger.logData(this.name,T.M.GetUserLicenses,{tenantId:P.B.tenantId,userId:e,plannerLicenseStatus:t[w.b.Planner]})}).catch(e=>{})}async fetchCurrentUserProjectSubscriptionStatus(e){try{const t=await this.logicModuleProviders.projectModule(),r=this.entityStoreSet.appContextStore.getFlights(),s=await t.fetchCurrentUserSubscriptionStatusV2(e),n=s?.trialOffer,a=s.highestTrialSubscription?.subscriptionStatus,o=a===S.gr.Disabled||a===S.gr.InGracePeriod||a===S.gr.Deprovisioned?T.M.SessionExpiredTrial:T.M.SessionShowsTryProject,c=n?.p3DepartmentalTrial?.eligibilityStatus,l=n?.p1DepartmentalTrial?.eligibilityStatus;if(n&&(c===S.RG.EligibleToRequestOnly?this.loggers.usageLogger.logData(this.name,`${o}-P3-EligibleToRequestOnly`):c===S.RG.EligibleForSelfService?this.loggers.usageLogger.logData(this.name,`${o}-P3-EligibleForSelfService`):l===S.RG.EligibleToRequestOnly?this.loggers.usageLogger.logData(this.name,`${o}-P1-EligibleToRequestOnly`):l===S.RG.EligibleForSelfService&&this.loggers.usageLogger.logData(this.name,`${o}-P1-EligibleForSelfService`)),!n&&s?.highestTrialSubscription?.subscriptionType===S.h3.Trial&&s?.highestTrialSubscription?.subscriptionStatus===S.gr.Active){const e=i()(s?.highestTrialSubscription?.expiryDate).diff(i()(),"days");e>=0&&e<28&&$.q.logFloodgateActivity(C.zs,this.loggers.traceLogger),this.loggers.usageLogger.logData(this.name,T.M.SessionShowsGoToProject)}if(r.EnableProjectLandingPageCalls&&r.EnableImportPlanForProjectUsers){if((await t.fetchUserFeatureEntitlementsAsync()).premiumPlan.accessType===A.HX.readWrite){const e=await this.logicModuleProviders.tenantModule();await e.fetchHasProjectCogs()}}else if(s.hasLicense&&s.currentOrNextSubscription?.subscriptionType===S.h3.Paid&&r.EnableImportPlanForProjectUsers){const e=await this.logicModuleProviders.tenantModule();await e.fetchHasProjectCogs()}}catch(t){}}clearProjectSubscriptionStatus(e){this.dispatcher.dispatchAction(new u.w(e))}async fetchCurrentUserProjectTrialOperationStatus(e){try{const t=await this.logicModuleProviders.projectModule();await t.fetchCurrentUserTrialOperationStatus(e)}catch(t){}}async startProjectTrialAndPlanImport(e,t){try{const r=await this.logicModuleProviders.projectModule();if(P.B.clientSettings.Flights.EnableAutoClaimPlanner){(await r.claimSubscription()).assignedProductSkuId&&await this.processImportToProject(e,t)}else{const s=this.entityStoreSet.userStore.p3TrialEligibilityStatus()===S.RG.EligibleForSelfService?S._H.P3_Departmental:S._H.P1_Departmental;await r.acquireTrialForCurrentUserV2(s),await this.processImportToProject(e,t)}}catch(r){}}async toggleUserFavoritePlanStatus(e){const t=this.entityStoreSet.appContextStore.getCurrentUserId(),r=this.entityStoreSet.userStore.getUserDetailsById(t)?.favoritePlans;let s=!1;if(null!=r?.references){s=null!=r.references[e.id];const t=s?r.removePlanReference(e.id):r.setPlanReference(e.id,E.j.builder.withPropertyBag({planTitle:e.title}).build());this.dispatcher.dispatchAction(new h.d(t))}}async updateUserFavoritePlans(e){this.dispatcher.dispatchAction(new h.d(L.H.builder.withPropertyBag({favoritePlanReferences:e}).build()))}async updateUserRecentPlans(e){this.dispatcher.dispatchAction(new p.E(O.E.builder.withPropertyBag({references:e}).build()))}async hidePreReleaseBusinessBanner(){this.dispatcher.dispatchAction(new g.H)}async processTrialOperationStatus(e,t,r,s,i){switch(e.operationStatus){case S.LH.Initialized:case S.LH.Pending:this.checkProjectTrialOperationStatusRecursive(t,r,s,i);break;case S.LH.Completed:await this.processImportToProject(s,i);case S.LH.Failed:}}async processImportToProject(e,t){const r=this.entityStoreSet.appContextStore.getExperiment(M.b.UpsellImportPlan)===M.b.UpsellImportPlan_treatment;let s=null;const i=this.entityStoreSet.appContextStore.getCurrentDialogData();if(i.dialogType===v.h.TryProjectDialog&&(s=r&&t?D.b.safelyOpenExternalUrl((0,H.lo)(t)):D.b.safelyOpenExternalUrl(this.generateProjectRedirectUrl(e),"_blank"),null==s&&this.loggers.traceLogger.logTrace(507581902,F.k.Info,"Project popup was blocked, showing a toast"),this.dispatcher.dispatchAction(new n.u(i))),null==s){let s;const i=e=>{this.dispatcher.dispatchAction(new a.n(e))};s=r&&t?new j((0,H.lo)(t),!0,i):new j(this.generateProjectRedirectUrl(e),!1,i),this.dispatcher.dispatchAction(new o.Z(s))}await this.fetchCurrentUserProjectSubscriptionStatus(!0)}async checkProjectTrialOperationStatusRecursive(e,t,r,s){if(!(t>=this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryMaxCount))try{const i=await this.logicModuleProviders.projectModule();setTimeout(async()=>{try{const n=await i.fetchCurrentUserTrialOperationStatus(e);await this.processTrialOperationStatus(n,e,t+1,r,s)}catch(n){}},this.entityStoreSet.appContextStore.getECSSettings().ProjectTrialOperationStatus.RetryInterval)}catch(i){}}generateProjectRedirectUrl(e){switch(e){case U.b4.PlanTimelinePage:const e=this.entityStoreSet.appContextStore.getExperiment(M.b.UpsellTimelinePage);return e===M.b.UpsellTimelinePage_control||e===M.b.UpsellTimelinePage_treatment?B.G((0,H.sN)(),M.b.UpsellTimelinePage):(0,H.XY)();case U.b4.TryProjectDialog:case U.b4.PlanGridPage:default:return(0,H.XY)()}}constructor(e,t,r,s){super(e,t,r,P.B.clientSettings,s)}}},12358:(e,t,r)=>{var s=r(95694),i=r(41069),n=/[&<>"']/g,a=RegExp(n.source);e.exports=function(e){return(e=i(e))&&a.test(e)?e.replace(n,s):e}},27916:(e,t,r)=>{"use strict";var s,i,n,a,o;r.d(t,{Zg:()=>c}),function(e){e[e.OK=0]="OK",e[e.ContainsDefaultReservedWords=1]="ContainsDefaultReservedWords",e[e.MissingPrefixSuffix=2]="MissingPrefixSuffix",e[e.ContainsCustomBlockedWords=3]="ContainsCustomBlockedWords",e[e.ContainsMSStandardBlockedWords=4]="ContainsMSStandardBlockedWords",e[e.MailNicknameNotOK=5]="MailNicknameNotOK",e[e.Unknown=6]="Unknown"}(s||(s={})),function(e){e.Forbidden="Forbidden",e.NotFound="NotFound",e.CreatePlanForGroupFailed="CreatePlanForGroupFailed",e.MaximumPlansOwnedByUserReached="MaximumPlansOwnedByUserReached",e.UnknownError="UnknownError"}(i||(i={})),function(e){e.Offline="Offline"}(n||(n={})),function(e){e.DynamicImportError="DynamicImportError"}(a||(a={})),function(e){e.MaximumProjectsOwnedByUser="MaximumProjectsOwnedByUser",e.MaximumProjectsSharedWithUser="MaximumProjectsSharedWithUser",e.MaximumTasksCreatedByUser="MaximumTasksCreatedByUser",e.MaximumTasksAssignedToUser="MaximumTasksAssignedToUser",e.MaximumTasksInProject="MaximumTasksInProject",e.MaximumActiveTasksInProject="MaximumActiveTasksInProject",e.MaximumBucketsInProject="MaximumBucketsInProject",e.MaximumUsersSharedWithProject="MaximumUsersSharedWithProject",e.MaximumReferencesOnTask=" MaximumReferencesOnTask",e.MaximumChecklistItemsOnTask="MaximumChecklistItemsOnTask",e.MaximumAssigneesInTasks="MaximumAssigneesInTasks",e.MaximumFavoritePlansForUser="MaximumFavoriteProjectsForUser",e.MaximumRecentPlansForUser="MaximumRecentProjectsForUser",e.MaximumContextsOnPlan="MaximumContextsOnPlan"}(o||(o={}));const c="ArchivedEntityCanNotBeUpdated"},33268:(e,t,r)=>{"use strict";r.d(t,{XY:()=>f,lo:()=>P,sN:()=>y,wS:()=>S});var s=r(38752),i=r(8453),n=r(72761),a=r(40468),o=r(12358),c=r.n(o),l=r(54320),u=r.n(l),d=r(74844),h=r(74065),p=r.n(h),g=r(85855),m=r.n(g);class S{static getFavIconUrl(e){return"https://"+S.extractHostname(e)+"/favicon.ico"}static generateEntityHyperlink(e,t,r,s){switch(e.entityType){case n.I.Task:return this.generateTaskHyperLink(e,t,r,s);case n.I.Plan:return this.generatePlanHyperLink(e,t,r,s);default:throw new Error("NotSupportedException: entity.type")}}static generateEntityLink(e,t,r,s){switch(e.entityType){case n.I.Task:return this.generateTaskLink(e,t,r,s);case n.I.Plan:return this.generatePlanLink(e,t,r,s);default:throw new Error("NotSupportedException: entity.type")}}static generateOWAGroupEmailSettingsLink(e,t,r){if(u()(e))return r.logTrace(508047762,d.k.Warning,"Empty owa host. Hiding the whole owa link."),"";if(u()(t)||t.indexOf("@")<0||t.indexOf("@")!==t.lastIndexOf("@"))return`https://${e}`;{const r=t.split("@")[0];return`https://${e}/mail/group/${t.split("@")[1]}/${r}/action/EmailSettings`}}static extractHostname(e){let t="";return t=e.indexOf("://")>-1?e.split("/")[2]:e.split("/")[0],t=t.split(":")[0],t=t.split("?")[0],t=t.split("#")[0],t}static getPlanExternalUrl(e,t){const r=a.T.builder.withPlan(e).withDetails(t).build(),s=r.getCreationContextInfo()?.key;let i=null;return s&&(i=t.contextDetails[s].url??null),i}static generateTaskHyperLink(e,t,r,s){return'<a href="'+this.generateTaskLink(e,t,r,s)+'" target="_blank" rel="noopener noreferrer">'+c()(e.title)+"</a>"}static generatePlanHyperLink(e,t,r,s){return'<a href="'+this.generatePlanLink(e,t,r,s)+'" target="_blank" rel="noopener noreferrer">'+c()(e.title)+"</a>"}static generateTaskLink(e,t,r,n){return e.creationSource.external?.contextScenarioId===i.z.project&&e.creationSource.external?.webUrl?e.creationSource.external?.webUrl:this.generatePlannerLink(`${s.B.absoluteRedirectRoot}/Home/Task/${e.id}`,t,r,n)}static generatePlanLink(e,t,r,i){return this.generatePlannerLink(`${s.B.absoluteRedirectRoot}/Home/PlanViews/${e.id}`,t,r,i)}static generatePlannerLink(e,t,r,s){return`${e}?Type=${t}&Channel=${r}&CreatedTime=${621355968e9+1e4*s.getTime()}`}static getValidUrl(e){const t=S.formatUrlWithHttpUrlScheme(e);return S.validateUrl(t)}static formatUrlWithHttpUrlScheme(e){return S.getUrlScheme(e).toLowerCase()===S.httpScheme?S.ensureUrlScheme(e,S.httpScheme):S.ensureUrlScheme(e,S.httpsScheme)}static validateUrl(e){try{const t=new URL(e);if(!t.host||!t.hostname||!t.origin||"null"===t.origin||"http:"!==t.protocol&&"https:"!==t.protocol)return;return t.toString()}catch{return}}static getUrlScheme(e){const t=new RegExp("(.*)://.*","i").exec(e)||[];return p()(t)||""}static ensureUrlScheme(e,t){return`${t&&m()(t.split("://"))}://${S.removeUrlScheme(e)}`}static removeUrlScheme(e){const t=new RegExp("(http(s)?(:)?(//)?)*(.*)","i").exec(e)||[];return p()(t)||""}static getQueryParamValue(e,t){return new URLSearchParams(new URL(e).search).get(t)}}function P(e){return`${T()}hubnew?importPlanId=${e}`}function f(){return`${s.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname}trialFRE#templates`}function y(){return`${s.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname}trialFRE#templates/{0}`}function T(){return`${s.B.clientSettings.ECSSettings.ProjectServiceConfig.Hostname}${s.B.tenantDomain}/${s.B.culture}#/`}S.httpScheme="http",S.httpsScheme="https"},36591:(e,t,r)=>{"use strict";r.d(t,{C:()=>s});class s{constructor(e,t,r,s,i){this.dispatcher=e,this.logicModuleProviders=t,this.entityStoreSet=r,this.clientSettings=s,this.loggers=i}}},53672:(e,t,r)=>{"use strict";r.d(t,{n:()=>i});var s=r(75992);class i extends s.r{loggingData(){return{toastId:this.toastId}}constructor(e){super(i.actionType),this.toastId=e}}i.actionType="DISMISS_TOAST_NOTIFICATION"},67188:(e,t,r)=>{"use strict";var s,i,n,a;r.d(t,{HX:()=>s,eN:()=>n}),function(e){e.noAccess="noAccess",e.readOnly="readOnly",e.restrictedReadWrite="restrictedReadWrite",e.readWrite="readWrite"}(s||(s={})),function(e){e.none="none",e.noModProjLicenseInTenant="noModProjLicenseInTenant",e.noRoadmapLicenseInTenant="noRoadmapLicenseInTenant",e.p1ProjectOnlineEssentials="p1ProjectOnlineEssentials"}(i||(i={})),function(e){e.basic="basic",e.basicPlus="basicPlus",e.standard="standard",e.professional="professional",e.premium="premium"}(n||(n={})),function(e){e.commercial="Commercial",e.commercialEducation="Commercial Education"}(a||(a={}));var o;!function(e){e.roadmap="roadmap",e.premiumPlan="premiumPlan",e.projectOnline="projectOnline",e.projectOperations="projectOperations"}(o||(o={}))},72037:e=>{e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},76171:(e,t,r)=>{"use strict";r.d(t,{m:()=>n});var s=r(33183),i=r(65043);class n extends s.M{static getMainContent(e,t,r,s,n){return i.createElement("span",null,r,i.createElement("a",{href:t,target:"_blank",rel:"noopener noreferrer",onClick:n},e),s)}}n.toastDataType="LINK_TOAST_DATA"},85855:(e,t,r)=>{e.exports=r(96483)},95694:(e,t,r)=>{var s=r(72037)({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});e.exports=s},96483:e=>{e.exports=function(e){return e&&e.length?e[0]:void 0}}}]);
//# sourceMappingURL=userac.90c68207.chunk.js.map