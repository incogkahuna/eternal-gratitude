"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[35848],{30946:(e,t,r)=>{function i(e){const t=btoa(e);return t.replace(/(\+|\/|\=)/g,e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError(`Unexpected match ${e} encountered in urlEncodeBase64String. Only +/= are to be replaced.`)})}r.d(t,{A7:()=>o,x7:()=>s});var n=r(60835);async function o(e,t,r){const{siteUrl:i,driveId:o,fileId:a}=t,d=await(0,n.sN)(e,i,o,a,r);if(!d)throw new Error("Failed to fetch file sharepoint ids");return s(d,a)}function s(e,t){const{siteId:r,webId:n,listId:o}=e;return`SPO_${i(`${r},${n},${o}`)}_${t}`}},37097:(e,t,r)=>{r.d(t,{cC:()=>l,dm:()=>u});var i=r(33788),n=r(40635),o=r(74405),s=r(29018),a=r(72376),d=r(25969),c=r(30946);async function l(e,t,r,l,u,p){let m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const h="GetFilePreviewMetadataResponse",g=i.m.start(h,u),f=(0,s.$)(t),I={getToken:i=>{if(i){const n={...i,siteUrl:t,driveId:r,itemId:l};return e.getToken((0,d.K)(f),n)}throw Error("Options must be specified")},url:`${f}/_api/v2.0/drives/${r}/items/${l}?$select=lastModifiedDateTime,lastModifiedBy,name,title,alternateFileIconUrl${m?",sharepointIds":""}`,tenantId:p,requestInit:{method:"GET"},retryPolicy:a._9,tokenPolicy:(0,a.N$)(e)},w=u?(0,n.g)({...I,logger:u,nameForLogging:h,doNotLogOnSuccess:!0,getAdditionalProps:async e=>(0,o.u)(e)}):(0,n.y)(I);let v;try{v=(await w).result,g.setResult(!0)}catch(y){return void g.setResult(!1,void 0,y)}if(v.ok)try{const e=await v.json();return{lastModified:{dateTime:new Date(e.lastModifiedDateTime),user:e.lastModifiedBy.user.displayName||e.lastModifiedBy.user.email},title:e.title||e.name.substring(0,e.name.lastIndexOf(".")),pageIcon:e.alternateFileIconUrl,pageCover:e.pageCover,spoId:m?(0,c.x7)(e.sharepointIds,l):void 0}}catch(y){g.setResult(!1,void 0,y)}else try{const e=await v.json();return{statusCode:v.status,errorMessage:`${e.error.code}${e.error.innerError?` (${e.error.innerError})`:""}: ${e.error.message}`}}catch(y){g.setResult(!1,void 0,y)}}function u(e){return void 0===e||"errorMessage"in e}},42103:(e,t,r)=>{r.r(t),r.d(t,{MTSFoundInPlacesInfo:()=>q});var i=r(99671),n=r(83125),o=r(33788),s=r(48680),a=r(46624);const d=r(95996).hO;var c=r(37097),l=r(53948),u=r(2953),p=r(53383);function m(e){let t="Prod";if(e)switch(e.audience){case"Development":t="Development";break;case"Staging":t="Staging";break;case"Dogfood":t="Dogfood";break;case"Preview":t="Preview";break;case"Production":default:t="Prod";break;case"GCC":t="Gcc";break;case"GCC-High":t="GccHigh";break;case"DoD":t="DoD"}return t}async function h(e){const{backlink:t,logger:r,settingsProvider:i,tokenProvider:n}=e,o=(0,l.f1)(t.page_id),s=await(0,c.cC)(n,`https://${o.siteDomain}`,o.driveId,o.itemId,r);if((0,c.dm)(s))return;const a=function(e,t,r){const i={u:e,r:!1},n={w:t?{u:(0,l.xo)(t),r:!1}:void 0,p:i},o=(0,u.M8)(n),s=m(r);return`${(0,p.qh)(s,"v2")}${o}`}((0,l.xo)(t.page_id),t.workspace_id,i);return{icon:s.pageIcon,title:s.title,url:a}}var g=r(30946),f=r(17107),I=r(17601),w=r(40635),v=r(98140),y=r(46507);async function k(e){const{existingFileInfo:t,documentPodId:r,tokenProvider:i}=e,n=t?await(0,g.A7)(i,t):"",o=`fileId=${r??n}`;return await P({...e,urlParams:o,subErrorName:"FluidLoopComponent"})}async function P(e){const{settingsProvider:t,subErrorName:r,userContext:i,logger:n,tokenProvider:o,urlParams:s}=e,a=t?t.audience:"Production",c=(0,y.l)(a),l=(0,f.O)(a),u=`${c}/recommended/api/beta/loop/sharedlocations?${s}`,p=_(u,o,t),m=U(t),h=n&&i?await(0,I.k)({url:u,requestInit:m,scopes:l,retryPolicy:f.B,logger:n,nameForLogging:"MTSFoundInPlaces",user:i.user,tokenProvider:o}):await(0,w.y)(p);return await h.result.json().then(e=>{if(b(e))return e;throw new Error("Invalid MTS response")}).catch(e=>{n&&d(n,{eventName:"MtsApiJsonParsingError",subErrorName:r},e)})}const U=e=>({method:"GET",headers:{"Client-Request-Id":crypto.randomUUID(),"X-Office-Application":"300","X-Office-AudienceGroup":e?.audience??"","X-Office-Platform":(0,v.Fr)()?"Mobile":"Web"}}),_=(e,t,r)=>({getToken:e=>{if(e){const i=r?r.audience:"Production",n=(0,f.O)(i);return t.getToken(n,e)}throw Error("Options must be specified")},url:e,requestInit:U(r),retryPolicy:f.B}),b=e=>"object"===typeof e&&null!==e&&e.hasOwnProperty("sharing_history")&&Array.isArray(e.sharing_history),E=0,x=1,$=2,T=3,M=4,C=5,R=6,F=7;function D(e,t){switch(e){case void 0:case E:return{host:"Outlook",location:"Email"};case x:return{host:"Teams",location:"Chat"};case $:return{host:"Outlook",location:"Calendar"};case T:return{host:"Teams",location:"Channel"};case M:case C:return{host:"Loop",location:"Workspace"};case R:switch(t){case"Word":return{host:"Word",location:"other"};case"Whiteboard":return{host:"Whiteboard",location:"other"};case"Fluid":return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}case F:return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}}var O=r(13379);var N=r(60980),L=r(78010),S=r(45296);async function A(e,t,r){if(void 0===t)return;let i;if("string"===typeof t){const n=await async function(e,t,r){try{return await(0,N.j)(e,t,r)}catch{return}}(t,e,r);i=n?{odspItem:{siteUrl:n.siteUrl,driveId:n.driveId,itemId:n.itemId},fileName:n.fileName}:void 0}else{const n=await async function(e,t,r){try{const i=r?await(0,L.N)(e,t,r):void 0;return i?.name}catch{return}}(t,e,r);i={odspItem:t,fileName:n}}if(void 0===i?.odspItem)return;const n=function(e){const t=e.fileName,r=e.odspItem;if(void 0===t||!j(t))return;const i={siteDomain:new URL(r.siteUrl).hostname,driveId:r.driveId,itemId:r.itemId};return(0,l.an)(i)}(i);return{odspItem:i.odspItem,podId:n}}const j=e=>{const t=(0,S.Q)(e).toLowerCase();return"loop"===t||"fluid"===t};class q{constructor(e,t,r,i){this.tokenProvider=e,this.settingsProvider=t,this.logger=r,this.userContext=i,this.logger&&(this.logger=new n.p("MTSFoundInPlacesInfo",this.logger))}get FoundInPlacesInfo(){return this}async getFoundInPlaces(e){const t=o.m.start("GetFoundInPlaces",this.logger);try{let n;try{n=(0,i.Mh)(new URL(e))}catch(r){throw new Error("InvalidComponentUrlError")}const o=await A(this.tokenProvider,n??e,this.logger),s=await this.getMTSFoundInPlacesResponse(this.tokenProvider,o?.odspItem??e,this.logger,o?.podId),a=await this.transformMTSResponse(s??{},o?.odspItem);return t.setResult(!0),a}catch(r){return t.setResult(!1,{errorType:"GetFoundInPlacesFailed",isUserImpacting:!0},r),{places:[]}}}async getMTSFoundInPlacesResponse(e,t,r,i){const n=r||this.logger,o={tokenProvider:e,logger:n,settingsProvider:this.settingsProvider,userContext:this.userContext};let s;return i?s=await k({...o,documentPodId:i}):"string"===typeof t?s=await async function(e){const{documentUrl:t}=e,r=`externalUrl=${t}`;return await P({...e,urlParams:r,subErrorName:"FluidNonLoopComponent"})}({...o,documentUrl:t}):t&&(s=await k({...o,existingFileInfo:{siteUrl:t.siteUrl,driveId:t.driveId,fileId:t.itemId}})),void 0===s&&n&&d(n,{eventName:"MtsApiResponseUndefinedError"}),s}async transformMTSResponse(e,t){if(void 0===e.sharing_history)return{places:[]};const r=e.sharing_history.map(async e=>{let r;if(function(e){return(e.sharing_medium===M||e.sharing_medium===C)&&e.hasOwnProperty("workspace")}(e)){const{host:i,location:n}=D(e.sharing_medium),{title:o,url:s}=function(e,t,r){const{title:i,mfs_info:n}=e,o=n.pod_id,s=(0,l.f1)(o),a=m(r);return{title:i,url:t?(0,O.a)({page:{siteOrigin:t.siteUrl,driveId:t.driveId,itemId:t.itemId},pageWorkspaceContext:{driveId:s.driveId,itemId:s.itemId}},a):void 0}}(e.workspace,t);r={host:i,location:n,subject:o,url:s}}else if(function(e){return e.sharing_medium===R&&e.hasOwnProperty("file")}(e)){const{host:t,location:i}=D(e.sharing_medium,e.file.type),{title:n}=e.file;r={host:t,location:i,subject:n,url:e.sharing_reference_url}}else if(function(e){return e.sharing_medium===F&&e.hasOwnProperty("backlink")}(e)&&this.includeBacklinksInList()){const{host:t,location:i}=D(e.sharing_medium),n=await h({backlink:e.backlink,tokenProvider:this.tokenProvider,logger:this.logger});r=n?{host:t,location:i,subject:n.title,url:n.url,icon:n.icon}:void 0}else if(function(e){return(e.sharing_medium===E||e.sharing_medium===$||e.sharing_medium===x||e.sharing_medium===T||void 0===e.sharing_medium)&&e.hasOwnProperty("sharing_reference_url")}(e)){const{host:t,location:i}=D(e.sharing_medium);r={host:t,location:i,subject:e.teams_name&&e.teams_channel_name?`${e.teams_name} / ${e.teams_channel_name}`:e.subject??"",createdDate:e.shared_time?new Date(e.shared_time):void 0,url:e.sharing_reference_url,author:{name:e.sharer?.display_name??"",email:e.sharer?.smtp},collaborators:e.participants?.map(e=>({name:e.display_name,email:e.smtp}))}}return r});return{places:(await Promise.all(r)).filter(e=>void 0!==e)}}includeBacklinksInList(){if(void 0===this.settingsProvider)return!1;let e=(0,s.AU)("loopApp.sharelinkBacklinkUXConvergence",!1,this.settingsProvider);return this.userContext?.user.tenantId===a.DR&&(e=e&&(0,s.AU)("loopApp.msabacklinks",!1,this.settingsProvider)),e}}},60980:(e,t,r)=>{r.d(t,{j:()=>p});var i=r(40635),n=r(74405),o=r(25969),s=r(72376),a=r(78796),d=r(18206),c=r(46624);const l=["files.readwrite.all"],u="https://graph.microsoft.com/v1.0";async function p(e,t,r){const p=new URL(e),m=p.origin,h="Consumer"===t.identityType&&m===a.W,g=btoa(p.toString()).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),f={getToken:e=>{if(e){const r={...e,siteUrl:m};return t.getToken(h?l:(0,o.K)(m),h?e:r)}throw Error("Options must be specified")},url:`${h?u:`${m}/_api/v2.0`}/shares/u!${g}/driveItem?select=id,name,parentReference,sharepointIds,package,folder,lastModifiedDateTime`,requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:h?d.XM:s._9,tokenPolicy:h?void 0:(0,s.N$)(t)},I=r?(0,i.g)({...f,logger:r,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,n.u)(e)}):(0,i.y)(f),w=await(await I).result.json();if(h)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:e.sharepointIds?.listId??"",listItemId:e.sharepointIds?.listItemId??"",siteId:e.sharepointIds?.siteId??"",webId:e.sharepointIds?.webId??"",listItemUniqueId:e.sharepointIds?.listItemUniqueId??"",tenantId:c.DR,title:"",package:e.package,folder:e.folder,lastModifiedDateTime:e?.lastModifiedDateTime||void 0}}(w,m);if(!w.sharepointIds?.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(!w.parentReference?.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!w.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:r,listItemId:i,siteId:n,webId:o,siteUrl:s,listItemUniqueId:a,tenantId:d}=t;if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");if("string"!==typeof d)throw new Error("Unexpected response: missing sharepointIds.tenantId");return{driveId:e.parentReference.driveId,siteUrl:s,itemId:e.id,listId:r,listItemId:i,siteId:n,webId:o,listItemUniqueId:a,tenantId:d,fileName:e.name,title:e.title,package:e.package,folder:e.folder,lastModifiedDateTime:e?.lastModifiedDateTime||void 0}}(w)}}}]);
//# sourceMappingURL=MTSFoundInPlacesInfo.460fd6da.chunk.js.map