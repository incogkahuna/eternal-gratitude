"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[33884],{30946:(e,t,n)=>{function r(e){const t=btoa(e);return t.replace(/(\+|\/|\=)/g,e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError(`Unexpected match ${e} encountered in urlEncodeBase64String. Only +/= are to be replaced.`)})}n.d(t,{A7:()=>i,x7:()=>s});var o=n(60835);async function i(e,t,n){const{siteUrl:r,driveId:i,fileId:a}=t,c=await(0,o.sN)(e,r,i,a,n);if(!c)throw new Error("Failed to fetch file sharepoint ids");return s(c,a)}function s(e,t){const{siteId:n,webId:o,listId:i}=e;return`SPO_${r(`${n},${o},${i}`)}_${t}`}},52432:(e,t,n)=>{n.r(t),n.d(t,{SharepointNotificationService:()=>Do});var r=n(95996),o=n(33788),i=n(60835),s=n(48680);const a="writeToJsonObject",c="writeToFacetJsonObject",u="processJsonObject";function d(e){return null!==e&&"undefined"!==typeof e}function l(e,t){return(t|=0)<e.Min?e.Min:t>e.Max?e.Max:t}function p(e,t,n){return d(t)?Array.isArray(t)?B(t,n,(t,n)=>p(e,t,n)):l(e,t):null}p.bind(null,{Min:-128,Max:127}),p.bind(null,{Min:0,Max:255}),p.bind(null,{Min:-32768,Max:32767});const f={Min:0,Max:65535},h=(p.bind(null,f),p.bind(null,{Min:-2147483648,Max:2147483647})),m=p.bind(null,{Min:0,Max:4294967295}),I={Min:Number.MIN_SAFE_INTEGER,Max:Number.MAX_SAFE_INTEGER},v=(p.bind(null,I),{Min:0,Max:Number.MAX_SAFE_INTEGER});p.bind(null,v);const C=function(e,t){return d(e)?Array.isArray(e)?B(e,t,C):e:null},y=function(e,t){return d(e)?Array.isArray(e)?B(e,t,y):d(e)&&""!==e?e:null:null},g=function(e,t){return d(e)?Array.isArray(e)?B(e,t,g):y(e.toISOString(),t):null},S=new Date(0);class P{constructor(e){this.value=e}static createNew(){return new P("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}toString(){return this.value}valueOf(){return this.toString().toLowerCase()}}P.Empty=new P("00000000-0000-0000-0000-000000000000");const A=function(e,t){return d(e)?Array.isArray(e)?B(e,t,A):e!==P.Empty?y(e.toString(),t):null:null},w=P.Empty;function T(e){return function(e){return null!==e&&["number","string","boolean","object"].indexOf(typeof e)>=0}(e)&&!Array.isArray(e)}function x(e){return null!==e&&"object"===typeof e&&!Array.isArray(e)}function N(e){if(x(e)){const t={};for(const n in e)t[n]=N(e[n]);return t}if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;++n){let r=e[n];T(r)&&t.push(r)}return t}return e}const R=function(e,t){return d(e)?Array.isArray(e)?B(e,t,R):N(e):null};class b{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;this.Major=e,this.Minor=t,this.Build=n,this.Revision=r}toString(){let e=this.Major+"."+this.Minor;return(this.Build>0||this.Revision>0)&&(e+="."+this.Build,this.Revision>0&&(e+="."+this.Revision)),e}valueOf(){function e(e){return(e>>12&15).toString(16)+(e>>8&15).toString(16)+(e>>4&15).toString(16)+(15&e).toString(16)}return e(this.Major)+e(this.Minor)+e(this.Build)+e(this.Revision)}}const D=function(e,t){return d(e)?Array.isArray(e)?B(e,t,D):y(e.toString(),t):null};new b;function O(e){const t=[];for(let n=0;n<e;++n)t.push(n);return t}function E(e){const t=[];for(let n=0;n<e;++n)t.push(1<<n);return t}function k(e){return Object.keys(e).sort((t,n)=>e[t]-e[n])}function U(e){return Object.keys(e).filter(e=>"None"!==e).sort((t,n)=>e[t]-e[n])}function M(e,t,n,r){if(!d(e))return null;if(Array.isArray(e))return B(e,r,(e,r)=>M(e,t,n,r));if(8&r)return m(e,r);const o=Math.min(t.length,n.length);for(let i=0;i<o;++i)if(t[i]===e)return y(n[i],r);return y(e.toString(),r)}function L(e,t,n,r){if(!d(e))return null;if(Array.isArray(e))return B(e,r,(e,r)=>L(e,t,n,r));if(8&r)return m(e,r);const o=[],i=Math.min(t.length,n.length);for(let s=0;s<i;++s){const r=t[s];if(e&r&&(o.push(n[s]),(e&=~r)<1))break}return e>0&&o.push(e.toString()),o.length<1?y("None",r):y(o.join(","),r)}function F(e,t){return e&t}function B(e,t,n){if(!d(e)||e.length<1)return null;const r=[];for(const o of e){const e=n(o,t);d(e)&&!Array.isArray(e)&&r.push(e)}return r}const V=function(e){return 16777215&(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0)|(255&e)<<24|4},W=function(e){return(-16777216&e)>>24};function $(e,t){try{return t(e)}finally{e.exit()}}class j{constructor(){this.artifacts=new Map,this.parent=j.current,j.current=this}static getOrCreateArtifact(e,t){for(let r=j.current;r;r=r.parent){const e=r.artifacts.get(t);if(e)return e}const n=e();return d(j.current)&&j.current.artifacts.set(t,n),n}exit(){j.current=this.parent}}j.current=null;const J=Symbol();function _(){return{SettingProvider:{getSetting:(e,t)=>t}}}function G(){return j.getOrCreateArtifact(_,J)}const H=function(e,t){return d(e)?Array.isArray(e)?B(e,t,H):e.toJsonValue(t):null},K=function(e,t,n){return d(e)?Array.isArray(e)?B(e,t,(e,t)=>K(e,t,n)):(1&t||4&t||e.TypeName!=n||(t|=1),e.toJsonValue(t)):null};function q(e,t,n,r){if(d(n))for(const o of n){let t=e[o];x(t)||(e[o]=t={}),e=t}d(r)&&(e[t]=r)}class z{update(e){}toJsonValue(e){const t=function(e,t){return 1&t||4&t?{}:2&t?{__metadata:{type:e}}:{__type:e}}(this.TypeName,e);return this[u](t,e,this[a],this[c]),t}toFacetJsonValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.toJsonValue(V(e,t))}toJson(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return JSON.stringify(this.toJsonValue(e))}toFacetJson(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.toJson(V(e,t))}[a](e,t){}[c](e,t){}[u](e,t,n,r){$(new j,()=>{4&t?r.call(this,e,t):n.call(this,e,t)})}}class X extends z{constructor(){super(...arguments),this.TypeClassification=2}}class Q{static convertTo(e,t){return de(t)}}class Y{static getOrCreate(){return j.getOrCreateArtifact(Y.create,Y.artifactId)}static getPersonIndex(e){return d(e)?Y.findPerson(e):null}static addPerson(e){if(d(e)){let o=Y.findAndUpdatePerson(e);d(o)||(o=new dn,Y.updatePerson(o,e),Y.getOrCreate().push(o));for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const e of n)d(o.Roles)?o.Roles.indexOf(e)<0&&o.Roles.push(e):o.Roles=[e]}}static addPeople(e){if(d(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const t of e)Y.addPerson(t,...n)}}static create(){return[]}static findAndUpdatePerson(e){const t=Y.findPerson(e);if(t>=0){const n=Y.getOrCreate()[t];return Y.updatePerson(n,e),n}return null}static findPerson(e){const t=Y.getOrCreate();for(var n=0;n<t.length;++n){const r=t[n];if(d(r.Provider)&&""!==r.Provider){if(r.Provider===e.Provider&&r.Id===e.Id)return n;if(d(e.Provider)&&""!==e.Provider)continue}if(d(r.Email)&&""!==r.Email){if(r.Email===e.Email)return n;if(d(e.Email)&&""!==e.Email)continue}if(d(r.Name)&&""!==r.Name&&r.Name===e.Name)return n}return-1}static updatePerson(e,t){d(e.Provider)&&""!==e.Provider||(e.Provider=t.Provider,e.Id=t.Id),d(e.Email)&&""!==e.Email||(e.Email=t.Email),d(e.Name)&&""!==e.Name||(e.Name=t.Name)}}Y.artifactId=Symbol();class Z{static convertToArray(e,t){const n=Y.getOrCreate();return t instanceof Zn?(Y.addPerson(t.Creator,"Creator","InThread"),Y.addPeople(t.AnchorCreators,"AnchorCreator"),Y.addPerson(t.ParentAuthor,"RepliedTo","InThread"),Y.addPeople(t.Participants,"InThread"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.TaskAssignees,"ExistingAssignee"),Z.processCommentPreview(t.Preview),n):t instanceof Yn?(Y.addPerson(t.Creator,"Creator"),Y.addPeople(t.AnchorCreators,"AnchorCreator"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.TaskAssignees,"ExistingAssignee"),Z.processCommentPreview(t.Preview),n):t instanceof Qn?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.Mentionee,"Mentioned"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.TaskAssignees,"ExistingAssignee"),Z.processCommentPreview(t.CommentPreview),n):t instanceof Wn?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.Mentionee,"Mentioned"),n):t instanceof tr?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.CommentThreadCreator,"CommentThreadCreator"),Y.addPeople(t.Assignees,"NewAssignee"),Z.processCommentPreview(t.CommentPreview),n):t instanceof rr?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.Assignees,"ExistingAssignee"),Y.addPeople(t.NewAssignees,"NewAssignee"),Z.processCommentPreview(t.CommentPreview),n):t instanceof nr?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.Assignees,"ExistingAssignee"),Z.processCommentPreview(t.CommentPreview),n):t instanceof or?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.TaskCreator,"TaskCreator"),Y.addPeople(t.Assignees,"Assignee"),Y.addPeople(t.PreviousAssignees,"PreviousAssignee"),n):t instanceof ir?(Y.addPerson(t.Creator,"Creator"),n):t instanceof ar?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.CommentCreator,"CommentCreator"),Y.addPerson(t.LatestReactor,"LatestReactor"),n):t instanceof ur?(Y.addPerson(t.Creator,"Creator"),Y.addPeople(t.Mentionees,"Mentioned"),Y.addPeople(t.PreviousMentionees,"PreviousMentionee"),n):t instanceof cr?(Y.addPerson(t.Creator,"Creator"),Y.addPerson(t.LatestReactor,"LatestReactor"),Y.addPeople(t.TargetActors,"TargetActor"),n):t instanceof dr?(Y.addPerson(t.Creator,"Creator"),Y.addPeople(t.Actors,"Actor"),n):t instanceof lr?(Y.addPerson(t.Creator,"Creator"),n):t instanceof pr?(Y.addPerson(t.Creator,"Creator"),Y.addPeople(t.Recipients,"Recipient"),Z.processPersonStateInfo(t.ContentStateInfo),n):n}static processCommentPreview(e){if(d(e))if(Z.processPreviewFragment(e.Anchor,"AnchorCreator"),e instanceof Xn){if(Z.processPreviewFragment(e.Comment,"CommentCreator","InThread"),Z.processPreviewFragment(e.RootComment,"RepliedTo","InThread"),d(e.RecentComments))for(const t of e.RecentComments)Z.processPreviewFragment(t,"InThread")}else Z.processPreviewFragment(e.Comment,"CommentCreator")}static processPreviewFragment(e){if(d(e)){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Y.addPerson(e.Creator,...n)}}static processPersonStateInfo(e){e instanceof Cr&&d(e)&&Y.addPeople(e.Person,"RuleTrigger")}}class ee{static convertToOptional(e,t){return!!ce(t)||t.NotifiedInBand}}class te{static convertTo(e,t){if(t instanceof jn&&d(t.Data)){const e="Office"+de(t.Data);return t.Data instanceof Vn?e+xn(t.Data.Action,0):e}return de(t)}}class ne{static convertTo(e,t){return t instanceof jn&&d(t.Data)&&d(t.Data.SourceAppId)?t.Data.SourceAppId.toString():d(t.SourceAppId)?t.SourceAppId.toString():"3d9f2b8c-fab8-4011-a098-2652bdd0b55d"}}class re{static convertTo(e,t){switch(t.SourcePlatform){case An.Win32:case An.WinRT:case An.Windows:return mn.Windows;case An.Android:return mn.Android;case An.Mac:return mn.MacOS;case An.iOS:return mn.iOS;case An.Linux:return mn.Linux;case An.tvOS:return mn.tvOS;default:return mn.Unknown}}}class oe{static convertTo(e,t){var n;if(!d(t)||!d(t.Creator)||!d(t.Creator.RawId)&&t.Creator.RawIdKind!=bn.Self)return null;const r=new vn,o=t.Creator.RawProvider==Nn.LiveId,i=null!==(n=t.Creator.RawId)&&void 0!==n?n:"";return r.IdKind=o?ln.MSA:ln.AAD,r.TenantId=t.Creator.TenantId,d(t.Creator.RawIdKind)?t.Creator.RawIdKind==bn.OID?r.Id=o?"OID:"+i:i:t.Creator.RawIdKind==bn.PUID?r.Id=o?i:"PUID:"+i:t.Creator.RawIdKind==bn.CID?r.Id="CID:"+i:r.Id="Self":r.Id=o?"CID:"+i:i,r}}class ie{static convertTo(e,t){return t.TypeClassification}}class se{static convertToOptional(e,t){if(!ue(t))return t.NotifiedInBand}}class ae{static convertToOptional(e,t){if(ue(t))return!0}}function ce(e){return e instanceof Ln&&(!!function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(const o of n)if(0===F(e,o))return!1;return!0}(function(e){return F(G().SettingProvider.getSetting("Pipelines."+e.TypeName,e.DefaultPipelines),e.AllowedPipelines)}(e),kn.Substrate)&&(!d(e.NotifiedInBand)||!e.NotifiedInBand))}function ue(e){return e instanceof jn&&(!!d(e.Data)&&ce(e.Data))}function de(e){let t=e.TypeName,n="";const r=t.lastIndexOf(".");return r>=0&&(n=t.substring(0,r),t=t.substring(r+1)),"Common"===n?t:n+t}const le="Name",pe="Email",fe="Provider",he="PictureUrl",me="Roles",Ie="User",ve="Unknown",Ce="File",ye="Windows",ge="Android",Se="Linux",Pe="tvOS",Ae="IdKind",we="TenantId",Te="DriveId",xe="DriveItemId",Ne="SiteUrl",Re="SiteId",be="WebId",De="ListId",Oe="ItemId",Ee="CreatorEmail",ke="Unspecified",Ue="Count",Me="CustomerContent",Le="EUII",Fe="Completed",Be="InProgress",Ve="None",We="RawProvider",$e="RawId",je="RawIdKind",Je="Created",_e="Observed",Ge="SourceApp",He="SourcePlatform",Ke="SourceSessionId",qe="Timestamp",ze="ActivitySource",Xe="PreprocessorOptions",Qe="Creator",Ye="CustomProperties",Ze="Application",et="AppName",tt="SourceAppVersion",nt="Device",rt="SourceAppContext",ot="NotifiedInBand",it="SuppressSendToSubstrate",st="SensitivityLabelId",at="ContentId",ct="Data",ut="NavigationId",dt="Action",lt="StartTime",pt="EndTime",ft="Status",ht="Locale",mt="Item",It="SendToActivityService",vt="NotStarted",Ct="Title",yt="DueDate",gt="Priority",St="Content",Pt="Common.PreviewOptions",At="Anchor",wt="Comment",Tt="ThreadId",xt="CommentThreadId",Nt="Options",Rt="Common.CommentPreview",bt="ThreadLength",Dt="RootComment",Ot="RecentComments",Et="CommentThreadIsTask",kt="CommentPreview",Ut="Preview",Mt="CommentPreviewAbsenceReason",Lt="PreviewAbsenceReason",Ft="TaskCreatedDate",Bt="Updates",Vt="LatestEmoji",Wt="EmojiCounts",$t="LatestReaction",jt="ReactionCounts",Jt="TargetId",_t="TargetPreview",Gt="TotalReactorCount",Ht="State",Kt="StatusLabel",qt="PreviousState",zt="MessagePreview",Xt="Source",Qt="ComponentEdit",Yt="CorrelationId",Zt="ContainerKind",en="ContentChangeRuleTriggered",tn="ContentSourceName",nn="ContentStateInfo",rn="ActivityCompliance",on="Purple",sn="Green",an="Pink",cn="Orange",un=Object.assign;class dn extends z{constructor(){super(),this.TypeName="Unified.Person"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,"Id",null,y(this.Id,t)),q(e,le,null,y(this[le],t)),q(e,pe,null,y(this[pe],t)),q(e,fe,null,y(this[fe],t)),q(e,he,null,y(this[he],t)),q(e,me,null,y(this[me],t)))}}!function(e){const t=O(2),n=k(e)}({[Ie]:0,System:1});const ln={AAD:0,MSA:1},pn=function(e){const t=O(2),n=k(e);return(e,r)=>M(e,t,n,r)}(ln),fn={[ve]:0,EXO:1,SPO:2,OXO:3,MileIQ:4,AFS:5,Teams:6,Stream:7,ODB:8,MicrosoftPowerBI:9,Yammer:10},hn=function(e){const t=O(11),n=k(e);return(e,r)=>M(e,t,n,r)}(fn),mn=(function(e){const t=O(4),n=k(e)}({[ve]:0,Message:1,[Ce]:2,Calendar:3}),{[ve]:0,[ye]:1,[ge]:2,iOS:3,MacOS:4,[Se]:5,[Pe]:6}),In=function(e){const t=O(7),n=k(e);return(e,r)=>M(e,t,n,r)}(mn);class vn extends z{constructor(){super(),this.TypeName="SIGS.Actor",this[Ae]=0}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,"ActorIdType",null,pn(this[Ae],t)),q(e,"ActorId",null,y(this.Id,t)),q(e,"AadTenantId",null,y(this[we],t)),q(e,"ActorType",null,y(Ie,t)))}}class Cn extends z{[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||q(e,"Url",null,y(this.Url,t))}}class yn extends Cn{constructor(){super(),this.TypeName="SIGS.GraphDocumentInfo"}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,Te,null,y(this[Te],t)),q(e,xe,null,y(this[xe],t)))}}class gn extends yn{constructor(){super(),this.TypeName="SIGS.SharePointDocumentInfo"}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,Ne,null,y(this[Ne],t)),q(e,we,null,A(this[we],t)),q(e,Re,null,A(this[Re],t)),q(e,be,null,A(this[be],t)),q(e,De,null,A(this[De],t)),q(e,Oe,null,A(this[Oe],t)),q(e,Ee,null,y(this[Ee],t)))}}const Sn={[ve]:0,Word:1,Excel:2,PowerPoint:3,Outlook:4,OneNote:5,FluidApp:6,Visio:7,Planner:8,Whiteboard:9,TeamsApp:10,Designer:11,BizChat:12,AIHub:13},Pn=function(e){const t=O(14),n=k(e);return(e,r)=>M(e,t,n,r)}(Sn),An={[ve]:0,Win32:1,WinRT:2,[ge]:3,Mac:4,iOS:5,Web:6,Server:7,[ye]:8,[Se]:9,[Pe]:10},wn=function(e){const t=O(11),n=k(e);return(e,r)=>M(e,t,n,r)}(An),Tn=(function(e){const t=O(3),n=k(e)}({[ke]:0,EditSession:1,PreExisting:2}),{Create:0,Update:1,Delete:2}),xn=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}(Tn),Nn={[ve]:0,LiveId:1,OrgId:2,ActiveDirectory:3,ADAL:4,SSPI:5,OAuth2:6,Badger:7,[Ue]:8},Rn=function(e){const t=O(9),n=k(e);return(e,r)=>M(e,t,n,r)}(Nn),bn={OID:0,PUID:1,CID:2,Self:3},Dn=function(e){const t=O(4),n=k(e);return(e,r)=>M(e,t,n,r)}(bn),On=function(e){const t=O(12),n=k(e),r=[[n[0],"AccessControl",n[2],n[3],n[4],n[5],n[6],n[7],n[8],"SystemMetaData",n[10],n[11]]],o=new Map([[2,r[0]],[3,r[0]]]),i=e=>4&e?(e=>{var t;return null!==(t=o.get(e))&&void 0!==t?t:n})(W(e)):n;return(e,n)=>M(e,t,i(n),n)}({[ke]:0,AccessControlData:1,[Me]:2,[Le]:3,SupportData:4,AccountData:5,PublicPersonalData:6,EUPI:7,OII:8,SystemMetadata:9,PublicNonPersonalData:10,[Ue]:11}),En=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}({[Fe]:0,[Be]:1,CompletedMissingStart:2}),kn={[Ve]:0,Host:1,Substrate:2};!function(e){const t=E(2),n=U(e)}(kn);class Un extends z{constructor(){super(),this.TypeName="Base.UserInfo"}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,"Id",null,y(this.Id,t)),q(e,le,null,y(this[le],t)),q(e,pe,null,y(this[pe],t)),q(e,fe,null,y(this[fe],t)),q(e,we,null,y(this[we],t)),q(e,We,null,Rn(this[We],t)),q(e,$e,null,y(this[$e],t)),q(e,je,null,Dn(this[je],t)))}}class Mn extends X{constructor(){super(),un(this,{Id:w,[Je]:S,Finalized:S,[_e]:S,[Ge]:0,[He]:0,[Ke]:w})}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,"Id",null,A(this.Id,t)),q(e,qe,null,g(this[Je],t)),q(e,"AppSessionId",[ze],A(this[Ke],t))),3===n&&(q(e,"SignalInstanceId",[Xe],A(this.Id,t)),q(e,"SendToONotify",[Xe],C(ae.convertToOptional({},this),t))),2!==n&&3!==n||(q(e,"ActorDetails",[Ye],H(this[Qe],1|t)),q(e,et,[Ze],Pn(this[Ge],t)),q(e,"AppVer",[Ze],D(this[tt],t)),q(e,"Platform",[Ye,"DeviceDetails"],wn(this[He],t)),q(e,"OsVer",[nt],D(this.SourcePlatformVersion,t)),q(e,"DeviceId",[nt],y(this.SourceDeviceId,t)),q(e,"UserAgent",[nt],y(this.SourceUserAgent,t)),q(e,"ClientIp",[nt],y(this.SourceIpAddress,t)),q(e,"Context",[Ye,"ApplicationDetails"],R(this[rt],t)),q(e,ot,[Ye],C(se.convertToOptional({},this),t))),0===n&&(q(e,"HostTimestamp",null,g(this[_e],t)),q(e,et,[ze],Pn(this[Ge],t)),q(e,"AppVersion",[ze],D(this[tt],t)),q(e,"AppPlatform",[ze],wn(this[He],t)),q(e,"AppContext",[ze],R(this[rt],t)),q(e,ot,null,C(ee.convertToOptional({},this),t)))}}class Ln extends Mn{get DefaultPipelines(){return kn.Substrate}get AllowedPipelines(){return kn.Substrate}[c](e,t){super[c](e,t);var n=W(t);0===n&&q(e,it,null,C(this[it],t)),0!==n&&1!==n||(q(e,st,null,y(this[st],t)),q(e,"Type",null,y(Q.convertTo({},this),t)),q(e,"People",null,H(Z.convertToArray({},this),1|t)))}}class Fn extends Ln{}class Bn extends Fn{constructor(){super(),this.ContentOrigin=0}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,at,[ct],y(this[at],t)),q(e,ut,[ct],y(this[ut],t)))}}class Vn extends Bn{constructor(){super(),this[dt]=0}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||q(e,"ContentAction",[ct],xn(this[dt],t))}}class Wn extends Vn{get AllowedPipelines(){return this.Action===Tn.Update?kn.None:super.AllowedPipelines}}class $n extends Mn{constructor(){super(),this[lt]=S,this[pt]=S}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,lt,null,g(this[lt],t)),q(e,pt,null,g(this[pt],t)),q(e,ft,null,En(this[ft],t)),q(e,"CV",null,y(this.CorrelationVector,t)),q(e,ht,null,y(this[ht],t)),q(e,"Workload",[Ze],hn(this.AppWorkload,t)),q(e,Oe,[mt],y(this[Oe],t)),q(e,"ContainerType",[mt],y(this.ItemContainerKind,t)),q(e,"ContainerId",[mt],y(this.ItemContainerId,t)),q(e,"ContainerTypeId",[Ye],y(this.CustomContainerTypeId,t)),q(e,"SignalType",null,y(te.convertTo({},this),t)),q(e,"Actor",null,H(oe.convertTo({},this),1|t)),q(e,"Os",[nt],In(re.convertTo({DefaultValue:0},this),t)),q(e,"Compliance",null,On(ie.convertTo({DefaultValue:0},this),t)),q(e,"AadAppId",[Ze],y(ne.convertTo({},this),t)),q(e,"ItemType",[mt],y(Ce,t)))}}class jn extends $n{[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||(q(e,"FileDetails",[Ye],K(this.DocumentInfo,-2&t,"SIGS.DocumentInfo")),q(e,"ActivityDetails",[Ye],K(this[ct],-2&V(1,t),"Base.NormalActivity"))),3===n&&q(e,It,[Xe],C(this[It],t))}}const Jn={UnsupportedClient:0,ProtectedDocument:1,Unnecessary:2},_n=function(e){const t=O(3),n=k(e),r=[["Unsupported_Client","Encrypted","NotNeeded"]],o=new Map([[0,r[0]],[1,r[0]]]),i=e=>4&e?(e=>{var t;return null!==(t=o.get(e))&&void 0!==t?t:n})(W(e)):n;return(e,n)=>M(e,t,i(n),n)}(Jn),Gn=function(e){const t=O(3),n=k(e);return(e,r)=>M(e,t,n,r)}({[vt]:0,[Be]:1,[Fe]:2}),Hn=function(e){const t=O(4),n=k(e);return(e,r)=>M(e,t,n,r)}({Urgent:0,Important:1,Medium:2,Low:3}),Kn=function(e){const t=E(5),n=U(e);return(e,r)=>L(e,t,n,r)}({[Ve]:0,Assignees:1,[Ct]:2,[yt]:4,[ft]:8,[gt]:16}),qn=function(e){const t=O(1),n=k(e);return(e,r)=>M(e,t,n,r)}({Like:0});(function(e){const t=O(3),n=k(e)})({[ve]:0,Local:1,Sharepoint:2}),function(e){const t=O(6),n=k(e)}({[vt]:0,[Be]:1,ReadyForReview:2,[Fe]:3,Blocked:4,Custom:5});class zn extends z{constructor(){super(),this.TypeName=Rt}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,"LocationText",null,y(this.Location,t)),q(e,At,null,H(this[At],1|t)),q(e,wt,null,H(this[wt],1|t)),q(e,xt,null,y(this[Tt],t)),q(e,Nt,null,K(this[Nt],-2&t,Pt)))}}class Xn extends zn{constructor(){super(),this.TypeName="Common.CommentReplyPreview",this[bt]=0}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Dt,null,H(this[Dt],1|t)),q(e,Ot,null,H(this[Ot],1|t)),q(e,"ThreadCommentCount",null,h(this[bt],t)))}}class Qn extends Wn{constructor(){super(),this.TypeName="Common.Mention"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,"ParentContentId",[ct],y(this.CommentContentId,t)),q(e,xt,[ct],y(this[xt],t)),q(e,Et,[ct],C(this[Et],t)),q(e,Ut,null,K(this[kt],-2&t,Rt)),q(e,Lt,[ct],_n(this[Mt],t)))}}class Yn extends Vn{constructor(){super(),this.TypeName="Common.Comment"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,xt,[ct],y(this[Tt],t)),q(e,Et,[ct],C(this.ThreadIsTask,t)),q(e,Ut,null,K(this[Ut],-2&t,Rt)),q(e,Lt,[ct],_n(this[Lt],t)))}}class Zn extends Yn{constructor(){super(),this.TypeName="Common.CommentReply"}}class er extends Fn{[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,xt,[ct],y(this[xt],t)),q(e,ut,[ct],y(this[ut],t)),q(e,Ut,null,K(this[kt],-2&t,Rt)),q(e,Lt,[ct],_n(this[Mt],t)))}}class tr extends er{constructor(){super(),this.TypeName="Common.TaskCreation"}}class nr extends er{}class rr extends nr{constructor(){super(),this.TypeName="Common.TaskReassignment"}}class or extends Vn{constructor(){super(),this.TypeName="Common.CanvasTask"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Ct,[ct],y(this[Ct],t)),q(e,Ft,[ct],g(this[Ft],t)),q(e,yt,[ct],g(this[yt],t)),q(e,ft,[ct],Gn(this[ft],t)),q(e,gt,[ct],Hn(this[gt],t)),q(e,Bt,[ct],Kn(this[Bt],t)))}}class ir extends Fn{}class sr extends Bn{[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Vt,[ct],y(this[Vt],t)),q(e,Wt,[ct],H(this[Wt],1|t)))}}class ar extends sr{constructor(){super(),this.TypeName="Common.CommentReactionUpdate"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,$t,[ct],qn(this[$t],t)),q(e,jt,[ct],H(this[jt],1|t)))}}class cr extends sr{constructor(){super(),this.TypeName="Common.TargetedReactionUpdate"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Jt,[ct],y(this[Jt],t)),q(e,_t,[ct],R(this[_t],t)),q(e,Gt,[ct],m(this[Gt],t)))}}class ur extends Vn{constructor(){super(),this.TypeName="Common.Recap"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||q(e,St,["Recap"],R(this[St],t))}}class dr extends Vn{constructor(){super(),this.TypeName="Common.StatusLabel"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Ht,[Kt],H(this[Ht],1|t)),q(e,qt,[Kt],H(this[qt],1|t)),q(e,zt,[Kt],R(this[zt],t)))}}class lr extends Bn{constructor(){super(),this.TypeName="Common.ComponentEdit"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Xt,[Qt],y(this[Xt],t)),q(e,dt,[Qt],y(this[dt],t)),q(e,Yt,[Qt],y(this[Yt],t)))}}class pr extends Bn{constructor(){super(),this.TypeName="Common.ContentChangeRuleTriggered",this[Zt]=Ir}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,Zt,[en],mr(this[Zt],t)),q(e,tn,[en],y(this[tn],t)),q(e,nn,[en],K(this[nn],-2&t,"ContentChangeRuleTriggered.ContentStateInfo")))}}class fr extends jn{constructor(){super(),this.TypeName="Common.ActivitySignalWithoutContent",this.TypeClassification=3}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||q(e,rn,[Ye],y(Le,t))}}class hr extends jn{constructor(){super(),this.TypeName="Common.ActivitySignalWithContent"}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||q(e,rn,[Ye],y(Me,t))}}(function(e){const t=O(10),n=k(e)})({Circle:0,CircleHalfFilled:1,RightArrowCircle:2,CheckmarkCircle:3,CircleLineFilled:4,[on]:5,[sn]:6,Grey:7,[an]:8,[cn]:9}),function(e){const t=O(12),n=k(e)}({Red:0,[cn]:1,Yellow:2,DarkBrown:3,LightGreen:4,[sn]:5,DarkTeal:6,Blue:7,[on]:8,[an]:9,Silver:10,Gray:11});const mr=function(e){const t=O(2),n=k(e);return(e,r)=>M(e,t,n,r)}({Paragraph:0,Table:1}),Ir=0;class vr extends z{}class Cr extends vr{constructor(){super(),this.TypeName="ContentChangeRuleTriggered.PersonStateInfo"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||q(e,"Dummy",["Person"],y("",t))}}class yr extends z{constructor(){super(),this.TypeName="Vroom.WrappedActivity",this.Id=w}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||(q(e,"Id",null,A(this.Id,t)),q(e,"activity",null,K(this.Activity,-2&t,"Base.Activity")))}}class gr extends z{constructor(){super(),this.TypeName="Vroom.PatchStreamPayload"}[c](e,t){super[c](e,t);var n=W(t);0!==n&&1!==n||q(e,"value",null,H(this.Activities,1|t))}}class Sr extends z{constructor(){super(),this.TypeName="Transport.PreprocessorPayload"}[c](e,t){super[c](e,t);var n=W(t);2!==n&&3!==n||q(e,"activities",null,K(this.Signals,-2&t,"Base.ActivitySignal"))}}!function(e){const t=O(16),n=k(e)}({Success:0,UnknownError:1,BadRequest:2,AccessDenied:3,SignalTypeNotFound:4,SignalAlreadyExists:5,Disabled:6,InternalError:7,Throttled:8,ServiceUnavailable:9,QuotaExceeded:10,SignalTooLarge:11,SigsBadRequest:12,ExpiredRpsProxyTicket:13,UserNotFound:14,InvalidToken:15});var Pr=n(83125),Ar=n(30946),wr=n(29018),Tr=n(72376),xr=n(40635),Nr=n(37805),Rr=n(93537);function br(e){return F(e.DefaultPipelines,e.AllowedPipelines)}function Dr(e,t,n){return Wr(e,t,n)}function Or(e){return $r(e)&&"string"===typeof e.code&&jr(e.message)&&Jr(e["@onedrive.errorReasonForTelemetry"])}function Er(e){return $r(e)&&Or(e.error)}function kr(e){return $r(e)&&"string"===typeof e.Id&&jr(e.ServerId)&&jr(e.Message)&&Jr(e.Status)&&("undefined"===typeof e.Error||Or(e.Error))}function Ur(e){return $r(e)&&_r(e.Status,0,"Success")&&"undefined"===typeof e.Error}function Mr(e){return $r(e)&&"string"===typeof e.Id&&Jr(e.Status)&&jr(e.Message)}function Lr(e){return $r(e)&&_r(e.Status,0,"Success")}function Fr(e,t,n,r){const{siteUrl:o,siteId:i,webId:s,listId:a,listItemUniqueId:c}=n,u=function(e,t){if(e){if("Enterprise"===e.tokenProvider.identityType&&e.tenantId)return`SPO:SPO_${t.siteId}@SPO_${e.tenantId}`;if("Consumer"===e.tokenProvider.identityType)return e.rosterId}return}(e,n),d=new gn;d.SiteUrl=o,d.TenantId=e?.tenantId?new P(e.tenantId):void 0,d.SiteId=new P(i),d.WebId=new P(s),d.ListId=new P(a),d.ItemId=new P(c);const l=function(e){if(e.TypeClassification===Vr)return new hr;return new fr}(r);return r.SignalId||(r.SignalId=new P(crypto.randomUUID())),l.Id=r.SignalId,l.Creator=r.Creator,l.Created=r.Created,l.Finalized=r.Finalized,l.Observed=r.Observed,l.SourceApp=r.SourceApp,l.SourceAppVersion=r.SourceAppVersion,l.SourcePlatform=r.SourcePlatform,l.SourcePlatformVersion=r.SourcePlatformVersion,l.SourceDeviceId=r.SourceDeviceId,l.SourceUserAgent=r.SourceUserAgent,l.SourceIpAddress=r.SourceIpAddress,l.SourceAppContext=r.SourceAppContext,l.NotifiedInBand=r.NotifiedInBand,l.StartTime=r.Created,l.EndTime=r.Created,l.ItemId=t,l.Data=r,l.DocumentInfo=d,l.AppWorkload=fn.SPO,l.ItemContainerId=u,l.CustomContainerTypeId=e?.containerTypeId,l}function Br(e,t,n){return $(new j,()=>(G().SettingProvider={getSetting:(t,n)=>Wr(e,t,n)},t.toFacetJson(n)))}const Vr=2;function Wr(e,t,n){return(0,s.AU)("ActivityTransport."+t,n,e?.settingsProvider)}function $r(e){return"object"===typeof e&&null!==e}function jr(e){return"undefined"===typeof e||"string"===typeof e}function Jr(e){return"undefined"===typeof e||"number"===typeof e||"string"===typeof e}function _r(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return"undefined"===typeof e||n.includes(e)}const Gr=Symbol(),Hr="OutgoingActivity",Kr="ActivityResult";function qr(e,t,n,r){const o=e[Gr]??kn.None,i=Yr(Kr,e,o);i.TryCount=t.tries.length;const s=t.result.headers.get("SPRequestGuid");if(s&&(i.RequestId=s),i.Status=t.result.status,i.Success=!1,n){const t=function(e,t){const n=t.toLowerCase();return e.value.find(e=>e.Id.toLowerCase()===n)}(n,e.Id.toString());t&&(i.Success=!t.Error&&(!t.Status||"Success"===t.Status),t.Error?i.Error=t.Error.code:i.Success||(i.Error=t.Status),t.ServerId&&(i.ServerId=t.ServerId))}else r&&(i.Error=r.error.code);return i}function zr(e,t,n,r){let o,i;if(e instanceof jn&&d(e.Data)){const t=e[Gr]??kn.None;o=Zr(Kr,e,t),i=e.Data.Id}else o=Qr(Kr,e),i=e.Id;o.TryCount=t.tries.length;const s=t.result.headers.get("Request-Id");if(s&&(o.RequestId=s),o.Status=t.result.status,o.Success=!1,n){const e=function(e,t){const n=t.toLowerCase();return e.find(e=>e.Id.toLowerCase()===n)}(n,i.toString());e&&(o.Success=!e.Status||"Success"===e.Status,o.Success||(o.Error=e.Status,e.Message&&(o.Message=e.Message)))}else r&&(o.Error=r.error.code);return o}function Xr(e,t,n){const r=Qr(Kr,e);r.TryCount=t.tries.length;const o=t.result.headers.get("Request-Id");return o&&(r.RequestId=o),r.Status=t.result.status,r.Success=t.result.ok,n&&(r.Error=n.error.code),r}function Qr(e,t){return eo(e,t)}function Yr(e,t,n){const r=eo(e,t);return r.Pipelines=n,r}function Zr(e,t,n){let r;return d(t.Data)?(r=Yr(e,t.Data,n),r.ActivitySignalId=t.Id.toString()):r=Qr(e,t),r}function eo(e,t){const n={eventName:e,category:"Generic",TypeName:t.TypeName,ActivityId:t.Id.toString(),Age:new Date(Date.now()).valueOf()-t.Created.valueOf()};return t instanceof Vn&&(n.Action=t.Action),t instanceof Yn&&(n.HasParent=t instanceof Zn&&d(t.ParentAuthor),n.HasPreview=d(t.Preview),d(t.PreviewAbsenceReason)&&(n.PreviewAbsenceReason=t.PreviewAbsenceReason)),(t instanceof Qn||t instanceof er)&&(n.HasPreview=d(t.CommentPreview),d(t.CommentPreviewAbsenceReason)&&(n.PreviewAbsenceReason=t.CommentPreviewAbsenceReason)),n}var to=n(46507);const no="unknown";async function ro(e,t){const n=e.logger?{...e,logger:new Pr.p("ActivityTransport",e.logger)}:e;t.forEach(fo.bind(null,n));const r=await async function(e,t){const n=[];for await(const r of async function*(e,t){const n=await async function(e){if(!io(e))return;try{return await(0,Ar.A7)(e.tokenProvider,e)}catch{return}}(e),r=await async function(e){if(!io(e))return;const{siteUrl:t,driveId:n,fileId:r}=e;try{return await(0,i.sN)(e.tokenProvider,t,n,r)}catch{return}}(e);for(const o of t)if(n&&Io(o)){const t=Qr(Hr,o);e.logger?.send(t),yield o}else if(mo(o)){const t=br(o);if(t&kn.Host){const n=Yr(Hr,o,t);e.logger?.send(n),o[Gr]=t,yield o}if(n&&r&&t&kn.Substrate){const i=Fr(e,n,r,o),s=Zr(Hr,i,t);e.logger?.send(s),i[Gr]=t,yield i,o.SuppressSendToSubstrate=!0}}}(e,t))n.push(r);return n}(n,t);return(await Promise.all([uo(n,r.filter(mo)),lo(n,r.filter(Io))])).every(e=>e)}class oo{constructor(e,t,n){this.provider=e,this.kind=t,this.id=n}}function io(e){return!!(vo(e)||e.senderIdentity?.puid||so(e)&&e.senderIdentity?.cid)}function so(e){return Dr(e,"EnableCidSupport",!0)}function ao(e){return Dr(e,"UseInstrumentedAuthorizedFetchWithRetry",!0)}function co(e){return Dr(e,"UseSerializeToJson",!0)}async function uo(e,t){if(t.length<1)return!0;const n=new gr;n.Activities=t.map(ho);const r=(0,wr.$)(e.siteUrl),o={getToken:t=>{if(!t)throw Error("Options must be specified");const n={...t,siteUrl:e.siteUrl,driveId:e.driveId,itemId:e.fileId};return e.tokenProvider.getToken([`${r}/files.readwrite.all`],n)},url:`${r}/_api/v2.1/drives/${e.driveId}/items/${e.fileId}/office_activityStream`,tenantId:e.senderIdentity?.tenantId,requestInit:{method:"PATCH",headers:{"Content-Type":"application/json"},body:co(e)?Br(e,n,0):n.toFacetJson(0)},retryPolicy:Tr._9,tokenPolicy:(0,Tr.N$)(e.tokenProvider)},i=ao(e)&&e.logger?await(0,xr.g)({...o,logger:e.logger,nameForLogging:"SendActivitiesToHost"}):await(0,xr.y)(o),s=await i.result.json();return function(e,t,n,r){const o=n.result.ok&&(s=r,$r(s)&&Array.isArray(s.value)&&s.value.every(kr))?r:void 0,i=!n.result.ok&&Er(r)?r:void 0;var s;for(const a of t){const t=qr(a,n,o,i);e.logger?.send(t)}}(e,t,i,s),i.result.ok&&($r(a=s)&&Array.isArray(a.value)&&a.value.every(Ur));var a}async function lo(e,t){if(t.length<1)return!0;try{return(await Promise.all(t.map(po.bind(null,e)))).every(e=>e)}catch{return!1}}async function po(e,t){if(!function(e){return d(e.Creator)&&d(e.Creator.RawIdKind)}(t))return!1;let n,r,o;const i=function(e){const t=/https:\/\/[a-zA-Z0-9-]+\.(sharepoint-mil\.us|dps\.mil)/;return(0,to.l)(e.environment?.audience??(t.test((0,wr.$)(e.siteUrl))?"DoD":"Production"))}(e),s=t instanceof jn;if(s){n=`${i}/signalpreprocessor/v1/office`;const e=new Sr;e.Signals=[t],r=e,o=3}else n=`${i}/api/v2.0/me/signals`,r=t,o=2;const a=[429,500];(function(e){return Dr(e,"AddResponsesToRetryWhitelist",!0)})(e)&&a.push(709,710);const c={getToken:t=>{if(t)return e.tokenProvider.getToken([`${i}/Signals-Internal.ReadWrite`],t);throw Error("Options must be specified")},url:n,tenantId:e.senderIdentity?.tenantId,requestInit:{method:"POST",headers:{"Content-Type":"application/json",Prefer:'exchange.behavior="SignalAccessV2,OpenComplexTypeExtensions"',"X-SignalInstanceId":t.Id.toString(),"X-AnchorMailbox":e.senderIdentity.upn},body:co(e)?Br(e,r,o):r.toFacetJson(o)},retryPolicy:{maxRetries:2,backoffFn:(0,Nr.FT)(500),filter:(0,Rr.sC)(a)}},u=ao(e)&&e.logger?await(0,xr.g)({...c,logger:e.logger,nameForLogging:"SendSignalToSubstrate"}):await(0,xr.y)(c),l=await u.result.json();return function(e,t,n,r,o){const i=!n.result.ok&&Er(r)?r:void 0;if(o){const o=n.result.ok&&(s=r,Array.isArray(s)&&s.every(Mr))?r:void 0;for(const r of t){const t=zr(r,n,o,i);e.logger?.send(t)}}else for(const a of t){const t=Xr(a,n,i);e.logger?.send(t);break}var s}(e,[t],u,l,s),s?u.result.ok&&(p=l,Array.isArray(p)&&p.every(Lr)):u.result.ok;var p}function fo(e,t){if(e.senderIdentity&&!t.Creator)if(so(e)){const{provider:n,kind:r,id:o}=function(e,t){const{LiveId:n,ADAL:r}=Nn,{OID:o,PUID:i,CID:s}=bn,{oid:a,puid:c,cid:u}=t;if("Consumer"===e.identityType)return c?new oo(n,i,c):u?new oo(n,s,u):a&&a!==no?new oo(n,o,a):new oo(n);const d="Enterprise"===e.identityType?r:void 0;return a&&a!==no?new oo(d,o,a):c?new oo(d,i,c):u?new oo(d,s,u):new oo(d)}(e.tokenProvider,e.senderIdentity);t.Creator=new Un,t.Creator.Id=o,t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=n,t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=r}else t.Creator=new Un,t.Creator.Id=function(e){if("Consumer"===e.tokenProvider.identityType&&e.senderIdentity?.puid)return e.senderIdentity.puid;const t=vo(e);if(t)return t;if(e.senderIdentity?.puid)return e.senderIdentity.puid;return}(e),t.Creator.Name=e.senderIdentity.name,t.Creator.Email=e.senderIdentity.upn,t.Creator.TenantId=e.senderIdentity.tenantId,t.Creator.RawProvider=function(e){if("Consumer"===e.tokenProvider.identityType)return Nn.LiveId;if("Enterprise"===e.tokenProvider.identityType)return Nn.ADAL;return}(e),t.Creator.RawId=t.Creator.Id,t.Creator.RawIdKind=function(e){if("Consumer"===e.tokenProvider.identityType&&e.senderIdentity?.puid)return bn.PUID;if(vo(e))return bn.OID;if(e.senderIdentity?.puid)return bn.PUID;return}(e)}function ho(e){const t=new yr;return t.Activity=e,t.Id=e.Id,t}function mo(e){return e instanceof Ln}function Io(e){return e instanceof $n}function vo(e){const t=e.senderIdentity?.oid;return t===no?void 0:t}var Co=n(99671);const yo="GetDocumentInfoError";var go=n(77432);async function So(e,t){const n=function(e,t){if(e.dataStorePath=t||"/",!e.siteUrl||!e.driveId||!e.itemId)return;const n=new URL(e.siteUrl);return(0,Co.Cu)(n,e),n.toString()}(e,t);if(n){return encodeURIComponent(JSON.stringify({subEntityId:n}))}}async function Po(e,t,n){const{url:r,appId:o,entityId:i,subEntityId:s}=await async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Production",n=arguments.length>2?arguments[2]:void 0;return{url:(0,go.F)("teams",t),appId:"4a6520d6-94a8-4730-9184-24997b9b3401",entityId:"auth",subEntityId:await So(e,n)}}(t,e.environment?.audience,n);let a=`${r}/l/entity/${o}/${i}/`;return s&&(a+=`?context=${s}`),a}async function Ao(e,t,n){if(function(e){return(0,s.AU)("SignalServiceForSubstrate.EnableTeamsAppDeepLink",!1,e.settingsProvider)&&("LoopApp"===e.appName||function(){if("undefined"===typeof window||"undefined"===typeof window.location||"string"!==typeof window.location.search)return!1;const e=new URLSearchParams(window.location.search).get("metaosHost"),t=["Teams","Outlook","Office.com"].map(e=>e.toLowerCase());return!!e&&t.includes(e.toLowerCase())}())}(e))return Po(e,t,n)}const wo="AppContextError",To="MissingAuthorInformation",xo="NotificationActivityStreamError",No="NonODSPResolvedUrl",Ro="NotifyAtMention",bo="QueueAtMentionNotification";class Do{constructor(e){if(this.props=e,!this.props.fileId||!this.props.driveId||!this.props.siteUrl)throw new Error("Invalid file information: fileId, driveId or siteUrl might be missing")}get Disposable(){return this}dispose(){}get NotificationService(){return this}async notifyAtMention(e,t,n){const{siteUrl:r,driveId:o,fileId:i}=this.props,s={siteUrl:r,driveId:o,itemId:i,dataStorePath:t};return this.sendNotification(e,t,n,Ro,s)}async queueAtMentionNotification(e){let{recipient:t,atMentionId:n,contentId:o,navigationPath:s,resolvedUrl:a,threadId:c}=e;const{siteUrl:u,driveId:d,fileId:l,appName:p,logger:f}=this.props,h={itemId:l,driveId:d,siteUrl:u},m=((e,t,n)=>{if(!t)return n&&(0,r.Ot)(n,{eventName:yo}),e;if(!(0,i.g2)(t)){const t=new Error("Invalid file information: ResolvedUrl is not of the expected ODSP type");return n&&(0,r.hO)(n,{eventName:yo},t),e}return{driveId:t.driveId,siteUrl:t.siteUrl,itemId:t.itemId,containerPackageName:t.codeHint?.containerPackageName}})(h,a,f);let I,v;if(a&&(0,i.g2)(a)){const e={siteUrl:a.siteUrl,driveId:a.driveId,itemId:a.itemId};I=a.codeHint?.containerPackageName,v=((e,t)=>{const{siteUrl:n,driveId:r,itemId:o}=t,i=new URL(n).hostname,{siteUrl:s,driveId:a,itemId:c}=e;return i!==new URL(s).hostname||r!==a||o!==c})(h,e)?void 0:await(this.props.getFileContext?.(a,o))}const C={...m,dataStorePath:o,containerPackageName:I,appName:p,context:v};return a&&!(0,i.g2)(a)&&(C.dataStorePath="",f&&(0,r.hO)(f,{eventName:No})),this.sendNotification(t.userPrincipalName,o,s,bo,C,n,c,a)}getAppContext(e,t){let n,r;try{if(e){n={fluidComponents:JSON.parse(e)}}t&&(n=n||{},n.teamsMessage={teamsDeepLinkType:"metaOSAppLink",teamsFluidAppDeepLinkUrl:t})}catch(o){o instanceof Error&&(r=o)}return{appContext:n,appContextError:r}}async notifyOfficeActivityStream(e,t,n,r,o,i,s){const{correlationId:a}=this.props,c={...this.props,fileId:r.itemId,driveId:r.driveId,siteUrl:r.siteUrl},u=function(e,t){const n=(0,Co.kt)(e);if(t.includeFluidSignature)return n;const r=new URLSearchParams(atob(n));return r.delete("fluid"),btoa(r.toString())}(r,{includeFluidSignature:!0}),d=new Qn;d.Id=new P(crypto.randomUUID()),d.Created=d.Observed=new Date,d.SourceApp=Sn.FluidApp,d.SourcePlatform=An.Web,d.SourceSessionId=a?new P(a):w,d.SourceAppContext=o,d.ContentId=i??t,d.NavigationId=u,d.CommentThreadId=s,d.Action=Tn.Create,d.Mentionee=new Un,d.Mentionee.Email=e,d.CommentPreviewAbsenceReason=Jn.UnsupportedClient,n.addAdditionalProps({activityId:d.Id.toString(),contentId:d.ContentId});const l=this.getSetting("EnableActivityFiltering",!0)?this.props.filterActivity:void 0;return!(l&&!await l(d))&&await ro(c,[d])}async sendNotification(e,t,n,r,i,s,a,c){const{getHostAppContext:u}=this.props,d=o.m.start("NotifyOfficeActivityStream",this.props.logger);if(!e)return d.setResult(!1,{navigationPath:n.length>0,entryPoint:r,errorType:To}),!1;const l=await Ao(this.props,i,t),{appContext:p,appContextError:f}=u?{appContext:u(c)}:this.getAppContext(n,l);try{const o=await this.notifyOfficeActivityStream(e,t,d,i,p,s,a);return d.setResult(o&&!f,{appContextSent:!!p,notifyActivity:o,navigationPath:n.length>0,entryPoint:r,...f&&{errorType:wo}},f),o}catch(h){return d.setResult(!1,{appContextSent:!!p,notifyActivity:!1,navigationPath:n.length>0,entryPoint:r,errorType:xo},h),!1}}getSetting(e,t){return(0,s.AU)("SharepointNotificationService."+e,t,this.props.settingsProvider)}}}}]);
//# sourceMappingURL=SharepointNotificationService.617c2053.chunk.js.map