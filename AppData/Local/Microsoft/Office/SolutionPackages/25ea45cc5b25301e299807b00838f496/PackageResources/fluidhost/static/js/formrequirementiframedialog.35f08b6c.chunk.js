"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[75990],{19456:(e,t,r)=>{r.r(t),r.d(t,{FormRequirementIframeDialog:()=>q});var o,a=r(65043),n=r(16112),s=r(52342),i=r(20751);!function(e){e.Desktop="desktop",e.Web="web",e.Mobile="mobile"}(o||(o={}));var d,m,l;!function(e){e.formsEndpoint="https://forms.office.com",e.formsRunTimeIFramePath="/pages/EmbedResponsePage.aspx",e.formsDesignateIframePath="/pages/EmbedDesignPage.aspx",e.formsAppName="Tasks"}(d||(d={})),function(e){e.GetTokenRequest="getToken",e.GetTokenResponse="getTokenSuccess",e.GetTokenResponseV2="accessToken",e.GetTemplate="getTemplate",e.TemplateContent="templateContent",e.SizeChanged="sizeChanged",e.FormReady="contentLoaded",e.ContentReady="contentReady",e.DataValidationResult="formValidationStatus",e.SubmitRequest="submit",e.SubmitStatus="submitStatus",e.SavingStatus="savingStatus",e.ThemeChanged="themeChanged",e.ThemeChangedV2="themeModeChanged",e.KeyDown="keyDown",e.FormsContext="formsContext",e.GetSetting="getSettings",e.Setting="setting",e.GeneralError="generalError",e.ServerError="serverError",e.AuthError="authError"}(m||(m={})),function(e){e.NotStarted="notStarted",e.Saved="saved",e.Saving="saving",e.Failed="failed"}(l||(l={}));var p=r(77508),g=r(25290);const h="error";function c(e,t,r,o){f(r);const a=e=>{t?.postMessage(JSON.stringify(e),r)};return{send(e){const t={...e,meta:{senderId:o}};a(t)},sendWithReturn(t,n){const s=(0,g.DA)();let i;return new Promise((d,m)=>{const l=t=>{const o=u(t,r);o?.meta?.messageId===s&&(e.removeEventListener("message",l),d(o))};e.addEventListener("message",l);const p={...t,meta:{messageId:s,senderId:o}};a(p),n&&(i=e.setTimeout(()=>{m("sendWithReply timeout"),i=void 0},3e3))}).then(t=>(void 0!==i&&e.clearTimeout(i),t))},sendReply(e,t){if(e.meta){const r={...t,meta:{messageId:e?.meta?.messageId,senderId:o}};a(r)}}}}function u(e,t){if(e.origin===t)try{const t=JSON.parse(e.data);if(t&&"object"===typeof t)return t}catch{}}function f(e){if("*"===e)throw new Error(`Post message origin invalid value: '${e}'`)}function v(e){switch(e){case p.Sx.Dark:case p.Sx.TeamsDark:return"dark";case p.Sx.TeamsContrast:return"hc";default:return"light"}}var y;!function(e){e[e.NotStarted=0]="NotStarted",e[e.Saving=1]="Saving",e[e.Saved=2]="Saved",e[e.Failed=3]="Failed"}(y||(y={}));class R extends a.Component{componentDidMount(){const{formsIframeRef:e}=this.state;if(e.current?.contentWindow){const{remove:t}=function(e,t,r,o){f(t);const a=e=>{const a=u(e,t);if(a){if(o&&a.meta?.senderId!==o)return;const e=r[a.type];e?e(a):a.error&&r[h]&&r[h](a)}};return e.addEventListener("message",a,!1),{remove:()=>{e.removeEventListener("message",a,!1)}}}(window,this.formsEndpoint,this.formsIframeMessageHandler);return this.setState({postMessageSender:c(window,e.current.contentWindow,this.formsEndpoint),removeListener:t}),t}}componentWillUnmount(){const{removeListener:e}=this.state;e&&e()}render(){const{formsIframeRef:e}=this.state,{className:t,allow:r,defaultHeight:o}=this.props;return a.createElement("iframe",{className:t,allow:r,sandbox:"allow-modals allow-scripts allow-popups allow-forms allow-popups-to-escape-sandbox allow-same-origin",src:this.formsRuntimeIframeUrl,ref:e,width:"100%",height:o})}constructor(e){super(e),this.formsEndpoint=d.formsEndpoint,this.formsRuntimeIframeUrl=function(e){const t=new URL(d.formsRunTimeIFramePath,d.formsEndpoint);return t.searchParams.append("Id",e),t.searchParams.append("host",d.formsAppName),t.searchParams.append("mode","full"),t.searchParams.append("version","1.1"),t.toString()}(this.props.urlFormId),this.formsIframeMessageHandler={[m.GetSetting]:e=>{const{viewType:t,planNameforTask:r}=this.props,{postMessageSender:o}=this.state,a={type:m.Setting,payload:{viewType:t,themeMode:"light",configuration:{isCreateMyOwnFormEnabled:!1,fileUploadPrefix:r},intelligenceEnabled:["questionSuggestion"]}};o?.sendReply(e,a)},[m.FormsContext]:e=>{this.setState({sessionId:e.payload?.sessionId})},[m.FormReady]:e=>{this.props.eventHandlers?.formReadyEventHandler&&this.props.eventHandlers.formReadyEventHandler()},[m.DataValidationResult]:e=>{const{eventHandlers:t}=this.props;t?.dataValidateEventHandler&&("passed"===e.payload?.status?t.dataValidateEventHandler(!0):t.dataValidateEventHandler(!1))},[m.SizeChanged]:e=>{this.props.eventHandlers?.sizeChangedEventHandler&&this.props.eventHandlers.sizeChangedEventHandler(e.payload)},[m.ContentReady]:e=>{this.props.eventHandlers?.formReadyEventHandler&&this.props.eventHandlers.formReadyEventHandler()},[m.GeneralError]:e=>{const{telemetryLogger:t,componentName:r,eventHandlers:o}=this.props;t&&t(r,m.GeneralError,{error:e.payload?.message}),o?.generalErrorHandler&&o.generalErrorHandler(S(e))},[m.ServerError]:e=>{const{telemetryLogger:t,componentName:r}=this.props;t&&t(r,m.ServerError,{error:e.payload?.message}),this.props.eventHandlers?.serverErrorHandler&&this.props.eventHandlers.serverErrorHandler(S(e))},[m.SubmitStatus]:e=>{"succeeded"===e.payload?.status&&this.props.onResposeIdReceived?.(e.payload?.responseId)},[m.GetTokenRequest]:async e=>{const{postMessageSender:t,sessionId:r}=this.state,{formsTokenProvider:o,telemetryLogger:a,componentName:n}=this.props,s=await E(o,a,n);s&&t?.sendReply(e,{payload:{token:s,sessionId:r}})},[m.AuthError]:async e=>{const{eventHandlers:t,formsTokenProvider:r,telemetryLogger:o,componentName:a}=this.props;if(o){o(a,m.AuthError,{error:e.payload?.message});const t=await E(r,o,a);if(t){const{postMessageSender:r,sessionId:o}=this.state;r?.sendReply(e,{payload:{token:t,sessionId:o}})}}t?.authErrorHandler&&t.authErrorHandler(S(e))}},this.state={formsIframeRef:a.createRef(),sessionId:"",postMessageSender:void 0}}}async function E(e,t,r){try{if(e){return await e()}}catch(o){return void(t&&t(r,m.AuthError,{error:o}))}}function S(e){return{code:e.payload?.code,message:e.payload?.message,isRetriable:e.payload?.isRetriable}}var I=r(86053),x=r(66783),T=r(52195),w=r(8736),b=r(66151),C=r(56415);const D="30px",k=(0,x.J9)((e,t)=>{const r={dialogContainer:[(0,b.dg)(e),{padding:"0px",borderRadius:"3px","> div":{flexGrow:"1"},"@media (min-width: 480px)":{minWidth:"800px"}}],dialogTitle:[F(e),(0,b._D)(e),(0,b.gS)(),{justifyContent:"space-between",alignItems:"center",left:"0",height:"20px",boxSizing:"border-box"}],dialogTopButton:[{display:"flex",alignItems:"center",right:"revert",height:D,boxSizing:"border-box",paddingBottom:"2px",cursor:"pointer",border:"none",background:"none",outline:"none"}],container:[{alignItems:"top",width:"50%",height:"100%",maxWidth:w.B.MainDialogMaxWidth,minWidth:w.B.MainDialogMaxWidth,"@media (min-width: 480px)":{width:"50%",maxWidth:w.B.MainDialogMaxWidth,minWidth:w.B.MainDialogMaxWidth},borderRadius:w.B.PlannerBorderRadius,boxShadow:"rgba(0, 0, 0, 0.4) 0px 0px 5px 0px",".ms-Dialog-inner":[{padding:"0px",overflowY:"auto",maxHeight:"100vh"}],".ms-Dialog-header":[F(e),{height:"40px",border:"1px 0px 1px 0px",position:"sticky",top:"0",zIndex:"10"}],".ms-Modal-scrollableContent":[{overflow:"hidden"}],button:[{width:"fit-content",height:D,backgroundColor:"transparent",":hover":{backgroundColor:"transparent !important"}}],i:[(0,b._D)(e)]}]};return(0,T.TW)(r,t)}),H=(0,x.J9)(e=>({dialogTitle:(0,T.Zq)("dialogTitle",e.dialogTitle),dialogTopButton:(0,T.Zq)("dialogTopButton",e.dialogTopButton),dialogContainer:(0,T.Zq)("dialogContainer",e.dialogContainer),container:(0,T.Zq)("container",e.container)})),N=(0,x.J9)(e=>({title:e.dialogTitle,topButton:e.dialogTopButton})),F=(0,x.J9)(e=>{let t=C.z.NeutralLightGrey96;switch(e){case p.Sx.Dark:case p.Sx.TeamsDark:case p.Sx.TeamsContrast:t=C.z.NeutralDarkGrey32}return{backgroundColor:t}});var M=r(96891),P=r(59846);class q extends n.${name(){return"formsIframeRequirementDialog"}renderComponent(){const{container:e,dialogTopButton:t,dialogTitle:r}=this.getClassNames();return a.createElement(s.l,{hidden:!1,onDismiss:()=>this.props.onDismiss(),dialogContentProps:{showCloseButton:!1,className:this.props.dialogContentClassName,styles:N(k(this.props.theme)),topButtonsProps:[{onRenderIcon:()=>a.createElement("div",{className:t,onClick:this.props.onDismiss},a.createElement(i.I,P.qb),a.createElement("label",{className:r},I.p.Strings.FormRequirementIframeDialog_FormRequirementIframeDialogHeader))}]},modalProps:{containerClassName:e,isBlocking:!0}},this.renderDialogContent())}renderDialogContent(){return a.createElement("div",{className:"formsIframeDialog"},this.renderIframe())}getClassNames(){return H(k(this.props.theme))}renderIframe(){const e=this.context.usageLogger;return a.createElement(R,{defaultHeight:screen.availHeight,viewType:o.Desktop,componentName:this.name(),telemetryLogger:e.logData.bind(e),formsTokenProvider:this.props.formTokenProvider,onResposeIdReceived:this.props.onFormResponseIdReceived,iframeHeaderTitle:I.p.Strings.FormRequirementIframeDialog_FormRequirementIframeDialogHeader,urlFormId:this.props.urlFormId,className:"FormsRunTimeIframe",theme:v(this.props.theme),onError:this.onIframeError,onFormReady:this.onFormReady,planNameforTask:this.props.planNameforTask})}constructor(e,t){super(e,t),this.onIframeError=e=>{this.props.onError&&this.props.onError(e),this.context.usageLogger.logData(this.name(),M.M.FormsRequirementsIframeDialogError,{event:e.message})},this.onFormReady=()=>{this.context.usageLogger.logData(this.name(),M.M.FormsRequirementsIframeDialogFormReady,{})}}}}}]);
//# sourceMappingURL=formrequirementiframedialog.35f08b6c.chunk.js.map