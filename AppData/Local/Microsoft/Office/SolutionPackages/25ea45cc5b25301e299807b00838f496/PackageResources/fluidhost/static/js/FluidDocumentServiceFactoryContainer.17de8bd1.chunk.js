/*! For license information please see FluidDocumentServiceFactoryContainer.17de8bd1.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[97160],{30636:(e,t,r)=>{var i,o;r.d(t,{N:()=>o,V:()=>i}),function(e){e.organization="organization",e.users="users",e.anonymous="anonymous",e.default="default"}(i||(i={})),function(e){e.view="view",e.edit="edit"}(o||(o={}))},67866:(e,t,r)=>{r.r(t),r.d(t,{OdspFluidDocumentServiceFactory:()=>m});var i=r(95996),o=r(60835),n=r(48680),s=r(8088),a=r(48219),d=r(70530);var c=r(92756),u=r(30636),h=r(33788),l=r(29018),v=r(72376),g=r(40635),f=r(74405);class m{get FluidDocumentServiceFactoryProvider(){return this}get Disposable(){return this}dispose(){}get documentServiceFactory(){const e=this.hostFluidDocumentServiceFactory?.documentServiceFactory;if(e)return e;throw new Error("Host did not provide an IDocumentServiceFactory")}get getCreateDocumentRequest(){return async e=>{let t,r;const n=this.userContext?.user.upn??"",s=this.userContext?.displayName??"",a=this.userContext?.user.id??"";try{if(!this.tokenProvider)throw new Error("TokenProvider is not provided");if(!n&&!a)throw new Error("User info is not provided");if(t=this.containerStorageLocationCache.get(this.hostingResolvedUrl.id),t||(t=await async function(e,t){const r=await(0,o.OF)(t,e.siteUrl,e.driveId,e.itemId);return r?.parentReference}(this.hostingResolvedUrl,this.tokenProvider),t&&this.containerStorageLocationCache.set(this.hostingResolvedUrl.id,t)),!t)throw new Error("Failed to get container storage location");return r=await(async(e,t,r,i,o)=>{const n="CheckDocumentAccess",s=h.m.start(n,i);try{const a=(0,l.$)(t.siteUrl),d={getToken:e=>{if(e){const i={...e,siteUrl:t.siteUrl,driveId:t.driveId,itemId:t.itemId};return r.getToken([`${a}/files.readwrite.all`],i)}throw Error("Options must be specified")},url:`${a}/_api/v2.1/drives/${t.driveId}/items/${t.itemId}/oneDrive.checkAccess`,tenantId:o,requestInit:{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:[{email:e.userPrincipalName,objectId:e.id}]})},retryPolicy:v._9,tokenPolicy:(0,v.N$)(r,!1)},c=i?await(0,g.g)({...d,logger:i,nameForLogging:n,getAdditionalProps:async(e,t)=>(0,f.u)(e)}):await(0,g.y)(d),u=await c.result.json();return s.setResult(!0),u?.value?.[0]?.canWrite}catch(a){throw s.setResult(!1,{errorType:"CheckDocumentAccessError"}),a}})({userPrincipalName:n,name:s,id:a},{siteUrl:t.sharepointIds.siteUrl,driveId:t.driveId,itemId:t.id},this.tokenProvider,this.logger,this.userContext?.user.tenantId),r?p(e,{driveId:t.driveId,siteUrl:t.sharepointIds.siteUrl,filePath:w(t.path)},this.settingsProvider):y(e,this.tokenProvider,this.settingsProvider,this.logger)}catch(d){return this.logger&&(0,i.hO)(this.logger,{eventName:"getCreateDocumentRequest"},d),y(e,this.tokenProvider,this.settingsProvider,this.logger)}}}constructor(e,t,r,i){this.hostingResolvedUrl=t,this.containerStorageLocationCache=r,this.logger=i,this.hostFluidDocumentServiceFactory=e.hostDocumentServiceFactory,this.settingsProvider=e.settingsProvider,this.tokenProvider=e.tokenProvider,this.userContext=e.userContext}}function w(e){const t=e.indexOf(":/");if(t<=0)throw new Error("Failed to get path for file creation");return e.slice(t+2)}function p(e,t,r){const i=(0,n.AU)("createAeroLink",!1,r)?void 0:{scope:u.V.organization,role:u.N.edit},o=function(e,t,r,i,o,n){const s=(0,d.wF)(o);return{url:`${e}?driveId=${encodeURIComponent(t)}&path=${encodeURIComponent(r)}${n?`&containerPackageName=${(0,d.nb)(n)}`:""}${s?`&${s}`:""}`,headers:{[a.U.createNew]:{fileName:i}}}}(t.siteUrl,t.driveId,t.filePath,e,i);return o.headers={...o.headers,[c.d.cache]:!1},Promise.resolve(o)}async function y(e,t,r,i){const o=await async function(e,t){if(!e)throw new Error("TokenProvider is undefined");if(!t)throw new Error("Logger is undefined");const r=await(0,s.FX)(e,t,"Production");if(!r)throw new Error("UserOneDriveInfo is undefined");return{siteUrl:r.url,driveId:r.driveId}}(t,i);return p(e,{...o,filePath:"Loop"},r)}}}]);
//# sourceMappingURL=FluidDocumentServiceFactoryContainer.17de8bd1.chunk.js.map