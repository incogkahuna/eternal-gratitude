"use strict";(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[4524],{22227:(e,t,r)=>{r.r(t),r.d(t,{MTSFoundInPlaces:()=>S});var i=r(48680),n=r(46624),s=r(56993),o=r(37097),a=r(53948),d=r(2953),c=r(53383);function l(e){let t="Prod";if(e)switch(e.audience){case"Development":t="Development";break;case"Staging":t="Staging";break;case"Dogfood":t="Dogfood";break;case"Preview":t="Preview";break;default:t="Prod"}return t}async function u(e){const{backlink:t,logger:r,settingsProvider:i,tokenProvider:n}=e,s=(0,a.f1)(t.page_id),u=await(0,o.cC)(n,`https://${s.siteDomain}`,s.driveId,s.itemId,r);if((0,o.dm)(u))return;const p=function(e,t,r){const i={u:e,r:!1},n={w:t?{u:(0,a.xo)(t),r:!1}:void 0,p:i},s=(0,d.M8)(n),o=l(r);return`${(0,c.qh)(o,"v2")}${s}`}((0,a.xo)(t.page_id),t.workspace_id,i);return{icon:u.pageIcon,title:u.title,url:p}}var p=r(30946),m=r(17107),h=r(17601),f=r(40635),g=r(98140),I=r(46507);async function w(e){const{existingFileInfo:t,documentPodId:r,tokenProvider:i}=e,n=t?await(0,p.A7)(i,t):"",s=`fileId=${r??n}`;return await v({...e,urlParams:s,subErrorName:"FluidLoopComponent"})}async function v(e){const{settingsProvider:t,subErrorName:r,userContext:i,logger:n,tokenProvider:o,urlParams:a}=e,d=(0,I.l)(t.audience),c=(0,m.O)(t.audience),l=`${d}/recommended/api/beta/loop/sharedlocations?${a}`,u=k(l,o,t),p=y(t),g=n&&i?await(0,h.k)({url:l,requestInit:p,scopes:c,retryPolicy:m.B,logger:n,nameForLogging:"MTSFoundInPlaces",user:i.user,tokenProvider:o}):await(0,f.y)(u);return await g.result.json().then(e=>{if(P(e))return e;throw new Error("Invalid MTS response")}).catch(e=>{n&&(0,s.e)(n,{eventName:"MtsApiJsonParsingError",subErrorName:r},e)})}const y=e=>({method:"GET",headers:{"Client-Request-Id":crypto.randomUUID(),"X-Office-Application":"300","X-Office-AudienceGroup":e?.audience??"","X-Office-Platform":(0,g.Fr)()?"Mobile":"Web"}}),k=(e,t,r)=>({getToken:e=>{if(e){const i=(0,m.O)(r.audience);return t.getToken(i,e)}throw Error("Options must be specified")},url:e,requestInit:y(r),retryPolicy:m.B}),P=e=>"object"===typeof e&&null!==e&&e.hasOwnProperty("sharing_history")&&Array.isArray(e.sharing_history),U=0,_=1,b=2,E=3,x=4,$=5,T=6,M=7;function C(e,t){switch(e){case void 0:case U:return{host:"Outlook",location:"Email"};case _:return{host:"Teams",location:"Chat"};case b:return{host:"Outlook",location:"Calendar"};case E:return{host:"Teams",location:"Channel"};case x:case $:return{host:"Loop",location:"Workspace"};case T:switch(t){case"Word":return{host:"Word",location:"other"};case"Whiteboard":return{host:"Whiteboard",location:"other"};case"Fluid":return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}case M:return{host:"Loop",location:"Page"};default:return{host:"other",location:"other"}}}var O=r(13379);var R=r(60980),N=r(78010),D=r(45296);async function F(e,t,r){if(void 0===t)return;let i;if("string"===typeof t){const n=await async function(e,t,r){try{return await(0,R.j)(e,t,r)}catch{return}}(t,e,r);i=n?{odspItem:{siteUrl:n.siteUrl,driveId:n.driveId,itemId:n.itemId},fileName:n.fileName}:void 0}else{const n=await async function(e,t,r){try{const i=r?await(0,N.N)(e,t,r):void 0;return i?.name}catch{return}}(t,e,r);i={odspItem:t,fileName:n}}if(void 0===i?.odspItem)return;const n=function(e){const t=e.fileName,r=e.odspItem;if(void 0===t||!L(t))return;const i={siteDomain:new URL(r.siteUrl).hostname,driveId:r.driveId,itemId:r.itemId};return(0,a.an)(i)}(i);return{odspItem:i.odspItem,podId:n}}const L=e=>{const t=(0,D.Q)(e).toLowerCase();return"loop"===t||"fluid"===t};class S{constructor(e,t,r,i){this.tokenProvider=e,this.logger=t,this.settingsProvider=r,this.userContext=i}get foundInPlacesServicePromise(){return Promise.resolve(this)}async getFoundInPlaces(e){let{settingsProvider:t,documentUrl:r,odspItem:i}=e;if(void 0===r&&void 0===i)return this.logger&&(0,s.e)(this.logger,{eventName:"MtsApiUrlUndefinedError"}),{places:[]};const n=this.settingsProvider||t,o=await F(this.tokenProvider,i??r,this.logger),a=await this.getMTSFoundInPlacesResponse(this.tokenProvider,n,o?.odspItem??r,this.logger,o?.podId);return await this.transformMTSResponse(a??{},o?.odspItem)}async getMTSFoundInPlacesResponse(e,t,r,i,n){const o=i||this.logger,a={tokenProvider:e,logger:o,settingsProvider:this.settingsProvider||t,userContext:this.userContext};let d;return n?d=await w({...a,documentPodId:n}):"string"===typeof r?d=await async function(e){const{documentUrl:t}=e,r=`externalUrl=${t}`;return await v({...e,urlParams:r,subErrorName:"FluidNonLoopComponent"})}({...a,documentUrl:r}):r&&(d=await w({...a,existingFileInfo:{siteUrl:r.siteUrl,driveId:r.driveId,fileId:r.itemId}})),void 0===d&&o&&(0,s.e)(o,{eventName:"MtsApiResponseUndefinedError"}),d}async transformMTSResponse(e,t){if(void 0===e.sharing_history)return{places:[]};const r=e.sharing_history.map(async e=>{let r;if(function(e){return(e.sharing_medium===x||e.sharing_medium===$)&&e.hasOwnProperty("workspace")}(e)){const{host:i,location:n}=C(e.sharing_medium),{title:s,url:o}=function(e,t,r){const{title:i,mfs_info:n}=e,s=n.pod_id,o=(0,a.f1)(s),d=l(r);return{title:i,url:t?(0,O.a)({page:{siteOrigin:t.siteUrl,driveId:t.driveId,itemId:t.itemId},pageWorkspaceContext:{driveId:o.driveId,itemId:o.itemId}},d):void 0}}(e.workspace,t);r={host:i,location:n,subject:s,url:o}}else if(function(e){return e.sharing_medium===T&&e.hasOwnProperty("file")}(e)){const{host:t,location:i}=C(e.sharing_medium,e.file.type),{title:n}=e.file;r={host:t,location:i,subject:n,url:e.sharing_reference_url}}else if(function(e){return e.sharing_medium===M&&e.hasOwnProperty("backlink")}(e)&&this.includeBacklinksInList()){const{host:t,location:i}=C(e.sharing_medium),n=await u({backlink:e.backlink,tokenProvider:this.tokenProvider,logger:this.logger});r=n?{host:t,location:i,subject:n.title,url:n.url,icon:n.icon}:void 0}else if(function(e){return(e.sharing_medium===U||e.sharing_medium===b||e.sharing_medium===_||e.sharing_medium===E||void 0===e.sharing_medium)&&e.hasOwnProperty("sharing_reference_url")}(e)){const{host:t,location:i}=C(e.sharing_medium);r={host:t,location:i,subject:e.teams_name&&e.teams_channel_name?`${e.teams_name} / ${e.teams_channel_name}`:e.subject??"",createdDate:e.shared_time?new Date(e.shared_time):void 0,url:e.sharing_reference_url,author:{name:e.sharer?.display_name??"",smtp:e.sharer?.smtp},collaborators:e.participants?.map(e=>({name:e.display_name,smtp:e.smtp}))}}return r});return{places:(await Promise.all(r)).filter(e=>void 0!==e)}}includeBacklinksInList(){if(void 0===this.settingsProvider)return!1;let e=(0,i.AU)("loopApp.sharelinkBacklinkUXConvergence",!1,this.settingsProvider);return this.userContext?.user.tenantId===n.DR&&(e=e&&(0,i.AU)("loopApp.msabacklinks",!1,this.settingsProvider)),e}}},30946:(e,t,r)=>{function i(e){const t=btoa(e);return t.replace(/(\+|\/|\=)/g,e=>{if("+"===e)return"-";if("/"===e)return"_";if("="===e)return"";throw new TypeError(`Unexpected match ${e} encountered in urlEncodeBase64String. Only +/= are to be replaced.`)})}r.d(t,{A7:()=>s,x7:()=>o});var n=r(60835);async function s(e,t,r){const{siteUrl:i,driveId:s,fileId:a}=t,d=await(0,n.sN)(e,i,s,a,r);if(!d)throw new Error("Failed to fetch file sharepoint ids");return o(d,a)}function o(e,t){const{siteId:r,webId:n,listId:s}=e;return`SPO_${i(`${r},${n},${s}`)}_${t}`}},37097:(e,t,r)=>{r.d(t,{cC:()=>l,dm:()=>u});var i=r(33788),n=r(40635),s=r(74405),o=r(29018),a=r(72376),d=r(25969),c=r(30946);async function l(e,t,r,l,u,p){let m=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const h="GetFilePreviewMetadataResponse",f=i.m.start(h,u),g=(0,o.$)(t),I={getToken:i=>{if(i){const n={...i,siteUrl:t,driveId:r,itemId:l};return e.getToken((0,d.K)(g),n)}throw Error("Options must be specified")},url:`${g}/_api/v2.0/drives/${r}/items/${l}?$select=lastModifiedDateTime,lastModifiedBy,name,title,alternateFileIconUrl${m?",sharepointIds":""}`,tenantId:p,requestInit:{method:"GET"},retryPolicy:a._9,tokenPolicy:(0,a.N$)(e)},w=u?(0,n.g)({...I,logger:u,nameForLogging:h,doNotLogOnSuccess:!0,getAdditionalProps:async e=>(0,s.u)(e)}):(0,n.y)(I);let v;try{v=(await w).result,f.setResult(!0)}catch(y){return void f.setResult(!1,void 0,y)}if(v.ok)try{const e=await v.json();return{lastModified:{dateTime:new Date(e.lastModifiedDateTime),user:e.lastModifiedBy.user.displayName||e.lastModifiedBy.user.email},title:e.title||e.name.substring(0,e.name.lastIndexOf(".")),pageIcon:e.alternateFileIconUrl,pageCover:e.pageCover,spoId:m?(0,c.x7)(e.sharepointIds,l):void 0}}catch(y){f.setResult(!1,void 0,y)}else try{const e=await v.json();return{statusCode:v.status,errorMessage:`${e.error.code}${e.error.innerError?` (${e.error.innerError})`:""}: ${e.error.message}`}}catch(y){f.setResult(!1,void 0,y)}}function u(e){return void 0===e||"errorMessage"in e}},60980:(e,t,r)=>{r.d(t,{j:()=>p});var i=r(40635),n=r(74405),s=r(25969),o=r(72376),a=r(78796),d=r(18206),c=r(46624);const l=["files.readwrite.all"],u="https://graph.microsoft.com/v1.0";async function p(e,t,r){const p=new URL(e),m=p.origin,h="Consumer"===t.identityType&&m===a.W,f=btoa(p.toString()).replace(/\//g,"_").replace(/\+/g,"-").replace(/=+$/,""),g={getToken:e=>{if(e){const r={...e,siteUrl:m};return t.getToken(h?l:(0,s.K)(m),h?e:r)}throw Error("Options must be specified")},url:`${h?u:`${m}/_api/v2.0`}/shares/u!${f}/driveItem?select=id,name,parentReference,sharepointIds,package,folder,lastModifiedDateTime`,requestInit:{method:"GET",headers:{Prefer:"redeemSharingLink"}},retryPolicy:h?d.XM:o._9,tokenPolicy:h?void 0:(0,o.N$)(t)},I=r?(0,i.g)({...g,logger:r,nameForLogging:"getOdspItemWithSharepointIdsFromLink",doNotLogOnSuccess:!0,getAdditionalProps:async(e,t)=>(0,n.u)(e)}):(0,i.y)(g),w=await(await I).result.json();if(h)return function(e,t){if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");return{itemId:e.id,driveId:e.parentReference.driveId,siteUrl:t,fileName:e.name,listId:e.sharepointIds?.listId??"",listItemId:e.sharepointIds?.listItemId??"",siteId:e.sharepointIds?.siteId??"",webId:e.sharepointIds?.webId??"",listItemUniqueId:e.sharepointIds?.listItemUniqueId??"",tenantId:c.DR,title:"",package:e.package,folder:e.folder,lastModifiedDateTime:e?.lastModifiedDateTime||void 0}}(w,m);if(!w.sharepointIds?.siteUrl)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if(!w.parentReference?.driveId)throw new Error("Unexpected response: missing parentReference.driveId");if(!w.id)throw new Error("Unexpected response: missing id");return function(e){if("object"!==typeof e)throw new Error("Unexpected response");if(!e.id)throw new Error("Unexpected response: missing id");if(!e.parentReference.driveId)throw new Error("Unexpected response: missing driveId");if(!e.name)throw new Error("Unexpected response: missing name");const{sharepointIds:t}=e;if(!t)throw new Error("Unexpected response: missing sharepointIds");const{listId:r,listItemId:i,siteId:n,webId:s,siteUrl:o,listItemUniqueId:a,tenantId:d}=t;if("string"!==typeof r)throw new Error("Unexpected response: missing sharepointIds.listId");if("string"!==typeof i)throw new Error("Unexpected response: missing sharepointIds.listItemId");if("string"!==typeof n)throw new Error("Unexpected response: missing sharepointIds.siteId");if("string"!==typeof s)throw new Error("Unexpected response: missing sharepointIds.webId");if("string"!==typeof o)throw new Error("Unexpected response: missing sharepointIds.siteUrl");if("string"!==typeof a)throw new Error("Unexpected response: missing sharepointIds.listItemUniqueId");if("string"!==typeof d)throw new Error("Unexpected response: missing sharepointIds.tenantId");return{driveId:e.parentReference.driveId,siteUrl:o,itemId:e.id,listId:r,listItemId:i,siteId:n,webId:s,listItemUniqueId:a,tenantId:d,fileName:e.name,title:e.title,package:e.package,folder:e.folder,lastModifiedDateTime:e?.lastModifiedDateTime||void 0}}(w)}}}]);
//# sourceMappingURL=MTSFoundInPlaces.0432dd45.chunk.js.map