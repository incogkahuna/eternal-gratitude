(self.webpackChunkfluidhost=self.webpackChunkfluidhost||[]).push([[37308],{9376:(t,e,s)=>{var r=s(64416);t.exports=function(t){return t&&t.length?r(t):[]}},16701:(t,e,s)=>{"use strict";s.d(e,{Gx:()=>o,_6:()=>l,mW:()=>r});var r,a=s(94772),i=s(72866),n=s(67271);!function(t){t.DueDate="DueDate",t.Priority="Priority",t.Progress="Progress",t.Label="Label",t.Bucket="Bucket",t.Assignment="Assignment"}(r||(r={}));const o={DueDate:"dueDate",Priority:"priority",Progress:"percentComplete",Label:"appliedCategories",Bucket:"bucketId",Assignment:"assignments"},l=new i.d("percentComplete",[(0,n.BK)(a.$.NotStarted),(0,n.BK)(a.$.InProgress)])},25588:(t,e,s)=>{"use strict";var r;s.d(e,{s:()=>r}),function(t){t.TeamsTab="teamsTab",t.SharePointPage="sharePointPage",t.MeetingNotes="meetingNotes",t.LoopPage="loopPage",t.Other="other"}(r||(r={}))},27197:(t,e,s)=>{"use strict";s.d(e,{o:()=>a});var r=s(75992);class a extends r.r{loggingData(){return{id:this.deletedTaskEntitySet.id,isSystemGenerated:String(this.isSystemGenerated)}}constructor(t){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];super(a.actionType),this.deletedTaskEntitySet=t,this.isSystemGenerated=e}}a.actionType="PLW_DELETE_TASK_SUCCEEDED"},29274:(t,e,s)=>{"use strict";s.d(e,{S:()=>i});var r=s(75992),a=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},t(e,s)};return function(e,s){function r(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}(),i=function(t){function e(s,r,a){var i=t.call(this,e.type)||this;return i.name=s,i.id=r,i.additionalData=a,i}return a(e,t),e.prototype.loggingData=function(){return{name:this.name,id:this.id}},e.type="BEGIN_TRANSACTION",e}(r.r)},30210:(t,e,s)=>{"use strict";s.d(e,{Z:()=>k,g:()=>T});var r=s(25588),a=s(54320),i=s.n(a),n=s(32520),o=s.n(n),l=s(57273),c=s.n(l),d=s(87424),g=s.n(d),u=s(78332),p=s(45795),h=s(67053);function k(t,e){if(!t||i()(t.contexts)||!e)return!1;const s=Object.keys(t.contexts);return-1!==o()(s,t=>{const s=e.contextDetails[t];return null!=s&&s.displayAs===r.s.MeetingNotes})}function T(t,e){if(i()(t))return null;const s=c()(t,(t,s)=>{switch(e){case p.s.Teams:return h.c.isTeamsPlannerClientEntraAppId(t.ownerAppId);case p.s.SharepointApp:return h.c.isSharepointAppId(t.ownerAppId);case p.s.Plex:return t.ownerAppId===u.uc.PlannerWeb;case void 0:return h.c.isTeamsPlannerClientEntraAppId(t.ownerAppId)||h.c.isSharepointAppId(t.ownerAppId)||t.ownerAppId===u.uc.PlannerWeb;default:throw new Error(`Invalid client type specified [ClientType=${e}]`)}}),r=Object.keys(s);return i()(r)?null:g()(r,[t=>s[t].createdDate])[0]}},39227:(t,e,s)=>{"use strict";s.r(e),s.d(e,{TaskModule:()=>ft});var r=s(79757),a=s(69292),i=s(41788),n=s(73322),o=s(48475),l=s(40164),c=s(45721),d=s(23359),g=s(90506),u=s(27197),p=s(28571),h=s(96693),k=s(96020),T=s(31316),m=s(713),f=s(73624),F=s(83574),y=s(89469),v=s(69252),w=s(48537),A=s(449),D=s(14e3),I=s(75992);class b extends I.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(b.actionType),this.failedTaskId=t}}b.actionType="PLW_REORDER_TASKS";class S extends I.r{loggingData(){return{id:this.failedTaskId}}constructor(t){super(S.actionType),this.failedTaskId=t}}S.actionType="PLW_REORDER_TASKS_SUCCEEDED";class P extends I.r{loggingData(){return{id:this.failedTaskId,reorderPhase:this.reorderPhase}}constructor(t,e){super(P.actionType),this.failedTaskId=t,this.reorderPhase=e}}P.actionType="PLW_REORDER_TASKS_FAILED";var C=s(79799),E=s(59393),x=s(40699),O=s(66061),_=s(95783),B=s(78332),$=s(45795),L=s(38752),V=s(64805);class R extends Error{constructor(t){super(),this.errorMessage=t,this.message=t||"",this.name="ParseContextKeyError"}}R.DOUBLE_ENCODED_CONTEXTKEY="The Context Key is double encoded";var j=s(9962),U=s(52274),H=s(32561),W=s(80708),N=s(39589),K=s(70252),M=s(74844),G=s(65818),q=s(14740),Y=s.n(q),X=s(32520),J=s.n(X),Z=s(55491),Q=s.n(Z),z=s(54320),tt=s.n(z),et=s(10871),st=s.n(et),rt=s(33411),at=s.n(rt),it=s(35640),nt=s.n(it),ot=s(91246),lt=s(67271),ct=s(7670),dt=s(98424),gt=s(98502),ut=s(54439),pt=s(82841),ht=s(21382),kt=s(86053),Tt=s(30210);class mt{static parseChannelIdFromTeamsContextKey(t){if(""===t)throw new R("Context key cannot be empty");const e=decodeURIComponent(t);if(decodeURIComponent(e)!==e)throw new R(R.DOUBLE_ENCODED_CONTEXTKEY);const s=e.split("#"),r=parseInt(s[0],10);if(isNaN(r)||2!==s.length||s[1].length<=r)throw new R(`Invalid context key: ${e}`);return s[1].slice(r)}static findDuplicateTeamsContextKeys(t,e){const s=[];for(const i in t){const e=t[i];e.ownerAppId!==B.uc.MSTeamsWeb&&e.ownerAppId!==B.uc.MSTeamsDesktop||s.push(i)}if(s.length<2)return[];const r={},a=[];for(const i of s){const t="#",s=i.split(t),n=parseInt(s[0],10);if(isNaN(n)||2!==s.length||s[1].length<=n){e.logTrace(507778444,M.k.Warning,`Invalid context encountered when deduping Teams contexts. [contextKey=${i}]`);continue}const o=s[1].slice(n),l=36;null==r[o]?r[o]={teamIdLength:n,contextKey:i}:r[o].teamIdLength===l?(a.push(r[o].contextKey),r[o]={teamIdLength:n,contextKey:i}):a.push(i)}return a}}class ft extends V.J{get name(){return"TaskModule"}async createTaskAsync(t,e,s){this.loggers.traceLogger.logTrace(507897177,M.k.Verbose,`Create task [TaskId=${t.id}]`);const n=t.id+"_createTask";ut.j.beginTransaction(this.dispatcher,{name:"createTask",transactionId:n,action:new r.M(t)},this.loggers.logHandler);const o=e=>{ut.j.completeTransactionWithError(this.dispatcher,{transactionId:n,errorMessage:"",action:new a.N(t,e.response,e.response?.statusText??"",e.error?.message??"")})};if(e)try{await e}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897176,M.k.Warning,`Create task - Dependent promise fail [TaskId=${t.id}]${(0,pt.s8)(e)}`),o(e),Promise.reject(e)}try{const e=await this.webApiProviders.taskService(),s=await e.createTaskAsync({newTaskEntitySet:t});return this.loggers.traceLogger.logTrace(507897175,M.k.Verbose,`Create task - Success [TaskId=${t.id}]`),ut.j.completeTransaction(this.dispatcher,{transactionId:n,action:new i.r(s,t.task.id),additionalData:s.task}),s}catch(l){const e=l;return this.loggers.traceLogger.logTrace(507897174,M.k.Warning,`Create task - Fail [TaskId=${t.id}]${(0,pt.s8)(e)}`),e.error instanceof U.U||null==s?o(e):s(e,()=>o(e)),Promise.reject(e)}}async createTaskApprovalAsync(t,e){const s=this.stores.taskStore.getTask(t),r=ht.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Title,s?.title),a=ht.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_AttachmentName,s?.title);let i=null,l="",c=null;if(s){const e=this.stores.planStore.getPlan(s.planId);if(e){const s=e.container.externalId,r=null!=s?this.stores.containerStore.getContainer(s):null,a=r?.containerType===G.K.Group?r:null;i=a?.unifiedGroup??null;try{if(c=(0,Tt.g)(e.contexts,$.s.Teams),!c)throw new Error("Plan context key cannot be null or empty");l=mt.parseChannelIdFromTeamsContextKey(c)}catch(p){const s=`Failed to parse channel id from teams plan context key [TaskId=${t}][PlanId=${e.id}][ContextKey=${c}][Error=${p}]`;if(!(c&&e.contexts[c]&&p instanceof R))return this.loggers.traceLogger.logTrace(507122386,M.k.Warning,`Create task approval - ${s}`),Promise.reject(gt.g.generateAjaxClientError(null,s));this.loggers.traceLogger.logTrace(507122387,M.k.Warning,p.message,{PlanId:e.id,ContextKey:c,CreatedDateTime:e.contexts[c].createdDate?.toISOString()??"",OwnerAppId:e.contexts[c].ownerAppId??""});try{if(p.message!==R.DOUBLE_ENCODED_CONTEXTKEY)throw p;c=decodeURIComponent(c),l=mt.parseChannelIdFromTeamsContextKey(c)}catch(p){return this.loggers.traceLogger.logTrace(507122388,M.k.Warning,`Create task approval - ${s}[RetryError=${p}]`),Promise.reject(gt.g.generateAjaxClientError(null,s))}}}}this.dispatcher.dispatchAction(new n.Z(t));const d=i?.id??"",g=i?.displayName??"",u=ht.G(kt.p.Strings.AddApprover_TaskEditorWrapper_SendApprovalRequest_Details,g);try{const s={taskId:t,approverIds:e,rosterContext:{teamId:d,channelId:l},title:r,attachmentName:a,details:u};if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService(),r=await e.createApprovalAsync(s);return this.loggers.traceLogger.logTrace(507790346,M.k.Verbose,`Create task approval - Success [TaskId=${t}, CreatedApprovalId=${r}]`),{approvalId:r}}{const e=await this.webApiProviders.taskService(),r=await e.createApproval(s);return this.loggers.traceLogger.logTrace(507270737,M.k.Verbose,`Create task approval - Success [TaskId=${t}, CreatedApprovalId=${r}]`),r}}catch(p){const e=p;return this.loggers.traceLogger.logTrace(507790345,M.k.Warning,`Create task approval - Fail [TaskId=${t}] ${(0,pt.s8)(e)}`),this.dispatcher.dispatchAction(new o.C(e.response,e.response?.statusText??"",e.error?.message??"",t)),Promise.reject(e)}}async updateTaskAsync(t,e,s,r){this.loggers.traceLogger.logTrace(507897173,M.k.Verbose,`Update task [TaskId=${t.id}]`);const a=e.id+"_updateTask",i=ot.o.generate(),n=t.task.getDiff(e.task),o=null!=t.taskDetails&&null!=e.taskDetails?t.taskDetails.getDiff(e.taskDetails):{},g=null!=t.taskFormatData?.assignmentBoardFormat&&null!=e.taskFormatData?.assignmentBoardFormat?t.taskFormatData.assignmentBoardFormat.getDiff(e.taskFormatData.assignmentBoardFormat):{},u=null!=t.taskFormatData?.bucketBoardFormat&&null!=e.taskFormatData?.bucketBoardFormat?t.taskFormatData.bucketBoardFormat.getDiff(e.taskFormatData.bucketBoardFormat):{},p=null!=t.taskFormatData?.progressBoardFormat&&null!=e.taskFormatData?.progressBoardFormat?t.taskFormatData.progressBoardFormat.getDiff(e.taskFormatData.progressBoardFormat):{};ut.j.beginTransaction(this.dispatcher,{name:"updateTask",transactionId:a,action:new l.f(t,e,i)},this.loggers.logHandler);const h=t=>{let e=t.originalTaskEntitySet.task,s=t.updatedTaskEntitySet.task;const r=this.stores.taskStore.getTaskWithoutPendingUpdates(t.originalTaskEntitySet.id),a=null!=r&&null!=e&&null!=s;if(!tt()(n)||a){if(null==r)throw gt.g.generateAjaxClientError(null,new j.m("taskWithoutPending","taskStore"));e=r,s=e.applyDiffs(n)}let i=t.originalTaskEntitySet.taskDetails,l=t.updatedTaskEntitySet.taskDetails;if(null!=t.originalTaskEntitySet.taskDetails&&null!=t.updatedTaskEntitySet.taskDetails&&!tt()(o)){const e=this.stores.taskStore.getTaskDetailsWithoutPendingUpdates(t.originalTaskEntitySet.id);if(null==e)throw gt.g.generateAjaxClientError(null,new j.m("detailsWithoutPending","taskStore"));i=e,l=i.applyDiffs(o)}let c=t.originalTaskEntitySet.taskFormatData,d=t.updatedTaskEntitySet.taskFormatData;if(null!=t.originalTaskEntitySet.taskFormatData&&null!=t.updatedTaskEntitySet.taskFormatData){const e=this.stores.taskStore.getTaskboardTaskFormattingWithoutPendingUpdates(t.originalTaskEntitySet.id);let s=null,r=null;null==t.originalTaskEntitySet.taskFormatData.assignmentBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.assignmentBoardFormat||null==e?.assignmentBoardFormat||tt()(g)||(s=e.assignmentBoardFormat,r=s.applyDiffs(g));let a=null,i=null;null==t.originalTaskEntitySet.taskFormatData.bucketBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.bucketBoardFormat||null==e?.bucketBoardFormat||tt()(u)||(a=e.bucketBoardFormat,i=a.applyDiffs(u));let n=null,o=null;null==t.originalTaskEntitySet.taskFormatData.progressBoardFormat||null==t.updatedTaskEntitySet.taskFormatData.progressBoardFormat||null==e?.progressBoardFormat||tt()(p)||(n=e.progressBoardFormat,o=n.applyDiffs(p)),(s||a||n)&&(c=N._.builder.withPropertyBag({assignedBoardFormat:s||void 0,bucketBoardFormat:a||void 0,progressBoardFormat:n||void 0}).build()),(r||i||o)&&(d=N._.builder.withPropertyBag({assignedBoardFormat:r||void 0,bucketBoardFormat:i||void 0,progressBoardFormat:o||void 0}).build())}return{originalTaskEntitySet:W.F.builder.withTask(e).withDetails(i).withFormatData(c).build(),updatedTaskEntitySet:W.F.builder.withTask(s).withDetails(l).withFormatData(d).build()}},k=s=>{ut.j.completeTransactionWithError(this.dispatcher,{transactionId:a,errorMessage:"",action:new c.K(t,e,i,s.response,s.response?.statusText??"",s.error?.message??"")})};if(s)try{await s}catch(T){const e=T;return this.loggers.traceLogger.logTrace(507897172,M.k.Warning,`Update task - Dependent promise fail [TaskId=${t.id}]${(0,pt.s8)(e)}`),k(e),Promise.reject(e)}try{const s=await this.webApiProviders.taskService(),r=await s.updateTaskAsync({originalTaskEntitySet:t,updatedTaskEntitySet:e},h);return this.loggers.traceLogger.logTrace(507897171,M.k.Verbose,`Update task - Success [TaskId=${t.id}]`),ut.j.completeTransaction(this.dispatcher,{transactionId:a,action:new d.U(t,r,i)}),r}catch(T){this.loggers.traceLogger.logTrace(507897170,M.k.Warning,`Update task - Fail [TaskId=${t.id}]${(0,pt.LB)(T)}`);const e=T;return e.error instanceof U.U||null==r?k(e):r(e,()=>k(e)),Promise.reject(e)}}async deleteTaskAsync(t,e){this.loggers.traceLogger.logTrace(507897169,M.k.Verbose,`DeleteTask [TaskId=${t}][Version=${e}]`);const s=this.stores.taskStore.getTask(t);if(null==s)throw gt.g.generateAjaxClientError(null,new j.m("task","taskStore"));this.dispatcher.dispatchAction(new g.N(W.F.builder.withTask(s).build()));try{const s=await this.webApiProviders.taskService(),r=await s.deleteTaskAsync({taskId:t,itemVersion:e});return this.loggers.traceLogger.logTrace(507897168,M.k.Verbose,`DeleteTask - Success [TaskId=${t}][Version=${e}]`),this.dispatcher.dispatchAction(new u.o(r)),r}catch(r){const a=r;return this.loggers.traceLogger.logTrace(507897167,M.k.Warning,`DeleteTask - Fail [TaskId=${t}][Version=${e}] ${(0,pt.s8)(a)}`),this.dispatcher.dispatchAction(new p.a(W.F.builder.withTask(s).build(),a.response,a.response?.statusText??"",a.error?.message??"")),Promise.reject(a)}}async undeleteTaskAsync(t){this.loggers.traceLogger.logTrace(507897166,M.k.Verbose,`Undelete task [TaskId=${t.id}]`),this.dispatcher.dispatchAction(new h.G(t));try{const e=await this.webApiProviders.taskService(),s=await e.undeleteTaskAsync({taskId:t.id,itemVersion:t.task.itemVersion});return this.loggers.traceLogger.logTrace(507897165,M.k.Verbose,`Undelete task - Success [TaskId=${t.id}]`),this.dispatcher.dispatchAction(new k.N(s)),s}catch(e){const s=e;return this.loggers.traceLogger.logTrace(507897164,M.k.Warning,`Undelete task - Fail [TaskId=${t.id}]${(0,pt.s8)(s)}`),this.dispatcher.dispatchAction(new T.f(t,s.response,s.response?.statusText??"",s.error?.message??"")),Promise.reject(s)}}async fetchTaskAsync(t,e,s){this.loggers.traceLogger.logTrace(507897163,M.k.Verbose,`Fetching Task [TaskId=${t}][Force=${e??!1}]`);const r=this.stores.taskStore.getTask(t),a=this.stores.taskStore.getTaskDetails(t),i=this.stores.taskStore.getTaskboardTaskFormatting(t);if(!e&&r&&a&&i&&i.assignmentBoardFormat&&i.bucketBoardFormat&&i.progressBoardFormat)return Promise.resolve(W.F.builder.withTask(r).withDetails(a).withFormatData(i).build());let n,o;e||(n=t=>{const e=this.stores.taskStore.getTask(t.taskId),s=this.stores.taskStore.getTaskDetails(t.taskId),r=this.stores.taskStore.getTaskboardTaskFormatting(t.taskId);return null==e||null==s||null==r||null==r.assignmentBoardFormat||null==r.bucketBoardFormat||null==r.progressBoardFormat?null:W.F.builder.withTask(e).withDetails(s).withFormatData(r).build()},o=this.getCurrentViewIds());const l=t+B.Ek.FetchTask;ut.j.beginTransaction(this.dispatcher,{name:"fetchTask",transactionId:l},this.loggers.logHandler);try{const r=await this.webApiProviders.taskService(),a=await r.getTaskEntitySetAsync({taskId:t},n,o,s);return this.loggers.traceLogger.logTrace(507897162,M.k.Verbose,`Fetching Task - Success [TaskId=${t}][Force=${e??!1}][taskCreationSourceType=${a.task.taskCreationSourceType}]`),ut.j.completeTransaction(this.dispatcher,{transactionId:l,action:new m.U(a)}),a}catch(c){const s=c;return this.loggers.traceLogger.logTrace(507897161,M.k.Warning,`Fetching Task - Fail [TaskId=${t}][Force=${e??!1}]${(0,pt.s8)(s)}`),ut.j.completeTransactionWithError(this.dispatcher,{transactionId:l,errorMessage:"",additionalData:null!=s.response?{statusCode:s.response.status}:void 0}),Promise.reject(s)}}async fetchPlanTasksAsync(t,e){this.loggers.traceLogger.logTrace(507897160,M.k.Verbose,`Fetching Plan Tasks [PlanId=${t}][Force=${e??!1}]`);const s=[];try{const r=await this.fetchPlanTasksRecursiveAsync(t,s,void 0,e);return this.loggers.traceLogger.logTrace(507897159,M.k.Verbose,`Fetching Plan Tasks - Success [PlanId=${t}][Force=${e??!1}]`),r}catch(r){const s=r;return this.loggers.traceLogger.logTrace(507897158,M.k.Warning,`Fetching Plan Tasks - Fail [PlanId=${t}][Force=${e??!1}]${(0,pt.s8)(s)}`),Promise.reject(s)}}async fetchTasksAssignedToUserAsync(t){this.loggers.traceLogger.logTrace(507897157,M.k.Verbose,"Fetching My Tasks");const e=[];try{const s=await this.fetchTasksAssignedToUserRecursiveAsync(t,void 0,e);return this.loggers.traceLogger.logTrace(507897156,M.k.Info,"Fetching User Assigned Tasks - Success"),s}catch(s){const t=s;return this.loggers.traceLogger.logTrace(507897155,M.k.Warning,`Fetching User Assigned Tasks - Fail ${(0,pt.s8)(t)}`),Promise.reject(t)}}async fetchTaskApprovalDetailsAsync(t){this.loggers.traceLogger.logTrace(507897154,M.k.Verbose,"Fetching Task Approval Details"),this.dispatcher.dispatchAction(new f.n(t));try{if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService(),s=await e.getApprovalDetailsAsync({taskId:t});return this.loggers.traceLogger.logTrace(507897153,M.k.Verbose,"Fetching Task Approval Details - Success"),this.dispatcher.dispatchAction(new F.j(t,s)),{properties:s,name:""}}{const e=await this.webApiProviders.taskService(),s=await e.getApprovalDetailsAsync({taskId:t});return this.loggers.traceLogger.logTrace(507275287,M.k.Verbose,"Fetching Task Approval Details - Success"),this.dispatcher.dispatchAction(new F.j(t,s.properties)),s}}catch(e){const s=e;return this.loggers.traceLogger.logTrace(507897152,M.k.Warning,`Fetching Task Approval Details - Fail ${(0,pt.s8)(s)}`),this.dispatcher.dispatchAction(new y.E(s.response,s.response?.statusText??"",s.error?.message??"",t)),Promise.reject(s)}}async cancelApprovalAsync(t){this.loggers.traceLogger.logTrace(507790350,M.k.Verbose,"Canceling Approval"),this.dispatcher.dispatchAction(new v.x(t));try{if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const e=await this.webApiProviders.retailService();await e.cancelApprovalAsync({taskId:t})}else{const e=await this.webApiProviders.taskService();await e.cancelApproval({taskId:t})}this.loggers.traceLogger.logTrace(507639747,M.k.Verbose,"Canceling Approval - Success")}catch(e){const s=e;return this.loggers.traceLogger.logTrace(507790349,M.k.Warning,`Canceling Approval - Fail ${(0,pt.s8)(s)}`),this.dispatcher.dispatchAction(new w.W(s.response,s.response?.statusText??"",s.error?.message??"",t)),Promise.reject(s)}}async updateTaskApprovalAsync(t,e,s){this.loggers.traceLogger.logTrace(507790348,M.k.Verbose,"Updating task approval status"),this.dispatcher.dispatchAction(new A.O(t));try{const r={taskId:t,response:e,comments:s};if(this.shouldUseRetailService()&&this.webApiProviders.retailService){const t=await this.webApiProviders.retailService();await t.updateApprovalAsync(r)}else{const t=await this.webApiProviders.taskService();await t.updateApproval(r)}this.loggers.traceLogger.logTrace(507639746,M.k.Verbose,"Updating task approval status - Success")}catch(r){const e=r;return this.loggers.traceLogger.logTrace(507790347,M.k.Warning,`Updating task approval status - Fail ${(0,pt.s8)(e)}`),this.dispatcher.dispatchAction(new D.L(e.response,e.response?.statusText??"",e.error?.message??"",t)),Promise.reject(e)}}fixTaskOrderHintPrecision(t,e,s,r,a,i){this.loggers.traceLogger.logTrace(507635296,M.k.Info,`FixTaskOrderHintPrecision [TaskId=${e.id}]`);const n=null==e.task?this.stores.taskStore.getTask(e.id):e.task,o=null!=n?this.stores.planStore.getPlan(n.planId):null,l=null!=n?this.stores.taskStore.getTasksForPlan(n.planId):null;if(null==e||null==e.taskFormatData||null!=t&&null==t.taskFormatData||null==n||null==o||null==l||tt()(l))return this.loggers.traceLogger.logTrace(507635295,M.k.Info,`FixTaskOrderHintPrecision - Invalid data [TaskId=${e.id}]`),i(),void s();const c=st()(this.stores.userStore.getContainerUsers(o.container.externalId),"id"),d=[];if(null==t&&null!=e.taskFormatData.assignmentBoardFormat||null!=t?.taskFormatData?.assignmentBoardFormat&&null!=e.taskFormatData.assignmentBoardFormat){const s=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(n.planId,K.s.AssignedTo),"id"),r=this.filterTaskGroupsByCompletion((0,ct.Fy)(l,s,c,this.stores.appContextStore.getCurrentUserId()),n.isComplete());Q()(r,s=>{const r=e.taskFormatData?N._.getAssignedToOrderHint(e.taskFormatData,s.pivotValue):null;null==r||tt()(s.pivotValue)&&0!==nt()(e.taskFormatData?.assignmentBoardFormat?.orderHintsByAssignee)||null!=t&&(t.taskFormatData?N._.getAssignedToOrderHint(t.taskFormatData,s.pivotValue):null)===r||d.push(this.getTaskGroupReorderData(s,e.id,N._.getAssignedToOrderHint,N._.setAssignedToOrderHint))})}if(null==t&&null!=e.taskFormatData.bucketBoardFormat||null!=t?.taskFormatData?.bucketBoardFormat&&null!=e.taskFormatData.bucketBoardFormat&&t?.taskFormatData.bucketBoardFormat.orderHint!==e.taskFormatData.bucketBoardFormat.orderHint){const t=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(n.planId,K.s.Bucket),"id"),s=this.filterTaskGroupsByCompletion((0,ct.M1)(l,t,n.bucketId?Y()([this.stores.bucketStore.getBucket(n.bucketId)]):[]).filter(t=>null!=t.pivotValue),n.isComplete());s.length>0&&d.push(this.getTaskGroupReorderData(s[0],e.id,N._.getBucketOrderHint,N._.setBucketOrderHint))}if(null==t&&null!=e.taskFormatData.progressBoardFormat||null!=t?.taskFormatData?.progressBoardFormat&&null!=e.taskFormatData.progressBoardFormat&&t?.taskFormatData.progressBoardFormat.orderHint!==e.taskFormatData.progressBoardFormat.orderHint){const t=st()(this.stores.taskStore.getTaskboardTaskFormattingForPlan(n.planId,K.s.Progress),"id"),s=(0,ct.py)(l,t);Q()(s,t=>{t.pivotValue===(0,lt.Fk)(n.percentComplete)&&d.push(this.getTaskGroupReorderData(t,e.id,N._.getProgressOrderHint,N._.setProgressOrderHint))})}const g=this.hasInternalOrderHints(e);if(g&&(e=this.fixInternalOrderHintPrecision(e)),tt()(d)&&!g)return this.loggers.traceLogger.logTrace(507635294,M.k.Verbose,`FixTaskOrderHintPrecision - No updates needed [TaskId=${e.id}]`),i(),void s();this.dispatcher.dispatchAction(new b(n.id)),r(d,!0).then(o=>{this.loggers.traceLogger.logTrace(507897123,M.k.Verbose,`FixTaskOrderHintPrecision - Reordered above groups [TaskId=${e.id}]`),i(),a(t,e,o).then(t=>{this.loggers.traceLogger.logTrace(507897122,M.k.Verbose,`FixTaskOrderHintPrecision - Fixed task [TaskId=${e.id}][taskCreationSourceType=${n.taskCreationSourceType}]`),r(t,!1).then(()=>{this.loggers.traceLogger.logTrace(507897121,M.k.Verbose,`FixTaskOrderHintPrecision - Reordered bottom groups [TaskId=${e.id}]`),this.dispatcher.dispatchAction(new S(n.id))},()=>{this.loggers.traceLogger.logTrace(507897120,M.k.Verbose,`FixTaskOrderHintPrecision - Failed to reorder bottom groups [TaskId=${e.id}]`),this.dispatcher.dispatchAction(new P(n.id,"Reorder below tasks"))})},()=>{this.loggers.traceLogger.logTrace(507897119,M.k.Info,`FixTaskOrderHintPrecision - Failed to fix task [TaskId=${e.id}][taskCreationSourceType=${n.taskCreationSourceType}]`),s(),this.dispatcher.dispatchAction(new P(n.id,"Fix task"))})},()=>{this.loggers.traceLogger.logTrace(507897118,M.k.Verbose,`FixTaskOrderHintPrecision - Failed to reorder above groups [TaskId=${e.id}]`),i(),s(),this.dispatcher.dispatchAction(new P(n.id,"Reorder above tasks"))})}async fetchPlanTasksRecursiveAsync(t,e,s,r){let a=t=>{if(null!=t.nextContinuationToken)return null;const e=this.stores.taskStore.getTasksForPlan(t.planId);if(tt()(e))return null;const s=at()(e,t=>{const e=this.stores.taskStore.getTaskDetails(t.id),s=this.stores.taskStore.getTaskboardTaskFormatting(t.id);return W.F.builder.withTask(t).withDetails(e??void 0).withFormatData(s??void 0).build()});return{xCorrelationId:"",statusCode:_.t3.OK,data:{NextContinuationToken:null,Results:s}}};const i=this.stores.planStore.getContainerIdForPlan(t);let n=this.getCurrentViewIds();r&&(a=void 0,n=void 0);try{const r=await this.webApiProviders.taskService(),o=await r.getTasksForPlanAsync({planId:t,nextContinuationToken:s},a,n);e.push(...o.data.Results);const l=new C.a(t,i,o.data.Results,o.data.NextContinuationToken,null==s,null!=o.data.NextContinuationToken?null:e.map(t=>t.id));return this.dispatcher.dispatchAction(l),null!=o.data.NextContinuationToken?this.fetchPlanTasksRecursiveAsync(t,e,o.data.NextContinuationToken):{...o,data:{...o.data,Results:e}}}catch(o){const e=o;return this.dispatcher.dispatchAction(new E.q(e.response,e.response?.statusText??"",e.error?.message??"",t)),Promise.reject(e)}}async fetchTasksAssignedToUserRecursiveAsync(t,e){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];const r=this.getCurrentViewIds();try{const a=await this.webApiProviders.taskService(),i=await a.getTasksAssignedToCurrentUserAsync({nextContinuationToken:e},r);return s.push(...i.data.Results),this.dispatcher.dispatchAction(new x.e(t,i.data.Results,i.data.NextContinuationToken,null==e)),null!=i.data.NextContinuationToken?this.fetchTasksAssignedToUserRecursiveAsync(t,i.data.NextContinuationToken,s):{...i,data:{...i.data,Results:s}}}catch(a){const e=a;return this.dispatcher.dispatchAction(new O.y(e.response,e.response?.statusText??"",e.error?.message??"",t)),Promise.reject(e)}}filterTaskGroupsByCompletion(t,e){const s=[];return Q()(t,t=>{const r={pivotValue:t.pivotValue,dataEntities:[],isOpen:t.isOpen};for(;t.dataEntities&&t.dataEntities.length>0;){const s=t.dataEntities.shift();s&&r.dataEntities&&s.isComplete()===e&&r.dataEntities.push(s)}s.push(r)}),s}getTaskGroupReorderData(t,e,s,r){const a=J()(t.dataEntities,t=>t.id===e),i={aboveTasks:null,belowTasks:null,nextOrderHint:dt.O.generateOrderHintBetween(null,null),pivotValue:t.pivotValue,getOrderHint:s,setOrderHint:r};return t.dataEntities&&a>0&&(i.aboveTasks=t.dataEntities.slice(0,a)),t.dataEntities&&a<t.dataEntities.length-1&&(i.belowTasks=t.dataEntities.slice(a+1)),i}hasInternalOrderHints(t){return!tt()(t.task.assignments)||!tt()(t.taskDetails?.checklist)||!tt()(t.taskDetails?.references)}fixInternalOrderHintPrecision(t){const e=W.F.builder.withTask(t.task).withDetails(t.taskDetails).withFormatData(t.taskFormatData);if(null!=t.task.assignments){const s=(t,e)=>dt.O.compareOrderHints(t.order,e.order),r=(t,e)=>t.setProperty("order",e);e.withTask(t.task.setProperty("assignments",this.fixCollectionOrder(t.task.assignments,s,r)))}if(null!=t.taskDetails){const s=H.U.builder.forClone(t.taskDetails);if(!tt()(t.taskDetails.checklist)){const e=(t,e)=>dt.O.compareOrderHints(e.orderHint,t.orderHint),r=(t,e)=>t.setProperty("orderHint",e);s.checklist=this.fixCollectionOrder(t.taskDetails.checklist,e,r)}if(!tt()(t.taskDetails.references)){const e=(t,e)=>dt.O.compareOrderHints(t.previewPriority,e.previewPriority),r=(t,e)=>t.setProperty("previewPriority",e);s.references=this.fixCollectionOrder(t.taskDetails.references,e,r)}e.taskDetails=s.build()}return e.build()}fixCollectionOrder(t,e,s){const r={};let a=[];Q()(t,(t,e)=>a.push({key:e,value:t})),a=a.sort((t,s)=>e(t.value,s.value));let i=null;return Q()(a,t=>{i=dt.O.generateOrderHintBetween(i,null),r[t.key]=s(t.value,i)}),r}shouldUseRetailService(){return L.B.isUnoContext&&!!this.webApiProviders.retailService}}},47204:(t,e,s)=>{"use strict";s.d(e,{Y:()=>i});var r=s(75992),a=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},t(e,s)};return function(e,s){function r(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}(),i=function(t){function e(s,r,a){var i=t.call(this,e.type)||this;return i.id=s,i.errorMessage=r,i.additionalData=a,i}return a(e,t),e.prototype.loggingData=function(){return{errorMessage:this.errorMessage,id:this.id}},e.type="TRANSACTION_FAILED",e}(r.r)},54439:(t,e,s)=>{"use strict";s.d(e,{j:()=>c});var r=s(29274),a=s(74427),i=s(57860),n=s(47204),o=s(74568),l=s(79947);class c{static beginTransaction(t,e,s){let{transactionId:a,name:i,logQos:n,action:l,additionalData:d}=e;if(!0===n){const t=new o.W({name:"Tx:"+i},s);c.qosEventsInFlight[a]=t}t.batchDispatchActions(new r.S(i,a,d),l)}static cancelTransaction(t,e){let{transactionId:s,action:r,additionalData:i}=e;const n=c.qosEventsInFlight[s];n&&(n.end({resultType:l.f.ExpectedFailure,extraData:i}),delete c.qosEventsInFlight[s]),t.batchDispatchActions(r,new a.D(s,i))}static completeTransaction(t,e){let{transactionId:s,action:r,additionalData:a}=e;const n=c.qosEventsInFlight[s];n&&(n.end({resultType:l.f.Success,extraData:a}),delete c.qosEventsInFlight[s]),t.batchDispatchActions(r,new i.M(s,a))}static completeTransactionWithBatch(t,e){let{transactionId:s,actions:r,additionalData:a}=e;const n=c.qosEventsInFlight[s];n&&(n.end({resultType:l.f.Success,extraData:a}),delete c.qosEventsInFlight[s]),t.batchDispatchActions(...r,new i.M(s,a))}static completeTransactionWithError(t,e){let{transactionId:s,errorMessage:r,action:a,additionalData:i}=e;const o=c.qosEventsInFlight[s];o&&(o.end({resultType:l.f.Failure,error:r,extraData:i}),delete c.qosEventsInFlight[s]),t.batchDispatchActions(a,new n.Y(s,r,i))}}c.qosEventsInFlight={}},57860:(t,e,s)=>{"use strict";s.d(e,{M:()=>i});var r=s(75992),a=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},t(e,s)};return function(e,s){function r(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}(),i=function(t){function e(s,r){var a=t.call(this,e.type)||this;return a.id=s,a.additionalData=r,a}return a(e,t),e.prototype.loggingData=function(){return{id:this.id}},e.type="TRANSACTION_SUCEEDED",e}(r.r)},64416:(t,e,s)=>{var r=s(18902),a=s(75866),i=s(41558),n=s(58114),o=s(68182),l=s(52074);t.exports=function(t,e,s){var c=-1,d=a,g=t.length,u=!0,p=[],h=p;if(s)u=!1,d=i;else if(g>=200){var k=e?null:o(t);if(k)return l(k);u=!1,d=n,h=new r}else h=e?[]:p;t:for(;++c<g;){var T=t[c],m=e?e(T):T;if(T=s||0!==T?T:0,u&&m===m){for(var f=h.length;f--;)if(h[f]===m)continue t;e&&h.push(m),p.push(T)}else d(h,m,s)||(h!==p&&h.push(m),p.push(T))}return p}},64805:(t,e,s)=>{"use strict";s.d(e,{J:()=>a});class r{get clientSettings(){return this.clientSettingsProvider()}constructor(t,e,s){this.dispatcher=t,this.clientSettingsProvider=e,this.loggers=s}}class a extends r{getCurrentViewIds(){const t=this.stores.appContextStore.getCurrentViewId();return t?[t]:void 0}constructor(t,e,s,r,a){super(t,r,a),this.webApiProviders=e,this.stores=s}}},68182:(t,e,s)=>{var r=s(72070),a=s(75713),i=s(52074),n=r&&1/i(new r([,-0]))[1]==1/0?function(t){return new r(t)}:a;t.exports=n},72866:(t,e,s)=>{"use strict";s.d(e,{S:()=>o,d:()=>l});var r=s(56434),a=s.n(r),i=s(54320),n=s.n(i);class o{get filterCount(){let t=0;return this.filters.forEach(e=>{t+=e.values.length}),t}getFieldFilterCount(t){const e=this.indexOfFilter(t);return e<0?0:this.filters[e].values.length}replaceFilter(t,e){const s=this.getClone(),r=s.filters.filter(e=>e.field===t);let a=s.filters;return n()(r)?a.push(e):a=s.filters.map(s=>s.field===t?e:s),new o(a)}removeFilter(t){const e=this.getClone(),s=e.indexOfFilter(t);return s>=0&&e.filters.splice(s,1),e}doesFilterValueExist(t,e){const s=this.indexOfFilter(t);return s>=0&&this.filters[s].values.indexOf(e)>=0}toggleFilterValue(t,e){return this.doesFilterValueExist(t,e)?this.removeFilterValue(t,e):this.addFilterValue(t,e)}addFilterValue(t,e){const s=this.getClone(),r=s.indexOfFilter(t);return r>=0?s.filters[r].values.push(e):s.filters.push(new l(t,[e])),s}removeFilterValue(t,e){const s=this.getClone(),r=s.indexOfFilter(t);if(r>=0){const t=s.filters[r].values.indexOf(e);t>=0&&s.filters[r].values.splice(t,1)}return 0===s.filters[r].values.length&&s.filters.splice(r,1),s}getClone(){return a()(this)}indexOfFilter(t){let e=-1;for(let s=0;s<this.filters.length;s++){this.filters[s].field===t&&(e=s)}return e}constructor(t){this.filters=[],null!=t&&(this.filters=t)}}class l{constructor(t,e){if(n()(e))throw new Error("InvalidArgumentException: values cannot be empty");this.field=t,this.values=e}}},74427:(t,e,s)=>{"use strict";s.d(e,{D:()=>i});var r=s(75992),a=function(){var t=function(e,s){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s])},t(e,s)};return function(e,s){function r(){this.constructor=e}t(e,s),e.prototype=null===s?Object.create(s):(r.prototype=s.prototype,new r)}}(),i=function(t){function e(s,r){var a=t.call(this,e.type)||this;return a.id=s,a.additionalData=r,a}return a(e,t),e.prototype.loggingData=function(){return{id:this.id}},e.type="CANCEL_TRANSACTION",e}(r.r)},75713:t=>{t.exports=function(){}}}]);
//# sourceMappingURL=taskmodule.2306896a.chunk.js.map