"use strict";(self.webpackChunkTypeScriptModule=self.webpackChunkTypeScriptModule||[]).push([[769],{46451:(e,t,r)=>{r.r(t),r.d(t,{default:()=>Ce});var n,i,o=r(43032),a=r(11912),s=r(91165),u=r(90813),c=r(74292),l=r(57835),d=r(79490),h=r(7628),f=r(60996),v=r(33342),g="abcdefghijklmnopqrstuvwxyz0123456789",p=function(){function e(){(0,a._)(this,e),(0,u._)(this,"nodeToModelId",new Map),(0,u._)(this,"modelIdToNode",new Map)}return(0,s._)(e,[{key:"getModelId",value:function(e){if(!this.nodeToModelId.has(e)){var t=this.createModelId();this.nodeToModelId.set(e,t),this.modelIdToNode.set(t,e)}return this.nodeToModelId.get(e)}},{key:"tryGetNodeId",value:function(e){var t;return null!==(t=this.modelIdToNode.get(e))&&void 0!==t?t:null}},{key:"clear",value:function(){this.nodeToModelId.clear(),this.modelIdToNode.clear()}},{key:"createModelId",value:function(){for(var e="",t=0;t<4;t++){var r=Math.floor(36*Math.random());e+=g.charAt(r)}return this.nodeToModelId.has(e)?this.createModelId():e}}]),e}(),y=r(21601);function m(e){var t=0;return e.trim().toLowerCase().startsWith("<tr")?(e="<table>".concat(e,"</table>"),t=1):e.trim().toLowerCase().startsWith("<td")&&(e="<table><tr>".concat(e,"</tr></table>"),t=2),{wrappedHtml:e,unparentedTableTag:t}}function _(e,t){var r=e;switch(t){case 2:r=r.replace(/^<table[^>]*>\s*<tbody[^>]*>\s*<tr[^>]*>/i,"").replace(/<\/tr>\s*<\/tbody>\s*<\/table>\s*$/i,"");break;case 1:r=r.replace(/^<table[^>]*>\s*<tbody[^>]*>/i,"").replace(/<\/tbody>\s*<\/table>\s*$/i,"")}return r}!function(e){e[e.none=0]="none",e[e.tr=1]="tr",e[e.td=2]="td"}(n||(n={}));i={},(0,u._)(i,"TITLE","Title"),(0,u._)(i,"SUBTITLE","Subtitle"),(0,u._)(i,"P","Normal"),(0,u._)(i,"H1","heading 1"),(0,u._)(i,"H2","heading 2"),(0,u._)(i,"H3","heading 3"),(0,u._)(i,"H4","heading 4"),(0,u._)(i,"H5","heading 5"),(0,u._)(i,"H6","heading 6"),S={},(0,u._)(S,"TITLE","Title"),(0,u._)(S,"SUBTITLE","Subtitle"),(0,u._)(S,"P","Normal"),(0,u._)(S,"H7","Heading7"),(0,u._)(S,"H8","Heading8"),(0,u._)(S,"H9","Heading9");var S,I={IMG:["src","srcset"],A:["href"]};function b(e,t){if((0,y.UQ)()){var r=m(e),i=r.wrappedHtml,o=r.unparentedTableTag;o==n.none&&(i="<body>".concat(e,"</body>"));for(var a,s=T(i),u=s.body,c=(s.documentElement,document.createNodeIterator(u,NodeFilter.SHOW_ELEMENT));a=c.nextNode();){var l=I[a.tagName];l&&l.forEach((function(e){var r,n=a.getAttribute(e);n&&a.setAttribute(e,null!==(r=t.restore(n))&&void 0!==r?r:"")}))}return o!==n.none?_(u.innerHTML,o):u.innerHTML}return e}function w(e,t,r){for(var n,i=T(e),o=i.body,a=i.documentElement,s=document.createNodeIterator(o,NodeFilter.SHOW_ELEMENT);n=s.nextNode();)if(n.id&&(n.id=t.getModelId(n.id)),(0,y.UQ)()){var u=I[n.tagName];u&&u.forEach((function(e){var t=n.getAttribute(e);t&&n.setAttribute(e,r.stash(t))}))}return a.outerHTML}function T(e){var t=(new DOMParser).parseFromString(e,"text/html");if(t.querySelector("parsererror"))throw new Error("HTML parsing failed");return t}var k,E,L=r(27396),A=r(883),D=r(9643);!function(e){e[e.None=0]="None",e[e.IRMTemplate=1]="IRMTemplate",e[e.IRMUserDefinedPermission=2]="IRMUserDefinedPermission",e[e.IRMEncryptOnly=3]="IRMEncryptOnly",e[e.IRMDoNotForward=4]="IRMDoNotForward"}(k||(k={})),function(e){e[e.S_APPLYLABEL_OK=0]="S_APPLYLABEL_OK",e[e.E_APPLYLABEL_FAIL=2147467259]="E_APPLYLABEL_FAIL",e[e.E_APPLYLABEL_NEWLABELSENSITIVITYORDER=2147205105]="E_APPLYLABEL_NEWLABELSENSITIVITYORDER"}(E||(E={}));var N=r(86758),R={labelId:"",tenantId:""},C=function(){function e(){(0,a._)(this,e),(0,u._)(this,"telemetryLogger",new N.p),(0,u._)(this,"contextString",void 0),this.contextString=(0,h.A)()}return(0,s._)(e,[{key:"getInDocSensitiveLabelUsingOfcJs",value:function(){var e=this;return(0,o._)((function(){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:(0,D.c)("Getting label"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.telemetryLogger.withActivityDurationAsync((0,o._)((function(){return(0,d.__generator)(this,(function(e){switch(e.label){case 0:return[4,OfficeFirstParty.Sensitivity.getLabel()];case 1:return[2,e.sent()]}}))})),"GetLabel")];case 2:return t=i.sent(),(0,D.c)("Label is : ",t),[2,t];case 3:return r=i.sent(),n=(0,c._)(r,Error)?r.message:"Failed with unknown error",(0,D.c)("Error while fetching In Doc sensitivity label: ".concat(n)),[2,R];case 4:return[2]}}))}))()}},{key:"getHighestDocumentSensitivityInfo",value:function(e){var t=this;return(0,o._)((function(){var r,n,i;return(0,d.__generator)(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,t.telemetryLogger.withActivityDurationAsync((0,o._)((function(){return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return[4,OfficeFirstParty.Sensitivity.getHighestSensitivityLabel(e)];case 1:return[2,t.sent()]}}))})),"HighestSensitivityLabel")];case 1:return r=a.sent(),(0,D.c)("Sensitivity info fetched for label ".concat(JSON.stringify(e),": ").concat(JSON.stringify(r))),[2,r];case 2:return n=a.sent(),i=(0,c._)(n,Error)?n.message:"Failed with unknown error",(0,D.c)("Error while fetching highest sensitivity label: ".concat(i)),[2,R];case 3:return[2]}}))}))()}},{key:"upgradeSensitivityLabelUsingOfcJs",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this;return(0,o._)((function(){var n,i,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:(0,D.c)("Upgrading sensitivity label: ".concat(JSON.stringify(e))),l=(0,o._)((function(){var n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:if(t&&!r.isValidLabelInfo(e))throw(0,D.c)("Invalid label",e),new Error("Invalid label format id: ".concat(e.labelId));return n=new Promise((function(e,t){setTimeout((function(){return t(new Error("CallbackTimeout"))}),3e4)})),[4,Promise.race([OfficeFirstParty.Sensitivity.tryUpgradeLabel(e,r.contextString),n])];case 1:return i.sent(),[2,{status:E[E.S_APPLYLABEL_OK]}]}}))})),n=function(){return l.apply(this,arguments)},u.label=1;case 1:return u.trys.push([1,3,,4]),[4,r.telemetryLogger.withActivityDurationAsync(n,"TryUpgradeLabel")];case 2:return[2,u.sent()];case 3:return i=u.sent(),a=(0,c._)(i,Error)?i.message:"Failed with unknown error",(0,D.c)("Exception while upgrading sensitivity label: ".concat(a)),a&&a.startsWith("Invalid label format")?[2,{status:E[E.E_APPLYLABEL_FAIL],errorMessage:"Invalid label format"}]:[2,{status:null!==(s=E[a])&&void 0!==s?s:a}];case 4:return[2]}var l}))}))()}},{key:"isValidLabelInfo",value:function(e){var t;return null!=(null===(t=e.labelId)||void 0===t?void 0:t.match(/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/))}}],[{key:"getInstance",value:function(){return(0,A.isNullOrUndefined)(e.clpSensitivityHandler)&&(e.clpSensitivityHandler=new e),e.clpSensitivityHandler}}]),e}();function H(e){return P.apply(this,arguments)}function P(){return(P=(0,o._)((function(e){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),(0,y.Yl)()?[4,M(e)]:[2];case 1:return t=i.sent(),[4,C.getInstance().upgradeSensitivityLabelUsingOfcJs(t)];case 2:if(!(null==(r=i.sent())?void 0:r.errorMessage))return[2];if((0,D.c)(L.SA.Error,"[WordCanvasTool] Failed to apply SensitivityLabel: ".concat(r.errorMessage)),(0,y.oY)()&&r.status!==E[E.S_APPLYLABEL_OK]&&r.status!==E[E.E_APPLYLABEL_NEWLABELSENSITIVITYORDER])throw new Error(r.errorMessage);return[3,4];case 3:if(n=i.sent(),(0,D.c)(L.SA.Error,"[WordCanvasTool] Failed to apply SensitivityLabel: ".concat(n.message)),(0,y.oY)())throw new Error("Sensitivity Label Upgrade failed with: ".concat(n.message));return[3,4];case 4:return[2]}}))}))).apply(this,arguments)}function M(e){return O.apply(this,arguments)}function O(){return(O=(0,o._)((function(e){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return[4,U(e)];case 1:return(t=i.sent())?[4,q()]:[2,null];case 2:return r=i.sent(),n=r?[r,t]:[t],[4,C.getInstance().getHighestDocumentSensitivityInfo(n)];case 3:return[2,i.sent()]}}))}))).apply(this,arguments)}function q(){return F.apply(this,arguments)}function F(){return(F=(0,o._)((function(){return(0,d.__generator)(this,(function(e){switch(e.label){case 0:return[4,C.getInstance().getInDocSensitiveLabelUsingOfcJs()];case 1:return[2,e.sent()]}}))}))).apply(this,arguments)}function U(e){return x.apply(this,arguments)}function x(){return(x=(0,o._)((function(e){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return(t=e.sensitivityLabelJson)&&""!==t.trim()?(r=JSON.parse(t),[4,(0,L.EO)()]):[2,null];case 1:return n=i.sent(),[2,{labelId:r.id,tenantId:n||"",displayName:r.displayName,color:r.color}]}}))}))).apply(this,arguments)}(0,u._)(C,"clpSensitivityHandler",void 0);var B=r(61737),z=r(4315),G=r(61838),K=r(42652),W=r(8235),J=r.n(W),V=new N.p,Y={cleaned:"",styleAttributesRemoved:0,styleAttributesPartiallyCleaned:0,totalStyleDeclarationsRemoved:0,totalStyleDeclarationsKept:0,originalDeclarations:0,blockedCssProperties:new Map},Q=new Set(["html","body","head","p","div","span","br","hr","h1","h2","h3","h4","h5","h6","style","strong","b","em","i","u","sub","sup","s","del","mark","ins","small","big","ul","ol","li","dl","dt","dd","table","thead","tbody","tfoot","tr","td","th","blockquote","pre","code","title","subtitle","msword-title","caption","section","header","footer","a"]),j=new Set(["class","id","lang","dir","width","height","colspan","rowspan","scope","headers","style","href","target","rel","title","alt","align"]),$=new Set(["color","background","background-color","font-family","font-size","font-weight","font-style","text-align","text-decoration","line-height","margin","margin-top","margin-right","margin-bottom","margin-left","padding","padding-top","padding-right","padding-bottom","padding-left","border","border-style","border-color","border-width","border-top","border-top-style","border-top-color","border-top-width","border-right","border-right-style","border-right-color","border-right-width","border-bottom","border-bottom-style","border-bottom-color","border-bottom-width","border-left","border-left-style","border-left-color","border-left-width","width","height","text-transform","letter-spacing","vertical-align","list-style-type"]);function Z(e){return ee(e,{wrapInBody:!0,operation:"Export"})}function X(e){return ee(e,{wrapInBody:!1,enforceSingleRoot:(0,y.zB)(),operation:"Import"})}function ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e||"string"!=typeof e)return"";var r=t.wrapInBody,n=void 0!==r&&r,i=t.enforceSingleRoot,o=void 0!==i&&i,a=t.operation,s=void 0===a?"Unknown":a,u=ae(),l=se();try{(0,D.c)("Sanitizer: Starting sanitization for operation: ".concat(s)),(0,y.nL)()&&(0,D.c)("Sanitizer: Input HTML to Sanitizer ".concat(e));var d=J()(window),h=new Map,f=new Map,v=new Map,g=0,p=0,m=0,_=0;d.addHook("uponSanitizeAttribute",(function(e,t){var r,n=null===(r=t.attrName)||void 0===r?void 0:r.toLowerCase();if("style"===n){var i=ce(t.attrValue);if(i.cleaned)if(t.attrValue=i.cleaned,i.totalStyleDeclarationsRemoved>0){if(p+=1,m+=i.totalStyleDeclarationsRemoved,_+=i.totalStyleDeclarationsKept,i.blockedCssProperties){var o=!0,a=!1,s=void 0;try{for(var u,c=i.blockedCssProperties.entries()[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var l=(0,K._)(u.value,2),d=l[0],h=l[1];v.set(d,(v.get(d)||0)+h)}}catch(e){a=!0,s=e}finally{try{o||null==c.return||c.return()}finally{if(a)throw s}}}}else _+=i.totalStyleDeclarationsKept;else if(t.keepAttr=!1,i.originalDeclarations>0&&(g+=1,m+=i.totalStyleDeclarationsRemoved,i.blockedCssProperties)){var S=!0,I=!1,b=void 0;try{for(var w,T=i.blockedCssProperties.entries()[Symbol.iterator]();!(S=(w=T.next()).done);S=!0){var k=(0,K._)(w.value,2),E=k[0],L=k[1];v.set(E,(v.get(E)||0)+L)}}catch(e){I=!0,b=e}finally{try{S||null==T.return||T.return()}finally{if(I)throw b}}}}else if((0,y.Qc)()&&!1===t.keepAttr){var A=n||"unknown";f.set(A,(f.get(A)||0)+1)}})),d.addHook("uponSanitizeElement",(function(e,t){var r;if((0,y.Qc)()&&t.allowedTags&&!t.allowedTags[null===(r=t.tagName)||void 0===r?void 0:r.toLowerCase()]){var n,i=(null===(n=t.tagName)||void 0===n?void 0:n.toLowerCase())||"unknown";h.set(i,(h.get(i)||0)+1)}}));var S=ne(e),I=S.preProcessed,b=S.unparentedTableTag,w=d.sanitize(I,{ALLOWED_TAGS:u,ALLOWED_ATTR:l,KEEP_CONTENT:!0,FORBID_ATTR:["hidden"],ALLOW_DATA_ATTR:!0});if(o){var T=(new DOMParser).parseFromString(w,"text/html"),k=Array.from(T.body.children);switch(k.length){case 0:throw B.h.noTopLevelElement();case 1:break;default:throw B.h.tooManyTopLevelElements(k.length)}}if(w=ie(w,b),n&&(w="<body>".concat(w,"</body>")),(0,y.Qc)())try{!function(e,t,r,n){if(!(0,y.Qc)())return;var i=[{key:"Operation",value:e},{key:"BlockedTagsCount",value:t.size},{key:"BlockedAttributesCount",value:r.size}];n&&(n.styleAttributesRemoved>0&&i.push({key:"StyleAttributesCompletelyRemoved",value:n.styleAttributesRemoved}),n.styleAttributesPartiallyCleaned>0&&i.push({key:"StyleAttributesPartiallyCleaned",value:n.styleAttributesPartiallyCleaned}),n.totalStyleDeclarationsRemoved>0&&i.push({key:"TotalCssDeclarationsRemoved",value:n.totalStyleDeclarationsRemoved}),n.totalStyleDeclarationsKept>0&&i.push({key:"TotalCssDeclarationsKept",value:n.totalStyleDeclarationsKept}));if((0,y.z6)()){var o=Array.from(t.entries()).map((function(e){var t=(0,K._)(e,2),r=t[0],n=t[1];return"".concat(r,":").concat(n)})).join(",")||"none",a=Array.from(r.entries()).map((function(e){var t=(0,K._)(e,2),r=t[0],n=t[1];return"".concat(r,":").concat(n)})).join(",")||"none",s=(null==n?void 0:n.blockedCssProperties)&&Array.from(n.blockedCssProperties.entries()).map((function(e){var t=(0,K._)(e,2),r=t[0],n=t[1];return"".concat(r,":").concat(n)})).join(",")||"none";i.push({key:"BlockedTypes",value:"tags:".concat(o,"|attrs:").concat(a,"|css:").concat(s)})}V.logEvent("SanitizerBlocked",i)}(s,h,f,{styleAttributesRemoved:g,styleAttributesPartiallyCleaned:p,totalStyleDeclarationsRemoved:m,totalStyleDeclarationsKept:_,blockedCssProperties:v})}catch(e){(0,D.c)("Sanitizer: Failed to log blocked items: ".concat((0,c._)(e,Error)?e.message:"Unknown error"))}return(0,D.c)("Sanitizer: Ending sanitization for operation: ".concat(s)),(0,y.nL)()&&(0,D.c)("Sanitizer: Output from Sanitizer ".concat(w)),w}catch(e){if((0,y.Qc)())try{V.logEvent("SanitizerError",[{key:"Operation",value:s},{key:"ErrorMessage",value:(0,c._)(e,Error)?e.message:"Unknown error"}])}catch(e){(0,D.c)("Sanitizer: Failed to log error event: ".concat((0,c._)(e,Error)?e.message:"Unknown error"))}throw(0,D.c)("Sanitizer: Failed processing for operation: ".concat(s)),e}}function te(e,t){var r=e.trim().toLowerCase(),n=t.trim().toLowerCase();if(!r||!n)return!1;switch(r){case"font-size":var i=parseFloat(n);return!isNaN(i)&&0===i;case"color":return"transparent"===n;case"margin":case"margin-top":case"margin-right":case"margin-bottom":case"margin-left":case"padding":case"padding-top":case"padding-right":case"padding-bottom":case"padding-left":var o=parseFloat(n);return!isNaN(o)&&o<0;default:return!1}}function re(e){var t=e.toLowerCase();return t.includes("url(")||t.includes("import")||t.includes("javascript:")||t.includes("data:")||t.includes("expression(")||t.includes("behavior:")||t.includes("-moz-binding")||t.includes("vbscript:")||t.includes("mocha:")||t.includes("livescript:")}function ne(e){var t=m(e.replace(/<title(\s|>)/gi,"<msword-title$1").replace(/<\/title>/gi,"</msword-title>"));return{preProcessed:t.wrappedHtml,unparentedTableTag:t.unparentedTableTag}}function ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.none;return _(e.replace(/<msword-title/gi,"<title").replace(/<\/msword-title>/gi,"</title>"),t)}function oe(e){return(null==e?void 0:e.trim())?e.split("|").map((function(e){return e.trim().toLowerCase()})).filter(Boolean):null}function ae(){var e=oe((0,y.S_)());return e&&e.length>0?e:Array.from(Q)}function se(){var e=oe((0,y.gH)());return e&&e.length>0?e:Array.from(j)}function ue(){var e=oe((0,y.FL)());return e&&e.length>0?new Set(e):$}function ce(e){if(!e)return Y;try{for(var t=e.split(";"),r=[],n=0,i=0,o=0,a=new Map,s=0;s<t.length;s++){var u=t[s].trim();if(u){o++;var c=u.indexOf(":");if(c<=0||c>=u.length-1)n++;else{var d=u.slice(0,c).trim(),h=u.slice(c+1).trim();if(d&&h)if(re(h)||te(d,h)||!ue().has(d.toLowerCase())){n++;var f=d.toLowerCase();a.set(f,(a.get(f)||0)+1)}else r.push("".concat(d,": ").concat(h)),i++;else n++}}}var v=r.length>0?r.join("; ")+";":"";return(0,G._)((0,l._)({},Y),{cleaned:v,totalStyleDeclarationsRemoved:n,totalStyleDeclarationsKept:i,originalDeclarations:o,blockedCssProperties:a})}catch(e){return Y}}var le=function(){function e(){(0,a._)(this,e),(0,u._)(this,"stashedResource",new Map),(0,u._)(this,"stashPattern","RESOURCE_PLACEHOLDER_%d")}return(0,s._)(e,[{key:"stash",value:function(e){var t=this.stashPattern.replace("%d",this.stashedResource.size.toString());return this.stashedResource.set(t,e),t}},{key:"restore",value:function(e){var t;return null!==(t=this.stashedResource.get(e))&&void 0!==t?t:null}},{key:"clear",value:function(){this.stashedResource.clear()}}]),e}(),de=r(20570),he=r(7182),fe=r(81092),ve=r(51216),ge=r(33505),pe=r(57662),ye=r(40413),me=r(64081),_e=r(93288),Se=r(22474),Ie=r(97127),be=r(86853),we=r(22898),Te=r(98290),ke=r(32858),Ee=r(996),Le=function(e){(0,he._)(r,e);var t=(0,pe._)(r);function r(e,n){var i;return(0,a._)(this,r),i=t.call(this,e),(0,u._)((0,de._)(i),"code",void 0),i.code=n,i.name="HiTLServiceError",i}return r}((0,ge._)(Error)),Ae=function(){function e(t){(0,a._)(this,e),(0,u._)(this,"config",void 0),(0,u._)(this,"telemetryLogger",new N.p),(0,u._)(this,"graphClient",null),(0,u._)(this,"accessToken",null),(0,u._)(this,"tokenExpiryTime",null),(0,u._)(this,"tokenAcquisitionPromise",null),this.config=(0,l._)({},e.DEFAULT_CONFIG,t)}return(0,s._)(e,[{key:"isLocalDocument",value:function(e){var t=be.i.getM365ChatClientPlatform();if(!e)return t!==ke.mp.Web;switch(t){case ke.mp.Win32:return/^[a-zA-Z]:\\/.test(e);case ke.mp.MacOS:return e.startsWith("/")&&!e.startsWith("http");case ke.mp.iPad:return!e.startsWith("http");case ke.mp.Web:default:return!1}}},{key:"requireHiTLFromSharedStatus",value:function(){var t=this;return(0,o._)((function(){var r;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,t.telemetryLogger.withActivityDurationAsync((0,o._)((function(){var r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return[4,be.i.getDocumentUrlAsync()];case 1:return r=s.sent(),n=be.i.getM365ChatClientPlatform(),t.isLocalDocument(r)?(t.logTelemetry("HiTLCheckLocalDocument",{platform:n,hasDocumentUrl:!!r}),i={required:!1,reason:"not_shared",documentUrl:r||void 0},t.logTelemetry("HiTLRequirementStatus",{required:!1,reason:"not_shared",platform:n}),[2,i]):r?(o=e.encodeShareId(r),[4,t.fetchDriveItemSharedFlag(o)]):(t.logTelemetry("HiTLRequirementStatus",{required:!0,reason:"no_url",platform:n}),[2,{required:!0,reason:"no_url"}]);case 2:return a=s.sent(),t.logTelemetry("HiTLRequirementStatus",{required:a,reason:a?"shared":"not_shared",platform:n}),[2,{required:a,reason:a?"shared":"not_shared",documentUrl:r}]}}))})),"HiTLStatusCheck",[])];case 1:return[2,n.sent()];case 2:return r=n.sent(),t.logTelemetry("HiTLRequirementStatus",{required:!0,reason:"error",platform:be.i.getM365ChatClientPlatform()}),[2,{required:!0,reason:"error",errorDetails:(0,c._)(r,Error)?r.message:"Unknown error"}];case 3:return[2]}}))}))()}},{key:"clearAuthState",value:function(){this.graphClient=null,this.accessToken=null,this.tokenExpiryTime=null}},{key:"initializeGraphClient",value:function(){var e=this;return(0,o._)((function(){return(0,d.__generator)(this,(function(t){switch(t.label){case 0:return e.isTokenValid()?[2]:e.tokenAcquisitionPromise?[4,e.tokenAcquisitionPromise]:[3,2];case 1:return t.sent(),[2];case 2:e.tokenAcquisitionPromise=e.acquireAndSetToken(),t.label=3;case 3:return t.trys.push([3,,5,6]),[4,e.tokenAcquisitionPromise];case 4:return t.sent(),[3,6];case 5:return e.tokenAcquisitionPromise=null,[7];case 6:return[2]}}))}))()}},{key:"acquireAndSetToken",value:function(){var e=this;return(0,o._)((function(){var t,r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:t=function(t){var r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,5]),[4,e.telemetryLogger.withActivityDurationAsync((0,o._)((function(){var t;return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return[4,e.acquireGraphAccessToken()];case 1:return t=r.sent(),e.setAuthState(t),[2]}}))})),"TokenAcquisition",e.buildEventData({attempt:t+1,totalAttempts:e.config.tokenRetryCount}))];case 1:return i.sent(),[2,{v:void 0}];case 2:return r=i.sent(),t<e.config.tokenRetryCount-1?(n=Math.min(e.config.tokenRetryDelayMs*Math.pow(2,t),3e4),[4,new Promise((function(e){return setTimeout(e,n)}))]):[3,4];case 3:return i.sent(),[2,"continue"];case 4:throw new Le("Token acquisition failed after ".concat(e.config.tokenRetryCount," attempts: ").concat((0,c._)(r,Error)?r.message:"Unknown error"),"TOKEN_ACQUISITION_FAILED");case 5:return[2]}}))},e.clearAuthState(),r=0,i.label=1;case 1:return r<e.config.tokenRetryCount?[5,(0,d.__values)(t(r))]:[3,4];case 2:if(n=i.sent(),"object"===(0,ve._)(n))return[2,n.v];i.label=3;case 3:return r++,[3,1];case 4:return[2]}}))}))()}},{key:"setAuthState",value:function(e){this.accessToken=e;var t=this.getTokenExpiry(e);if(t){var r=60*this.config.tokenBufferMinutes*1e3;this.tokenExpiryTime=t-r}else{var n=60*this.config.tokenLifetimeMinutes*1e3,i=60*this.config.tokenBufferMinutes*1e3;this.tokenExpiryTime=Date.now()+n-i}this.graphClient=ye.Kj.init({authProvider:function(t){return t(void 0,e)}})}},{key:"getTokenExpiry",value:function(e){try{var t=e.split(".");if(3!==t.length)return null;var r=JSON.parse(atob(t[1].replace(/-/g,"+").replace(/_/g,"/")));return r.exp?1e3*r.exp:null}catch(e){return null}}},{key:"acquireGraphAccessToken",value:function(){var e=this;return(0,o._)((function(){var t,r,n,i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return[4,(0,Se.m4)()];case 1:if(!(null==(t=u.sent())?void 0:t.userPrincipalName)||!(null==t?void 0:t.redirectUri))throw e.logTelemetry("InvalidClientInfo",{hasUPN:!!(null==t?void 0:t.userPrincipalName),hasRedirectUri:!!(null==t?void 0:t.redirectUri)}),new Le("Invalid client information for token acquisition","INVALID_CLIENT_INFO");return[4,(0,L.EO)()];case 2:return r=u.sent(),i=null!==(n=t.preferredAuthenticationStrategy)&&void 0!==n?n:"Default",o=(0,Ie.AJD)()&&t.nestedAppAuthRedirectUri&&"NestedAppAuth"===i,a=o?new we.G({userPrincipalName:t.userPrincipalName,redirectUri:t.nestedAppAuthRedirectUri,clientId:me.pL,tenantId:r}):new Te.a({userPrincipalName:t.userPrincipalName,redirectUri:t.redirectUri,clientId:me.pL,tenantId:r}),[4,(0,_e.v)(a,"https://graph.microsoft.com")];case 3:if(!(null==(s=u.sent())?void 0:s.accessToken))throw e.logTelemetry("TokenResponseMissingAccessToken",{hasResponse:!!s,authStrategy:i}),new Le("Token response does not contain access token","INVALID_TOKEN_RESPONSE");return[2,s.accessToken]}}))}))()}},{key:"fetchDriveItemSharedFlag",value:function(e){var t=this;return(0,o._)((function(){var r;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return[4,t.initializeGraphClient()];case 1:if(n.sent(),!t.graphClient)throw t.logTelemetry("GraphClientNotInitialized",{shareId:e}),new Le("Graph client not initialized","CLIENT_NOT_INITIALIZED");n.label=2;case 2:return n.trys.push([2,4,,8]),[4,t.telemetryLogger.withActivityDurationAsync((0,o._)((function(){return(0,d.__generator)(this,(function(r){return[2,t.executeGraphQuery(e)]}))})),"GraphQuery",t.buildEventData({shareId:e}))];case 3:return[2,n.sent()];case 4:return r=n.sent(),t.isAuthenticationError(r)?(t.logError("GraphQueryAuthError",r),t.clearAuthState(),[4,t.initializeGraphClient()]):[3,7];case 5:return n.sent(),[4,t.telemetryLogger.withActivityDurationAsync((0,o._)((function(){return(0,d.__generator)(this,(function(r){return[2,t.executeGraphQuery(e)]}))})),"GraphQueryRetry",t.buildEventData({shareId:e,isRetry:!0}))];case 6:return[2,n.sent()];case 7:throw r;case 8:return[2]}}))}))()}},{key:"executeGraphQuery",value:function(e){var t=this;return(0,o._)((function(){var r,n,i;return(0,d.__generator)(this,(function(o){switch(o.label){case 0:if(!t.graphClient)throw new Le("Graph client not initialized","CLIENT_NOT_INITIALIZED");return[4,t.graphClient.api("/shares/".concat(e,"/driveItem")).select(["shared","parentReference"]).get()];case 1:if(!(n=o.sent())||"object"!=typeof n)throw new Le("Invalid Graph API response","INVALID_API_RESPONSE");return i=null===(r=n.parentReference)||void 0===r?void 0:r.driveType,t.logTelemetry("GraphQueryDriveType",{driveType:i,hasSharedProperty:null!=n.shared}),"business"===i?[2,null!=n.shared]:[2,!0]}}))}))()}},{key:"isAuthenticationError",value:function(e){var t;if(!(0,c._)(e,Error))return!1;var r=(null===(t=e.message)||void 0===t?void 0:t.toLowerCase())||"";return r.includes("401")||r.includes("unauthorized")||r.includes("authentication")||r.includes("token")}},{key:"isTokenValid",value:function(){return Boolean(this.graphClient&&this.accessToken&&this.tokenExpiryTime&&Date.now()<this.tokenExpiryTime)}},{key:"logTelemetry",value:function(e,t){this.telemetryLogger.logEvent(e,this.buildEventData(t))}},{key:"logError",value:function(e,t){var r=(0,c._)(t,Error)?t.message:"Unknown error",n=(0,c._)(t,Le)?t.code:void 0,i=[{key:Ee.h3.ErrorMessage,value:r}];n&&i.push({key:"HiTL_errorCode",value:n}),this.telemetryLogger.logEvent(e,i)}},{key:"buildEventData",value:function(e){var t=[],r=!0,n=!1,i=void 0;try{for(var o,a=Object.entries(e)[Symbol.iterator]();!(r=(o=a.next()).done);r=!0){var s=(0,K._)(o.value,2),u=s[0],c=s[1];null!=c&&("errorMessage"===u?t.push({key:Ee.h3.ErrorMessage,value:String(c)}):t.push({key:"HiTL_".concat(u),value:String(c)}))}}catch(e){n=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(n)throw i}}return t}}],[{key:"encodeShareId",value:function(e){var t;if(!(null==e?void 0:e.trim()))throw new Le("Document URL is required for encoding shareId","INVALID_URL");try{if(!new URL(e).protocol.startsWith("http"))throw new Le("Invalid URL protocol","INVALID_URL_PROTOCOL")}catch(t){if((0,c._)(t,Le))throw t;throw new Le("Invalid URL format: ".concat(e),"INVALID_URL_FORMAT")}var r=(new TextEncoder).encode(e),n=btoa((t=String).fromCharCode.apply(t,(0,fe._)(r))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/g,"");return"u!".concat(n)}}]),e}();(0,u._)(Ae,"DEFAULT_CONFIG",{tokenRetryCount:3,tokenRetryDelayMs:1e3,tokenLifetimeMinutes:60,tokenBufferMinutes:10});var De={SESSION_STARTED:"The editing session was started successfully",SESSION_ENDED:"The edit session has been ended successfully.",nodeInserted:function(e,t,r){return"The element has been inserted ".concat(e," ").concat(t," and assigned element ID ").concat(r)},nodeReplaced:function(e,t){return"The node with id ".concat(e," has been replaced with the specified content. The new element has id ").concat(t)},nodeDeleted:function(e){return"The element ".concat(e," has been deleted.")},nodesDeleted:function(e){return"The elements ".concat(e.join(", ")," have been deleted.")},EDITING_BLOCKED_SHARED_DOCUMENT:"EDITING UNAVAILABLE: Because this document is shared, it cannot be edited using external data without the user first seeing and approving the changes. Respond to the user in chat with your proposed changes based on the information you found, and include the relevant data in your message. Ask the user to confirm if they would like you to proceed, at which point you can call this function again to attempt the operation."},Ne=function(){function e(){(0,a._)(this,e),(0,u._)(this,"nodeIdRegistry",new p),(0,u._)(this,"privateApiClient",new f.d),(0,u._)(this,"resourceMapper",new le),(0,u._)(this,"telemetryLogger",new N.p),(0,u._)(this,"hiTLService",null),(0,u._)(this,"cachedDocumentHtml",null),(0,u._)(this,"currentSession",{id:null,requestId:null,conversationId:null}),(0,u._)(this,"previousSession",{id:null,requestId:null,conversationId:null}),this.hiTLService=(0,y.jg)()?new Ae:null}return(0,s._)(e,[{key:"isEditSessionInProgress",get:function(){return null!==this.currentSession.id}},{key:"activeEditSessionId",get:function(){return this.currentSession.id}},{key:"getSessionMetadata",value:function(e){switch(!0){case e===this.currentSession.id:return this.currentSession;case e===this.previousSession.id:return this.previousSession;default:return null}}},{key:"getDocumentHtml",value:function(){var e=this;return(0,o._)((function(){var t,r,n,i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return e.cachedDocumentHtml?(0,y.Ku)()?(r={documentHtml:e.cachedDocumentHtml},[4,e.getCurrentSelection()]):[3,2]:[3,3];case 1:return r.documentSelection=u.sent(),t=r,[2,JSON.stringify(t)];case 2:return[2,e.cachedDocumentHtml];case 3:return e.nodeIdRegistry.clear(),e.resourceMapper.clear(),[4,e.privateApiClient.getDocumentHtml()];case 4:return n=u.sent(),i=(0,y.tp)()?Z(n.content):n.content,o=w(i,e.nodeIdRegistry,e.resourceMapper),e.cachedDocumentHtml=o,(0,y.Ku)()?(s={documentHtml:o},[4,e.getCurrentSelection()]):[3,6];case 5:return s.documentSelection=u.sent(),a=s,[2,JSON.stringify(a)];case 6:return[2,o]}}))}))()}},{key:"beginEditSession",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o;return(0,d.__generator)(this,(function(a){switch(a.label){case 0:return r=e.requestId,n=e.conversationId,i=e.requireHitl,t.currentSession.id&&t.currentSession.requestId!==r?[4,t.finishCurrentSession()]:[3,2];case 1:a.sent(),a.label=2;case 2:return[4,t.checkHiTLBlockingStatus(i)];case 3:return(o=a.sent())?[2,o]:(t.telemetryLogger.logEvent("BeginEditSessionInvocation",[{key:"EditSession_invocationType",value:"direct"}]),[4,t.createEditSession(r,n)]);case 4:return a.sent(),[2,De.SESSION_STARTED]}}))}))()}},{key:"finishCurrentSession",value:function(){var e=this;return(0,o._)((function(){return(0,d.__generator)(this,(function(t){switch(t.label){case 0:if(!e.currentSession.id)return[2];t.label=1;case 1:return t.trys.push([1,,3,4]),[4,e.privateApiClient.endEditSession({id:e.currentSession.id,reason:v.iR.RunToCompletion})];case 2:return t.sent(),[3,4];case 3:return e.previousSession=(0,l._)({},e.currentSession),e.currentSession={id:null,requestId:null,conversationId:null},[7];case 4:return[2]}}))}))()}},{key:"checkHiTLBlockingStatus",value:function(e){var t=this;return(0,o._)((function(){var r;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return t.hiTLService&&e?[4,t.hiTLService.requireHiTLFromSharedStatus()]:[2,null];case 1:return r=n.sent(),t.telemetryLogger.logEvent("HiTLEditDecision",[{key:"HiTL_documentShared",value:String(r.required)},{key:"HiTL_metadataRequires",value:String(e)},{key:"HiTL_editBlocked",value:String(r.required)},{key:"HiTL_reason",value:r.reason||"unknown"}]),r.required?[2,De.EDITING_BLOCKED_SHARED_DOCUMENT]:[2,null]}}))}))()}},{key:"createEditSession",value:function(e,t){var r=this;return(0,o._)((function(){var n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:return n=(0,h.A)(),[4,r.privateApiClient.beginEditSession({id:n})];case 1:return i.sent(),r.currentSession={id:n,requestId:e,conversationId:t},[2]}}))}))()}},{key:"ensureActiveSession",value:function(e){var t=this;return(0,o._)((function(){var r;return(0,d.__generator)(this,(function(n){switch(n.label){case 0:return t.currentSession.id?[2,null]:[4,t.checkHiTLBlockingStatus(e)];case 1:return(r=n.sent())?[2,r]:(t.telemetryLogger.logEvent("BeginEditSessionInvocation",[{key:"EditSession_invocationType",value:"fallback"}]),[4,t.createEditSession((0,h.A)(),(0,h.A)())]);case 2:return n.sent(),[2,null]}}))}))()}},{key:"endEditSession",value:function(e){var t=this;return(0,o._)((function(){return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return t.cachedDocumentHtml=null,e?[4,H(e.grounding)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[4,t.finishCurrentSession()];case 3:return r.sent(),[2,De.SESSION_ENDED]}}))}))()}},{key:"insertNode",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return[4,H(e.grounding)];case 1:return u.sent(),[4,t.ensureActiveSession(null==e?void 0:e.requireHitl)];case 2:if(r=u.sent())return[2,r];if(t.cachedDocumentHtml=null,n=e.nodeId,!(i=t.nodeIdRegistry.tryGetNodeId(n)))throw B.h.nodeNotFound(n);if("before"!==e.placement&&"after"!==e.placement)throw B.h.invalidPlacement();return o=t.sanitizeAndRestoreResourcesForImport(e.content,t.resourceMapper),[4,t.privateApiClient.insertHtml({nodeId:i,content:o,placement:e.placement})];case 3:return a=u.sent(),s=t.nodeIdRegistry.getModelId(a.nodeId),[2,De.nodeInserted(e.placement,n,s)]}}))}))()}},{key:"replaceNodeContent",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return[4,H(e.grounding)];case 1:return u.sent(),[4,t.ensureActiveSession(null==e?void 0:e.requireHitl)];case 2:if(r=u.sent())return[2,r];if(t.cachedDocumentHtml=null,n=e.nodeId,!(i=t.nodeIdRegistry.tryGetNodeId(n)))throw B.h.nodeNotFound(n);return o=t.sanitizeAndRestoreResourcesForImport(e.content,t.resourceMapper),[4,t.privateApiClient.insertHtml({nodeId:i,content:o,placement:v.iW.Replace})];case 3:return a=u.sent(),s=t.nodeIdRegistry.getModelId(a.nodeId),[2,De.nodeReplaced(n,s)]}}))}))()}},{key:"deleteNode",value:function(e){var t=this;return(0,o._)((function(){var r,n,i;return(0,d.__generator)(this,(function(o){switch(o.label){case 0:return[4,t.ensureActiveSession(null==e?void 0:e.requireHitl)];case 1:if(r=o.sent())return[2,r];if(t.cachedDocumentHtml=null,n=e.nodeId,!(i=t.nodeIdRegistry.tryGetNodeId(n)))throw B.h.nodeNotFound(n);return[4,t.privateApiClient.deleteNode({nodeId:i})];case 2:return o.sent(),[2,De.nodeDeleted(n)]}}))}))()}},{key:"deleteNodes",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a,s,u,l,h,f,v,g,p,y,m,_,S,I,b;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:return[4,t.ensureActiveSession(null==e?void 0:e.requireHitl)];case 1:if(r=d.sent())return[2,r];t.cachedDocumentHtml=null,n=e.nodeIds,i=[],o=[],a=!0,s=!1,u=void 0;try{for(l=n[Symbol.iterator]();!(a=(h=l.next()).done);a=!0)f=h.value,(v=t.nodeIdRegistry.tryGetNodeId(f))?o.push(v):i.push(f)}catch(e){s=!0,u=e}finally{try{a||null==l.return||l.return()}finally{if(s)throw u}}if(i.length>0)throw B.h.nodesNotFound(i);g=!0,p=!1,y=void 0,d.label=2;case 2:d.trys.push([2,9,10,11]),m=o[Symbol.iterator](),d.label=3;case 3:if(g=(_=m.next()).done)return[3,8];S=_.value,d.label=4;case 4:return d.trys.push([4,6,,7]),[4,t.privateApiClient.deleteNode({nodeId:S})];case 5:return d.sent(),[3,7];case 6:if(I=d.sent(),(0,c._)(I,z.N)&&-32e3===I.rpcError.code)return[3,7];throw I;case 7:return g=!0,[3,3];case 8:return[3,11];case 9:return b=d.sent(),p=!0,y=b,[3,11];case 10:try{g||null==m.return||m.return()}finally{if(p)throw y}return[7];case 11:return[2,De.nodesDeleted(n)]}}))}))()}},{key:"sanitizeAndRestoreResourcesForImport",value:function(e,t){return b((0,y.sr)()?X(e):e,t)}},{key:"getCurrentSelection",value:function(){return(0,o._)((function(){return(0,d.__generator)(this,(function(e){return[2,new Promise((function(e){try{Office.context.document.getSelectedDataAsync(Office.CoercionType.Text,(function(t){var r;t.status===Office.AsyncResultStatus.Succeeded?e(null!==(r=t.value)&&void 0!==r?r:""):e("")}))}catch(t){e("")}}))]}))}))()}}]),e}(),Re=function(){function e(){(0,a._)(this,e),(0,u._)(this,"nodeIdRegistry",new p),(0,u._)(this,"resourceMapper",new le),(0,u._)(this,"privateApiClient",new f.d),(0,u._)(this,"telemetryLogger",new N.p),(0,u._)(this,"hiTLService",null),(0,u._)(this,"cachedDocumentHtml",null),(0,u._)(this,"currentSession",{id:null,requestId:null,conversationId:null}),(0,u._)(this,"previousSession",{id:null,requestId:null,conversationId:null}),(0,u._)(this,"_isSessionInProgress",!1),this.hiTLService=(0,y.jg)()?new Ae:null}return(0,s._)(e,[{key:"isEditSessionInProgress",get:function(){return this._isSessionInProgress}},{key:"activeEditSessionId",get:function(){return this.currentSession.id}},{key:"getSessionMetadata",value:function(e){switch(!0){case e===this.currentSession.id:return this.currentSession;case e===this.previousSession.id:return this.previousSession;default:return null}}},{key:"getDocumentHtml",value:function(){var e=this;return(0,o._)((function(){var t,r,n,i,o,a,s;return(0,d.__generator)(this,(function(u){switch(u.label){case 0:return e.cachedDocumentHtml?(0,y.Ku)()?(r={documentHtml:e.cachedDocumentHtml},[4,e.getCurrentSelection()]):[3,2]:[3,3];case 1:return r.documentSelection=u.sent(),t=r,[2,JSON.stringify(t)];case 2:return[2,e.cachedDocumentHtml];case 3:return e.nodeIdRegistry.clear(),e.resourceMapper.clear(),[4,e.privateApiClient.getDocumentHtml()];case 4:return n=u.sent(),i=(0,y.tp)()?Z(n.content):n.content,o=w(i,e.nodeIdRegistry,e.resourceMapper),e.cachedDocumentHtml=o,(0,y.Ku)()?(s={documentHtml:o},[4,e.getCurrentSelection()]):[3,6];case 5:return s.documentSelection=u.sent(),a=s,[2,JSON.stringify(a)];case 6:return[2,o]}}))}))()}},{key:"beginEditSession",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:if(r=e.requestId,n=e.conversationId,i=e.requireHitl,t._isSessionInProgress)throw B.h.sessionInProgress();return t.hiTLService&&i?[4,t.hiTLService.requireHiTLFromSharedStatus()]:[3,2];case 1:if(o=s.sent(),t.telemetryLogger.logEvent("HiTLEditDecision",[{key:"HiTL_documentShared",value:String(o.required)},{key:"HiTL_metadataRequires",value:String(i)},{key:"HiTL_editBlocked",value:String(o.required)},{key:"HiTL_reason",value:o.reason||"unknown"}]),o.required)return[2,De.EDITING_BLOCKED_SHARED_DOCUMENT];s.label=2;case 2:return t._isSessionInProgress=!0,a=(0,h.A)(),[4,t.privateApiClient.beginEditSession({id:a})];case 3:return s.sent(),null!==t.currentSession.id&&(t.previousSession=(0,l._)({},t.currentSession)),t.currentSession={id:a,requestId:r,conversationId:n},[2,De.SESSION_STARTED]}}))}))()}},{key:"endEditSession",value:function(e){var t=this;return(0,o._)((function(){return(0,d.__generator)(this,(function(r){switch(r.label){case 0:return t.cachedDocumentHtml=null,e?[4,H(e.grounding)]:[3,2];case 1:r.sent(),r.label=2;case 2:return t._isSessionInProgress&&null!=t.currentSession.id?[4,t.privateApiClient.endEditSession({id:t.currentSession.id,reason:v.iR.RunToCompletion})]:[3,4];case 3:r.sent(),r.label=4;case 4:return t._isSessionInProgress=!1,[2,De.SESSION_ENDED]}}))}))()}},{key:"insertNode",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return[4,H(e.grounding)];case 1:if(s.sent(),t.cachedDocumentHtml=null,r=e.nodeId,!(n=t.nodeIdRegistry.tryGetNodeId(r)))throw B.h.nodeNotFound(r);if("before"!==e.placement&&"after"!==e.placement)throw B.h.invalidPlacement();return i=t.sanitizeAndRestoreResourcesForImport(e.content,t.resourceMapper),[4,t.privateApiClient.insertHtml({nodeId:n,content:i,placement:e.placement})];case 2:return o=s.sent(),a=t.nodeIdRegistry.getModelId(o.nodeId),[2,De.nodeInserted(e.placement,r,a)]}}))}))()}},{key:"replaceNodeContent",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a;return(0,d.__generator)(this,(function(s){switch(s.label){case 0:return[4,H(e.grounding)];case 1:if(s.sent(),t.cachedDocumentHtml=null,r=e.nodeId,!(n=t.nodeIdRegistry.tryGetNodeId(r)))throw B.h.nodeNotFound(r);return i=t.sanitizeAndRestoreResourcesForImport(e.content,t.resourceMapper),[4,t.privateApiClient.insertHtml({nodeId:n,content:i,placement:v.iW.Replace})];case 2:return o=s.sent(),a=t.nodeIdRegistry.getModelId(o.nodeId),[2,De.nodeReplaced(r,a)]}}))}))()}},{key:"deleteNode",value:function(e){var t=this;return(0,o._)((function(){var r,n;return(0,d.__generator)(this,(function(i){switch(i.label){case 0:if(t.cachedDocumentHtml=null,r=e.nodeId,!(n=t.nodeIdRegistry.tryGetNodeId(r)))throw B.h.nodeNotFound(r);return[4,t.privateApiClient.deleteNode({nodeId:n})];case 1:return i.sent(),[2,De.nodeDeleted(r)]}}))}))()}},{key:"deleteNodes",value:function(e){var t=this;return(0,o._)((function(){var r,n,i,o,a,s,u,l,h,f,v,g,p,y,m,_,S,I;return(0,d.__generator)(this,(function(d){switch(d.label){case 0:t.cachedDocumentHtml=null,r=e.nodeIds,n=[],i=[],o=!0,a=!1,s=void 0;try{for(u=r[Symbol.iterator]();!(o=(l=u.next()).done);o=!0)h=l.value,(f=t.nodeIdRegistry.tryGetNodeId(h))?i.push(f):n.push(h)}catch(e){a=!0,s=e}finally{try{o||null==u.return||u.return()}finally{if(a)throw s}}if(n.length>0)throw B.h.nodesNotFound(n);v=!0,g=!1,p=void 0,d.label=1;case 1:d.trys.push([1,8,9,10]),y=i[Symbol.iterator](),d.label=2;case 2:if(v=(m=y.next()).done)return[3,7];_=m.value,d.label=3;case 3:return d.trys.push([3,5,,6]),[4,t.privateApiClient.deleteNode({nodeId:_})];case 4:return d.sent(),[3,6];case 5:if(S=d.sent(),(0,c._)(S,z.N)&&-32e3===S.rpcError.code)return[3,6];throw S;case 6:return v=!0,[3,2];case 7:return[3,10];case 8:return I=d.sent(),g=!0,p=I,[3,10];case 9:try{v||null==y.return||y.return()}finally{if(g)throw p}return[7];case 10:return[2,De.nodesDeleted(r)]}}))}))()}},{key:"sanitizeAndRestoreResourcesForImport",value:function(e,t){return b((0,y.sr)()?X(e):e,t)}},{key:"getCurrentSelection",value:function(){return(0,o._)((function(){return(0,d.__generator)(this,(function(e){return[2,new Promise((function(e){try{Office.context.document.getSelectedDataAsync(Office.CoercionType.Text,(function(t){var r;t.status===Office.AsyncResultStatus.Succeeded?e(null!==(r=t.value)&&void 0!==r?r:""):e("")}))}catch(t){e("")}}))]}))}))()}}]),e}();function Ce(){return(0,y.Jf)()?new Ne:new Re}}}]);
//# sourceMappingURL=wordcanvastool.js.map